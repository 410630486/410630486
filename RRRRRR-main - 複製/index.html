<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校務系統網站</title>
    <link rel="icon" type="image/svg+xml" href="favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* 頁面載入動畫 */
        body {
            opacity: 0;
            animation: pageLoad 0.8s ease-out forwards;
        }
        
        @keyframes pageLoad {
            to {
                opacity: 1;
            }
        }
        
        /* 導覽列動畫 */
        .navbar {
            transform: translateY(-100%);
            animation: slideDown 0.6s ease-out 0.2s forwards;
        }
        
        @keyframes slideDown {
            to {
                transform: translateY(0);
            }
        }
        
        .navbar-nav .nav-item {
            opacity: 0;
            transform: translateY(-20px);
            animation: navItemFadeIn 0.5s ease-out forwards;
        }
        
        .navbar-nav .nav-item:nth-child(1) { animation-delay: 0.3s; }
        .navbar-nav .nav-item:nth-child(2) { animation-delay: 0.4s; }
        .navbar-nav .nav-item:nth-child(3) { animation-delay: 0.5s; }
        .navbar-nav .nav-item:nth-child(4) { animation-delay: 0.6s; }
        .navbar-nav .nav-item:nth-child(5) { animation-delay: 0.7s; }
        
        @keyframes navItemFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 首頁 Hero Section 樣式 */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 500px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="rgba(255,255,255,0.1)"><polygon points="0,0 1000,0 1000,100"/></svg>');
            background-size: cover;
            z-index: 1;
            animation: backgroundMove 20s linear infinite;
        }
        
        @keyframes backgroundMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }
        
        .hero-section .container {
            position: relative;
            z-index: 2;
        }
        
        .hero-section .display-4 {
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(50px);
            animation: titleSlideUp 1s ease-out 0.8s forwards;
        }
        
        @keyframes titleSlideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .hero-section .lead {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(30px);
            animation: subtitleSlideUp 1s ease-out 1.2s forwards;
        }
        
        @keyframes subtitleSlideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .hero-section .btn {
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 50px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            animation: buttonBounceIn 0.6s ease-out 2s forwards;
            position: relative;
            z-index: 3;
        }
        
        .hero-section .btn > *,
        .hero-section .btn i,
        .hero-section .btn span,
        .hero-section .btn .bi {
            position: relative;
            z-index: 4;
        }
        
        @keyframes buttonBounceIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            50% {
                opacity: 1;
                transform: translateY(-5px) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .hero-section .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            animation: buttonPulse 0.6s ease-in-out infinite alternate;
        }
        
        @keyframes buttonPulse {
            0% {
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            }
            100% {
                box-shadow: 0 12px 35px rgba(0,0,0,0.4);
            }
        }
        
        /* 首頁功能展示 */
        .hero-features {
            margin: 3rem 0;
            opacity: 0;
            transform: translateY(40px);
            animation: featuresSlideUp 1s ease-out 1.8s forwards;
        }
        
        @keyframes featuresSlideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .feature-item {
            padding: 1.5rem;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: featureItemFadeIn 0.6s ease-out forwards;
        }
        
        .feature-item:nth-child(1) { animation-delay: 2.2s; }
        .feature-item:nth-child(2) { animation-delay: 2.4s; }
        .feature-item:nth-child(3) { animation-delay: 2.6s; }
        
        @keyframes featureItemFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .feature-item:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(255,255,255,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .feature-item i {
            color: rgba(255,255,255,0.9);
            transition: all 0.3s ease;
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .feature-item:hover i {
            transform: scale(1.1) rotate(5deg);
            color: #fff;
        }
        
        .feature-item h5 {
            color: white;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .feature-item:hover h5 {
            transform: translateY(-2px);
        }
        
        .feature-item p {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-bottom: 0;
            transition: all 0.3s ease;
        }
        
        .feature-item:hover p {
            color: rgba(255,255,255,0.95);
        }
        
        /* 活動卡片樣式 */
        .activity-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .activity-card .card-img-container {
            position: relative;
            overflow: hidden;
        }
        
        .activity-card .card-img-top {
            transition: transform 0.3s ease;
        }
        
        .activity-card:hover .card-img-top {
            transform: scale(1.05);
        }
        
        .activity-card .progress {
            border-radius: 10px;
            background-color: #f8f9fa;
        }
        
        .activity-card .progress-bar {
            border-radius: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        /* 功能卡片樣式 */
        .function-card {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            opacity: 0;
            transform: translateY(30px);
            animation: cardFadeIn 0.6s ease-out forwards;
        }
        
        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .function-card:nth-child(1) { animation-delay: 0.1s; }
        .function-card:nth-child(2) { animation-delay: 0.2s; }
        .function-card:nth-child(3) { animation-delay: 0.3s; }
        .function-card:nth-child(4) { animation-delay: 0.4s; }
        .function-card:nth-child(5) { animation-delay: 0.5s; }
        .function-card:nth-child(6) { animation-delay: 0.6s; }
        .function-card:nth-child(7) { animation-delay: 0.7s; }
        .function-card:nth-child(8) { animation-delay: 0.8s; }
        .function-card:nth-child(9) { animation-delay: 0.9s; }
        
        .function-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            border: 2px solid #007bff;
        }
        
        .function-card:active {
            transform: translateY(-5px) scale(0.98);
        }
        
        .function-card .card-body {
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .function-card .card-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .function-card:hover .card-body::before {
            left: 100%;
        }
        
        .function-card .display-4 {
            font-size: 3rem;
            transition: all 0.3s ease;
            animation: iconBounce 2s ease-in-out infinite;
        }
        
        @keyframes iconBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .function-card:hover .display-4 {
            transform: scale(1.1) rotate(5deg);
            animation: none;
        }
        
        .function-card .card-title {
            transition: all 0.3s ease;
        }
        
        .function-card:hover .card-title {
            color: #007bff;
            transform: translateY(-2px);
        }
        
        .function-card .card-text {
            transition: all 0.3s ease;
        }
        
        .function-card:hover .card-text {
            color: #495057;
        }
        
        /* 課程表樣式 */
        .schedule-cell {
            position: relative;
            min-height: 60px;
            vertical-align: middle;
            padding: 4px !important;
            cursor: pointer;
        }
        
        .schedule-cell-empty {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            height: 60px;
        }
        
        .schedule-cell:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .table-danger {
            background-color: #f8d7da !important;
            border-color: #f5c2c7 !important;
        }
        
        .table-info {
            background-color: #d1ecf1 !important;
            border-color: #b8daff !important;
        }
        
        .table-warning {
            background-color: #fff3cd !important;
            border-color: #ffecb5 !important;
        }
        
        .table-success {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .table-secondary {
            background-color: #e2e3e5 !important;
            border-color: #d6d8db !important;
        }
        
        .tiny {
            font-size: 0.7rem;
            line-height: 1.1;
        }
        
        #schedule-table th {
            position: sticky;
            top: 0;
            background-color: #343a40 !important;
            color: white !important;
            z-index: 5;
        }
        
        #schedule-table {
            font-size: 0.9rem;
        }
        
        .schedule-period-time {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 30px;
        }

        /* 響應式課程表 */
        @media (max-width: 768px) {
            #schedule-table {
                font-size: 0.75rem;
            }
            
            .schedule-cell {
                min-height: 45px;
                padding: 2px !important;
            }
            
            .tiny {
                font-size: 0.6rem;
            }
        }

        /* 課程卡片動畫 */
        .course-card {
            transition: all 0.3s ease;
        }
        
        .course-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* 統計卡片樣式 */
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }
        
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 首頁內容切換 */
        .home-content {
            transition: all 0.5s ease;
        }
        
        .user-actions {
            margin-top: 1rem;
        }
        
        .user-actions .btn {
            margin: 0.5rem;
            animation: buttonFadeIn 0.8s ease-out 2.5s both;
        }
        
        @keyframes buttonFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 恐龍動畫樣式 */
        .dinosaur-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            overflow: hidden;
            pointer-events: none;
            z-index: 10;
        }
        
        .dinosaur {
            position: absolute;
            bottom: 20px;
            left: -80px;
            font-size: 80px;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.1s ease;
        }
        
        /* 不同恐龍的大小變化 */
        .dinosaur.small {
            font-size: 60px;
            bottom: 25px;
        }
        
        .dinosaur.medium {
            font-size: 80px;
            bottom: 20px;
        }
        
        .dinosaur.large {
            font-size: 100px;
            bottom: 15px;
        }
        
        /* 走路動畫 - 上下輕微擺動 */
        @keyframes dinosaurWalk {
            0% {
                left: -80px;
                transform: scaleX(1) translateY(0px);
            }
            5% {
                transform: scaleX(1) translateY(-3px);
            }
            10% {
                transform: scaleX(1) translateY(0px);
            }
            15% {
                transform: scaleX(1) translateY(-3px);
            }
            20% {
                transform: scaleX(1) translateY(0px);
            }
            25% {
                transform: scaleX(1) translateY(-3px);
            }
            30% {
                transform: scaleX(1) translateY(0px);
            }
            35% {
                transform: scaleX(1) translateY(-3px);
            }
            40% {
                transform: scaleX(1) translateY(0px);
            }
            45% {
                left: 50%;
                transform: translateX(-50%) scaleX(1) translateY(-3px);
            }
            50% {
                left: 50%;
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            55% {
                transform: translateX(-50%) scaleX(-1) translateY(-3px);
            }
            60% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            65% {
                transform: translateX(-50%) scaleX(-1) translateY(-3px);
            }
            70% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            75% {
                transform: translateX(-50%) scaleX(-1) translateY(-3px);
            }
            80% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            85% {
                transform: translateX(-50%) scaleX(-1) translateY(-3px);
            }
            90% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            95% {
                transform: translateX(-50%) scaleX(-1) translateY(-3px);
            }
            100% {
                left: calc(100% + 80px);
                transform: scaleX(-1) translateY(0px);
            }
        }
        
        /* 快速恐龍動畫 */
        @keyframes dinosaurWalkFast {
            0% {
                left: -80px;
                transform: scaleX(1) translateY(0px);
            }
            10% {
                transform: scaleX(1) translateY(-5px);
            }
            20% {
                transform: scaleX(1) translateY(0px);
            }
            30% {
                transform: scaleX(1) translateY(-5px);
            }
            40% {
                transform: scaleX(1) translateY(0px);
            }
            45% {
                left: 50%;
                transform: translateX(-50%) scaleX(1) translateY(-5px);
            }
            50% {
                left: 50%;
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            60% {
                transform: translateX(-50%) scaleX(-1) translateY(-5px);
            }
            70% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            80% {
                transform: translateX(-50%) scaleX(-1) translateY(-5px);
            }
            90% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            100% {
                left: calc(100% + 80px);
                transform: scaleX(-1) translateY(-5px);
            }
        }
        
        /* 慢速恐龍動畫 */
        @keyframes dinosaurWalkSlow {
            0% {
                left: -80px;
                transform: scaleX(1) translateY(0px);
            }
            8% {
                transform: scaleX(1) translateY(-2px);
            }
            16% {
                transform: scaleX(1) translateY(0px);
            }
            24% {
                transform: scaleX(1) translateY(-2px);
            }
            32% {
                transform: scaleX(1) translateY(0px);
            }
            40% {
                transform: scaleX(1) translateY(-2px);
            }
            45% {
                left: 50%;
                transform: translateX(-50%) scaleX(1) translateY(0px);
            }
            50% {
                left: 50%;
                transform: translateX(-50%) scaleX(-1) translateY(-2px);
            }
            58% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            66% {
                transform: translateX(-50%) scaleX(-1) translateY(-2px);
            }
            74% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            82% {
                transform: translateX(-50%) scaleX(-1) translateY(-2px);
            }
            90% {
                transform: translateX(-50%) scaleX(-1) translateY(0px);
            }
            100% {
                left: calc(100% + 80px);
                transform: scaleX(-1) translateY(-2px);
            }
        }
        
        /* 恐龍跳躍動畫 */
        .dinosaur:hover {
            animation: dinosaurJump 0.6s ease-in-out !important;
        }
        
        @keyframes dinosaurJump {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1) translateY(-30px);
            }
        }
        
        /* 噴火效果 */
        .fire-effect {
            position: absolute;
            bottom: 50px;
            left: 50px;
            font-size: 30px;
            opacity: 0;
            animation: fireBreath 1s ease-out;
            pointer-events: none;
        }
        
        @keyframes fireBreath {
            0% {
                opacity: 0;
                transform: scale(0.5) translateX(0);
            }
            30% {
                opacity: 1;
                transform: scale(1) translateX(20px);
            }
            60% {
                opacity: 0.8;
                transform: scale(1.2) translateX(40px);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) translateX(80px);
            }
        }
        
        /* 恐龍咆哮效果 */
        .roar-effect {
            position: absolute;
            bottom: 100px;
            left: 20px;
            font-size: 20px;
            opacity: 0;
            animation: roarEffect 0.5s ease-out;
            pointer-events: none;
        }
        
        @keyframes roarEffect {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }
        
        /* 導覽列使用者資訊樣式 */
        .navbar-nav .navbar-text {
            display: flex;
            align-items: center;
            color: rgba(255,255,255,0.8) !important;
        }
        
        #user-info {
            display: flex;
            align-items: center;
        }
        
        #user-name {
            font-weight: 500;
        }
        
        /* Toast 通知動畫 */
        .toast {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateX(100%);
            animation: toastSlideIn 0.4s ease-out forwards;
        }
        
        @keyframes toastSlideIn {
            to {
                transform: translateX(0);
            }
        }
        
        .toast.hiding {
            animation: toastSlideOut 0.4s ease-in forwards;
        }
        
        @keyframes toastSlideOut {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .toast-header {
            border-bottom: none;
            border-radius: 10px 10px 0 0;
        }
        
        .toast-body {
            border-radius: 0 0 10px 10px;
        }
        
        /* 頁面切換動畫 */
        .content-section {
            display: none;
            min-height: 400px;
            animation: pageSlideIn 0.6s ease-out;
        }
        
        @keyframes pageSlideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .content-section:target,
        .content-section.active {
            display: block;
        }
        
        /* 載入動畫 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
        
        /* 脈衝動畫 */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        /* 旋轉動畫 */
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        /* 閃爍動畫 */
        @keyframes shimmer {
            0% {
                background-position: -468px 0;
            }
            100% {
                background-position: 468px 0;
            }
        }
        
        /* 懸浮動畫 */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* 特殊效果 */
        .glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
            }
            to {
                box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
            }
        }
        
        /* 頁面元素入場動畫 */
        .slide-in-left {
            animation: slideInLeft 0.8s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.8s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* 卡片標題樣式 */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
            border-radius: 10px 10px 0 0 !important;
            position: relative;
            overflow: hidden;
        }
        
        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .card:hover .card-header::before {
            left: 100%;
        }
        
        /* 模態框動畫 */
        .modal.fade .modal-dialog {
            transform: scale(0.8) translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .modal.show .modal-dialog {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        
        .modal-content {
            border: none;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: modalSlideIn 0.4s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
            position: relative;
        }
        
        .modal-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #fff, transparent, #fff);
            animation: headerShine 2s ease-in-out infinite;
        }
        
        @keyframes headerShine {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            transform: scale(1.02);
        }
        
        .btn {
            border-radius: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
            z-index: 1;
            pointer-events: none;
        }
        
        .btn > *,
        .btn i,
        .btn span,
        .btn .bi {
            position: relative;
            z-index: 2;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .hero-section {
                min-height: 400px;
            }
            
            .hero-section .display-4 {
                font-size: 2.5rem;
            }
            
            .hero-section .lead {
                font-size: 1.2rem;
            }
            
            .hero-features {
                margin: 2rem 0;
            }
            
            .feature-item {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .feature-item .display-6 {
                font-size: 2rem;
            }
            
            .function-card .display-4 {
                font-size: 2.5rem;
            }
            
            .function-card .card-body {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .hero-section {
                min-height: 350px;
            }
            
            .hero-section .display-4 {
                font-size: 2rem;
            }
            
            .hero-section .lead {
                font-size: 1.1rem;
            }
            
            .feature-item h5 {
                font-size: 1rem;
            }
            
            .feature-item p {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Toast 容器 -->
    <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div>

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#" onclick="showSection('home')">
                    <i class="bi bi-mortarboard me-2"></i>校務系統網站
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto" id="navMenu">
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('home')">
                                <i class="bi bi-house me-1"></i>首頁
                            </a>
                        </li>
                        <li class="nav-item" id="nav-student" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('student')">
                                <i class="bi bi-person me-1"></i>學生專區
                            </a>
                        </li>
                        <li class="nav-item" id="nav-staff" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('staff')">
                                <i class="bi bi-person-badge me-1"></i>教職員專區
                            </a>
                        </li>
                        <li class="nav-item" id="nav-hr" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('hr')">
                                <i class="bi bi-building me-1"></i>人事部
                            </a>
                        </li>
                        <li class="nav-item" id="nav-admin" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('admin')">
                                <i class="bi bi-shield-lock me-1"></i>系統管理員
                            </a>
                        </li>
                    </ul>
                    
                    <div class="navbar-nav" id="user-info" style="display: none;">
                        <span class="navbar-text me-3">
                            <i class="bi bi-person-check me-1"></i>
                            <span id="user-name"></span>
                        </span>
                        <button class="btn btn-outline-light btn-sm" onclick="logout()">
                            <i class="bi bi-box-arrow-right me-1"></i>登出
                        </button>
                    </div>
                    
                    <button class="btn btn-outline-light" id="login-btn" onclick="showLoginModal()">
                        <i class="bi bi-box-arrow-in-right me-1"></i>登入
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container-fluid p-0">
        <!-- 首頁 -->
        <section id="home" class="content-section" style="display: block;">
            <div class="hero-section text-center text-white">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <!-- 未登入時顯示 -->
                            <div id="home-guest" class="home-content">
                                <h1 class="display-4 mb-4">歡迎使用校務系統</h1>
                                <p class="lead mb-4">一站式校園服務平台</p>
                                <div class="hero-features mb-4">
                                    <div class="row g-4">
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-mortarboard-fill display-6 mb-3"></i>
                                                <h5>學生服務</h5>
                                                <p>課程查詢、成績管理、選課系統</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-person-badge-fill display-6 mb-3"></i>
                                                <h5>教職員服務</h5>
                                                <p>教學管理、課程安排、學生管理</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-gear-fill display-6 mb-3"></i>
                                                <h5>系統管理</h5>
                                                <p>用戶管理、權限設定、系統維護</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-light btn-lg" onclick="showLoginModal()">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>開始使用
                                </button>
                            </div>
                            
                            <!-- 已登入時顯示 -->
                            <div id="home-user" class="home-content" style="display: none;">
                                <h1 class="display-4 mb-4">歡迎回來，<span id="welcome-user-name"></span>！</h1>
                                <p class="lead mb-4">您已成功登入校務系統</p>
                                <div class="hero-features mb-4">
                                    <div class="row g-4">
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-speedometer2 display-6 mb-3"></i>
                                                <h5>系統概覽</h5>
                                                <p>查看系統狀態和個人資訊</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-grid-3x3-gap-fill display-6 mb-3"></i>
                                                <h5>功能選單</h5>
                                                <p>使用上方導覽列存取各項功能</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="feature-item">
                                                <i class="bi bi-bell-fill display-6 mb-3"></i>
                                                <h5>最新消息</h5>
                                                <p>重要通知和系統公告</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="user-actions text-center">
                                    <button class="btn btn-light btn-lg me-3" onclick="gotoUserSection()">
                                        <i class="bi bi-person-workspace me-2"></i>前往我的專區
                                    </button>
                                    <button class="btn btn-outline-light btn-lg" onclick="showQuickActions()">
                                        <i class="bi bi-lightning-fill me-2"></i>快速操作
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 恐龍動畫區域 -->
            <div class="dinosaur-container" id="dinosaur-container">
                <!-- 恐龍會動態添加到這裡 -->
            </div>
        </section>

        <!-- 學生專區 -->
        <section id="student" class="content-section" style="display: none;">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h2 class="mb-4"><i class="bi bi-person text-primary me-2"></i>學生專區</h2>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-info')">
                            <div class="card-body text-center">
                                <i class="bi bi-person-vcard display-4 text-primary mb-3"></i>
                                <h5 class="card-title">基本資料查詢</h5>
                                <p class="card-text">查詢個人基本資料</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-schedule')">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar3 display-4 text-primary mb-3"></i>
                                <h5 class="card-title">課程表查詢</h5>
                                <p class="card-text">查詢個人課程表</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-grades')">
                            <div class="card-body text-center">
                                <i class="bi bi-clipboard-data display-4 text-primary mb-3"></i>
                                <h5 class="card-title">成績查詢</h5>
                                <p class="card-text">查詢個人成績</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-enrollment')">
                            <div class="card-body text-center">
                                <i class="bi bi-journal-plus display-4 text-primary mb-3"></i>
                                <h5 class="card-title">選課系統</h5>
                                <p class="card-text">線上選課與退選</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-fees')">
                            <div class="card-body text-center">
                                <i class="bi bi-credit-card display-4 text-primary mb-3"></i>
                                <h5 class="card-title">學雜費查詢</h5>
                                <p class="card-text">查詢繳費狀況</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-activities')">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar-event display-4 text-primary mb-3"></i>
                                <h5 class="card-title">活動報名</h5>
                                <p class="card-text">校園活動報名</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-announcements')">
                            <div class="card-body text-center">
                                <i class="bi bi-megaphone display-4 text-primary mb-3"></i>
                                <h5 class="card-title">公告查詢</h5>
                                <p class="card-text">最新消息與公告</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-documents')">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-text display-4 text-primary mb-3"></i>
                                <h5 class="card-title">文件申請</h5>
                                <p class="card-text">成績單、在學證明</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('student-library')">
                            <div class="card-body text-center">
                                <i class="bi bi-book display-4 text-primary mb-3"></i>
                                <h5 class="card-title">圖書館服務</h5>
                                <p class="card-text">借閱查詢與預約</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 教職員專區 -->
        <section id="staff" class="content-section" style="display: none;">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h2 class="mb-4"><i class="bi bi-person-badge text-primary me-2"></i>教職員專區</h2>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-info')">
                            <div class="card-body text-center">
                                <i class="bi bi-person-vcard display-4 text-warning mb-3"></i>
                                <h5 class="card-title">基本資料查詢</h5>
                                <p class="card-text">查詢個人基本資料</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-courses')">
                            <div class="card-body text-center">
                                <i class="bi bi-book display-4 text-warning mb-3"></i>
                                <h5 class="card-title">課程管理</h5>
                                <p class="card-text">管理教授課程</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-grades')">
                            <div class="card-body text-center">
                                <i class="bi bi-clipboard-data display-4 text-warning mb-3"></i>
                                <h5 class="card-title">成績管理</h5>
                                <p class="card-text">管理學生成績</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-schedule')">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar-week display-4 text-warning mb-3"></i>
                                <h5 class="card-title">課表查詢</h5>
                                <p class="card-text">查詢授課時間表</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-students')">
                            <div class="card-body text-center">
                                <i class="bi bi-people display-4 text-warning mb-3"></i>
                                <h5 class="card-title">學生管理</h5>
                                <p class="card-text">管理班級學生</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-attendance')">
                            <div class="card-body text-center">
                                <i class="bi bi-clipboard-check display-4 text-warning mb-3"></i>
                                <h5 class="card-title">出缺勤管理</h5>
                                <p class="card-text">管理學生出缺勤</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-announcements')">
                            <div class="card-body text-center">
                                <i class="bi bi-megaphone display-4 text-warning mb-3"></i>
                                <h5 class="card-title">發布公告</h5>
                                <p class="card-text">發布課程公告</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-reports')">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-bar-graph display-4 text-warning mb-3"></i>
                                <h5 class="card-title">報表查詢</h5>
                                <p class="card-text">教學報表與統計</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-class-management')">
                            <div class="card-body text-center">
                                <i class="bi bi-people-fill display-4 text-warning mb-3"></i>
                                <h5 class="card-title">班級管理</h5>
                                <p class="card-text">完整班級資料管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('staff-course-planning')">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar-plus display-4 text-warning mb-3"></i>
                                <h5 class="card-title">課程規劃</h5>
                                <p class="card-text">教學課程安排</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 人事部專區 -->
        <section id="hr" class="content-section" style="display: none;">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h2 class="mb-4"><i class="bi bi-building text-primary me-2"></i>人事部專區</h2>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-employee-management')">
                            <div class="card-body text-center">
                                <i class="bi bi-person-lines-fill display-4 text-info mb-3"></i>
                                <h5 class="card-title">員工管理</h5>
                                <p class="card-text">員工資料維護與管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-attendance')">
                            <div class="card-body text-center">
                                <i class="bi bi-clock display-4 text-info mb-3"></i>
                                <h5 class="card-title">考勤管理</h5>
                                <p class="card-text">員工出勤記錄管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-payroll')">
                            <div class="card-body text-center">
                                <i class="bi bi-wallet2 display-4 text-info mb-3"></i>
                                <h5 class="card-title">薪資管理</h5>
                                <p class="card-text">薪資計算與發放</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-recruitment')">
                            <div class="card-body text-center">
                                <i class="bi bi-person-plus display-4 text-info mb-3"></i>
                                <h5 class="card-title">招聘管理</h5>
                                <p class="card-text">職缺發布與應徵管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-performance')">
                            <div class="card-body text-center">
                                <i class="bi bi-graph-up display-4 text-info mb-3"></i>
                                <h5 class="card-title">績效考核</h5>
                                <p class="card-text">員工績效評估管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-training')">
                            <div class="card-body text-center">
                                <i class="bi bi-book-half display-4 text-info mb-3"></i>
                                <h5 class="card-title">培訓管理</h5>
                                <p class="card-text">員工培訓課程管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-leave')">
                            <div class="card-body text-center">
                                <i class="bi bi-calendar-x display-4 text-info mb-3"></i>
                                <h5 class="card-title">請假管理</h5>
                                <p class="card-text">員工請假申請與審核</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-benefits')">
                            <div class="card-body text-center">
                                <i class="bi bi-heart display-4 text-info mb-3"></i>
                                <h5 class="card-title">福利管理</h5>
                                <p class="card-text">員工福利制度管理</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('hr-reports')">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-bar-graph display-4 text-info mb-3"></i>
                                <h5 class="card-title">人事報表</h5>
                                <p class="card-text">人事統計與報表</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 系統管理員專區 -->
        <section id="admin" class="content-section" style="display: none;">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h2 class="mb-4"><i class="bi bi-shield-lock text-primary me-2"></i>系統管理員專區</h2>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-users')">
                            <div class="card-body text-center">
                                <i class="bi bi-people display-4 text-danger mb-3"></i>
                                <h5 class="card-title">用戶管理</h5>
                                <p class="card-text">管理系統用戶帳號</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-courses')">
                            <div class="card-body text-center">
                                <i class="bi bi-book display-4 text-danger mb-3"></i>
                                <h5 class="card-title">課程管理</h5>
                                <p class="card-text">管理系統課程資料</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-system')">
                            <div class="card-body text-center">
                                <i class="bi bi-gear display-4 text-danger mb-3"></i>
                                <h5 class="card-title">系統設定</h5>
                                <p class="card-text">系統參數設定</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-backup')">
                            <div class="card-body text-center">
                                <i class="bi bi-cloud-arrow-down display-4 text-danger mb-3"></i>
                                <h5 class="card-title">資料備份</h5>
                                <p class="card-text">備份與還原功能</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-logs')">
                            <div class="card-body text-center">
                                <i class="bi bi-journal-text display-4 text-danger mb-3"></i>
                                <h5 class="card-title">系統日誌</h5>
                                <p class="card-text">查看系統操作記錄</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 function-card" onclick="showFeature('admin-security')">
                            <div class="card-body text-center">
                                <i class="bi bi-shield-check display-4 text-danger mb-3"></i>
                                <h5 class="card-title">安全性管理</h5>
                                <p class="card-text">系統安全性設定</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 登入模態框 -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-box-arrow-in-right me-2"></i>登入系統
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">帳號</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">密碼</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="userType" class="form-label">身份</label>
                            <select class="form-select" id="userType" required>
                                <option value="">請選擇身份</option>
                                <option value="student">學生</option>
                                <option value="teacher">教師</option>
                                <option value="hr">人事</option>
                                <option value="admin">管理員</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">登入</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 功能區域 -->
    <div id="feature-area" class="container mt-4" style="display: none;">
        <div id="feature-content"></div>
    </div>

    <!-- 確認模態框 -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalTitle">
                        <i class="bi bi-question-circle me-2"></i>確認操作
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmModalMessage">您確定要執行此操作嗎？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmModalConfirm">確定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 文件申請模態框 -->
    <div class="modal fade" id="documentApplicationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="documentApplicationTitle">
                        <i class="bi bi-file-earmark-text me-2"></i>文件申請
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="documentApplicationForm">
                        <input type="hidden" id="documentType" value="">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">申請人姓名</label>
                                    <input type="text" class="form-control" id="applicantName" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">學號</label>
                                    <input type="text" class="form-control" id="studentId" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">聯絡電話</label>
                                    <input type="tel" class="form-control" id="phoneNumber" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">電子信箱</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">語言版本</label>
                                    <select class="form-select" id="language" required>
                                        <option value="">請選擇語言版本</option>
                                        <option value="zh">中文</option>
                                        <option value="en">英文</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">份數</label>
                                    <select class="form-select" id="copies" required>
                                        <option value="">請選擇份數</option>
                                        <option value="1">1份</option>
                                        <option value="2">2份</option>
                                        <option value="3">3份</option>
                                        <option value="5">5份</option>
                                        <option value="10">10份</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 特殊選項區域 -->
                        <div id="specialOptions">
                            <!-- 根據文件類型動態載入 -->
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">申請用途</label>
                            <select class="form-select" id="purpose" required>
                                <option value="">請選擇申請用途</option>
                                <option value="job">求職</option>
                                <option value="study">升學</option>
                                <option value="scholarship">獎學金申請</option>
                                <option value="visa">簽證申請</option>
                                <option value="immigration">移民</option>
                                <option value="work_permit">工作許可</option>
                                <option value="personal">個人用途</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div class="mb-3" id="otherPurposeDiv" style="display: none;">
                            <label class="form-label">其他用途說明</label>
                            <textarea class="form-control" id="otherPurpose" rows="2" placeholder="請詳細說明申請用途"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">特殊需求或備註</label>
                            <textarea class="form-control" id="remarks" rows="3" placeholder="如有特殊需求或其他備註事項，請在此說明"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    我已閱讀並同意 <a href="#" onclick="showTerms()">申請條款與規定</a>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 費用資訊 -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>費用資訊</h6>
                            <div id="feeInfo">
                                <p class="mb-1">申請費用將根據文件類型、語言版本和份數計算</p>
                                <p class="mb-0">預估費用：<strong id="estimatedFee">-</strong></p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="submitDocumentApplication()">提交申請</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="hr-functions.js"></script>
    <script>
        console.log('=== JavaScript 開始載入 ===');
        
        // 登入模態框函數 - 必須在全域作用域
        function showLoginModal() {
            console.log('=== showLoginModal 開始執行 ===');
            
            // 檢查 Bootstrap
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap 未載入');
                alert('系統錯誤：Bootstrap 未載入');
                return;
            }
            console.log('✓ Bootstrap 已載入');
            
            // 找到登入模態框元素
            const loginModal = document.getElementById('loginModal');
            console.log('尋找 loginModal:', loginModal);
            
            if (!loginModal) {
                console.error('找不到 loginModal 元素');
                alert('系統錯誤：找不到登入模態框');
                return;
            }
            console.log('✓ 找到 loginModal 元素');
            
            try {
                // 創建 Bootstrap Modal 實例
                const modal = new bootstrap.Modal(loginModal, {
                    backdrop: true,
                    keyboard: true,
                    focus: true
                });
                console.log('✓ Bootstrap Modal 實例已創建');
                
                // 顯示模態框
                modal.show();
                console.log('✓ modal.show() 已調用');
                
                // 監聽事件
                loginModal.addEventListener('shown.bs.modal', function() {
                    console.log('✓ 模態框已顯示');
                }, { once: true });
                
            } catch (error) {
                console.error('創建模態框錯誤:', error);
                alert('顯示登入模態框時發生錯誤: ' + error.message);
            }
        }
        
        // 確保函數在全域作用域中
        window.showLoginModal = showLoginModal;
        console.log('✓ showLoginModal 已設定到 window 物件');
        console.log('✓ showLoginModal 函數類型:', typeof showLoginModal);
        console.log('✓ window.showLoginModal 函數類型:', typeof window.showLoginModal);

        // 當前使用者
        let currentUser = null;
        
        // 學生選課記錄
        let studentEnrollments = {
            'student': {
                '113-1': ['CS101', 'CS102', 'MATH101'], // 預設已選課程
                '113-2': ['CS201', 'MATH201'],
                '114-1': [],
                '114-2': []
            }
        };
        
        // 學生選課歷史記錄
        let studentEnrollmentHistory = {
            'student': [
                {
                    time: '2024-07-15 10:30:00',
                    action: '加選',
                    courseCode: 'CS101',
                    courseName: '計算機概論',
                    teacher: '張教授',
                    semester: '113-1',
                    result: '選課成功'
                },
                {
                    time: '2024-07-15 10:32:00',
                    action: '加選',
                    courseCode: 'CS102',
                    courseName: '程式設計',
                    teacher: '李教授',
                    semester: '113-1',
                    result: '選課成功'
                },
                {
                    time: '2024-07-15 10:35:00',
                    action: '加選',
                    courseCode: 'MATH101',
                    courseName: '微積分',
                    teacher: '王教授',
                    semester: '113-1',
                    result: '選課成功'
                }
            ]
        };
        
        // 當前學生（用於課程表顯示）
        let currentStudent = 'student';

        // 顯示確認模態框
        function showConfirmModal(title, message, onConfirm) {
            console.log('顯示確認模態框:', title, message);
            
            const modal = document.getElementById('confirmModal');
            const modalTitle = document.getElementById('confirmModalTitle');
            const modalMessage = document.getElementById('confirmModalMessage');
            const confirmBtn = document.getElementById('confirmModalConfirm');
            
            if (!modal || !modalTitle || !modalMessage || !confirmBtn) {
                console.error('找不到確認模態框元素');
                return;
            }
            
            modalTitle.innerHTML = `<i class="bi bi-question-circle me-2"></i>${title}`;
            modalMessage.innerHTML = message.replace(/\n/g, '<br>');
            
            // 移除所有現有的事件監聽器
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            // 添加新的事件監聽器
            document.getElementById('confirmModalConfirm').addEventListener('click', function() {
                console.log('確認按鈕被點擊');
                const bootstrapModal = bootstrap.Modal.getInstance(modal);
                if (bootstrapModal) {
                    bootstrapModal.hide();
                }
                onConfirm();
            });
            
            // 顯示模態框
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }

        // 顯示Toast訊息
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = {
                'success': 'bg-success',
                'danger': 'bg-danger',
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-primary';
            
            const iconClass = {
                'success': 'bi-check-circle',
                'danger': 'bi-x-circle',
                'warning': 'bi-exclamation-triangle',
                'info': 'bi-info-circle'
            }[type] || 'bi-info-circle';
            
            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header ${bgClass} text-white">
                        <i class="bi ${iconClass} me-2"></i>
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // 自動移除toast元素
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }

        // 顯示帶操作按鈕的Toast訊息
        function showToastWithAction(type, title, message, actionText, actionCallback) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = {
                'success': 'bg-success',
                'danger': 'bg-danger',
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-primary';
            
            const iconClass = {
                'success': 'bi-check-circle',
                'danger': 'bi-x-circle',
                'warning': 'bi-exclamation-triangle',
                'info': 'bi-info-circle'
            }[type] || 'bi-info-circle';
            
            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="false">
                    <div class="toast-header ${bgClass} text-white">
                        <i class="bi ${iconClass} me-2"></i>
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        <div class="mb-2">${message}</div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="toast">關閉</button>
                            <button type="button" class="btn btn-sm btn-primary" onclick="handleToastAction('${toastId}')">
                                <i class="bi bi-plus-circle me-1"></i>${actionText}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // 儲存回調函數到全域
            window[`toastAction_${toastId}`] = actionCallback;
            
            // 自動移除toast元素和回調函數
            toastElement.addEventListener('hidden.bs.toast', function() {
                delete window[`toastAction_${toastId}`];
                toastElement.remove();
            });
        }

        // 處理Toast操作按鈕點擊
        function handleToastAction(toastId) {
            const callback = window[`toastAction_${toastId}`];
            if (callback && typeof callback === 'function') {
                callback();
                
                // 關閉Toast
                const toastElement = document.getElementById(toastId);
                if (toastElement) {
                    const toast = bootstrap.Toast.getInstance(toastElement);
                    if (toast) {
                        toast.hide();
                    }
                }
            }
        }

        // 處理登入
        async function handleLogin(e) {
            e.preventDefault();
            console.log('開始登入處理');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.getElementById('userType').value;
            
            console.log('登入資料:', { username, userType });
            
            // 顯示登入確認
            const userTypeNames = {
                'student': '學生',
                'teacher': '教師',
                'hr': '人事',
                'admin': '管理員'
            };
            
            const confirmMessage = `確定要以「${userTypeNames[userType]}」身份登入系統嗎？<br><br>帳號：${username}`;
            
            showConfirmModal('確認登入', confirmMessage, async function() {
                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password,
                            userType: userType
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    const result = await response.json();
                    console.log('Response data:', result);
                    
                    if (response.ok && result.success) {
                        currentUser = {
                            username: result.user.username,
                            name: result.user.name,
                            userType: result.user.userType,
                            token: 'mock_token' // 模擬 token
                        };
                        
                        // 設定當前學生（用於課程表）
                        if (result.user.userType === 'student') {
                            currentStudent = result.user.username;
                            // 如果是新學生，初始化選課記錄
                            if (!studentEnrollments[currentStudent]) {
                                studentEnrollments[currentStudent] = {
                                    '113-1': [],
                                    '113-2': [],
                                    '114-1': [],
                                    '114-2': []
                                };
                            }
                        }
                        
                        // 儲存到 localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // 關閉模態框
                        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                        
                        // 更新介面
                        updateUI();
                        
                        // 根據用戶類型自動跳轉
                        if (currentUser.userType === 'admin') {
                            showSection('admin');
                        } else if (currentUser.userType === 'student') {
                            showSection('student');
                        } else if (currentUser.userType === 'teacher') {
                            showSection('staff');
                        } else if (currentUser.userType === 'hr') {
                            showSection('hr');
                        }
                        
                        // 顯示成功訊息
                        showToast('success', '登入成功', `歡迎 ${result.user.name}！`);
                        
                        // 清空表單
                        document.getElementById('loginForm').reset();
                    } else {
                        showToast('danger', '登入失敗', result.message || '帳號、密碼或身份不正確');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showToast('danger', '登入失敗', '連接伺服器失敗');
                }
            });
        }

        // 頁面載入完成後執行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('頁面載入完成');
            
            // 檢查是否有保存的登入狀態
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateUI();
                } catch (error) {
                    console.error('解析用戶資料失敗:', error);
                    localStorage.removeItem('currentUser');
                }
            }

            // 綁定登入表單事件
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('登入表單事件綁定成功');
            } else {
                console.error('找不到登入表單');
            }
            
            // 初始化恐龍動畫
            initDinosaurAnimation();
        });
        
        // 初始化恐龍動畫
        function initDinosaurAnimation() {
            const dinosaur = document.querySelector('.dinosaur');
            const dinosaurContainer = document.querySelector('.dinosaur-container');
            if (!dinosaur || !dinosaurContainer) return;
            
            // 大隻恐龍表情
            const dinosaurEmojis = ['🦖', '🐲', '🦕', '🐊'];
            const fireEmojis = ['🔥', '�', '🌋', '⚡'];
            const roarEmojis = ['�', '💥', '⭐', '💫'];
            
            // 隨機改變恐龍表情
            function changeDinosaurEmoji() {
                const randomEmoji = dinosaurEmojis[Math.floor(Math.random() * dinosaurEmojis.length)];
                dinosaur.textContent = randomEmoji;
            }
            
            // 隨機改變動畫速度
            function randomizeAnimationSpeed() {
                const speeds = ['8s', '10s', '12s', '14s'];
                const randomSpeed = speeds[Math.floor(Math.random() * speeds.length)];
                dinosaur.style.animationDuration = randomSpeed;
            }
            
            // 創建噴火效果
            function createFireEffect() {
                const fire = document.createElement('div');
                fire.className = 'fire-effect';
                fire.textContent = fireEmojis[Math.floor(Math.random() * fireEmojis.length)];
                dinosaurContainer.appendChild(fire);
                
                // 根據恐龍位置調整噴火位置
                const dinosaurRect = dinosaur.getBoundingClientRect();
                const containerRect = dinosaurContainer.getBoundingClientRect();
                fire.style.left = (dinosaurRect.left - containerRect.left + 60) + 'px';
                
                setTimeout(() => {
                    fire.remove();
                }, 1000);
            }
            
            // 創建咆哮效果
            function createRoarEffect() {
                const roar = document.createElement('div');
                roar.className = 'roar-effect';
                roar.textContent = roarEmojis[Math.floor(Math.random() * roarEmojis.length)];
                dinosaurContainer.appendChild(roar);
                
                // 根據恐龍位置調整咆哮位置
                const dinosaurRect = dinosaur.getBoundingClientRect();
                const containerRect = dinosaurContainer.getBoundingClientRect();
                roar.style.left = (dinosaurRect.left - containerRect.left + 30) + 'px';
                
                setTimeout(() => {
                    roar.remove();
                }, 500);
            }
            
            // 每次動畫結束後隨機改變恐龍和速度
            dinosaur.addEventListener('animationiteration', function() {
                changeDinosaurEmoji();
                randomizeAnimationSpeed();
                
                // 隨機觸發噴火效果
                if (Math.random() < 0.3) {
                    createFireEffect();
                }
                
                // 隨機觸發咆哮效果
                if (Math.random() < 0.2) {
                    createRoarEffect();
                }
            });
            
            // 初始隨機設置
            changeDinosaurEmoji();
            randomizeAnimationSpeed();
            
            // 添加點擊事件讓恐龍跳躍並噴火
            dinosaur.addEventListener('click', function() {
                dinosaur.style.animation = 'dinosaurJump 0.6s ease-in-out';
                createFireEffect();
                createRoarEffect();
                
                setTimeout(() => {
                    dinosaur.style.animation = `dinosaurWalk ${dinosaur.style.animationDuration || '10s'} linear infinite`;
                }, 600);
            });
            
            // 隨機噴火定時器
            setInterval(() => {
                if (Math.random() < 0.15) {
                    createFireEffect();
                }
            }, 3000);
            
            // 隨機咆哮定時器
            setInterval(() => {
                if (Math.random() < 0.1) {
                    createRoarEffect();
                }
            }, 5000);
        }

        // 登出函數
        function logout() {
            console.log('logout函數被呼叫');
            if (!currentUser) {
                console.log('沒有當前使用者，退出登出函數');
                return;
            }
            
            const userTypeNames = {
                'student': '學生',
                'teacher': '教師',
                'hr': '人事',
                'admin': '管理員'
            };
            
            const confirmMessage = `確定要登出系統嗎？<br><br>目前登入身份：${userTypeNames[currentUser.userType]}<br>使用者：${currentUser.name}`;
            
            console.log('準備顯示確認對話框');
            showConfirmModal('確認登出', confirmMessage, function() {
                console.log('確認登出，開始清除資料');
                // 清除使用者資料
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // 更新介面
                updateUI();
                
                // 返回首頁
                showSection('home');
                
                // 顯示登出成功訊息
                showToast('info', '登出成功', '您已成功登出系統');
            });
        }

        // 更新UI
        function updateUI() {
            console.log('更新UI:', currentUser);
            const loginBtn = document.getElementById('login-btn');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const homeGuest = document.getElementById('home-guest');
            const homeUser = document.getElementById('home-user');
            
            if (currentUser) {
                // 隱藏登入按鈕，顯示使用者資訊
                loginBtn.style.display = 'none';
                userInfo.style.display = 'flex';
                userName.textContent = currentUser.name;
                
                // 首頁內容切換：顯示使用者模式，隱藏訪客模式
                if (homeGuest && homeUser) {
                    homeGuest.style.display = 'none';
                    homeUser.style.display = 'block';
                }
                
                // 顯示對應的導覽選項
                document.getElementById('nav-student').style.display = 'none';
                document.getElementById('nav-staff').style.display = 'none';
                document.getElementById('nav-hr').style.display = 'none';
                document.getElementById('nav-admin').style.display = 'none';
                
                if (currentUser.userType === 'student') {
                    document.getElementById('nav-student').style.display = 'block';
                } else if (currentUser.userType === 'teacher') {
                    document.getElementById('nav-staff').style.display = 'block';
                } else if (currentUser.userType === 'admin') {
                    document.getElementById('nav-admin').style.display = 'block';
                } else if (currentUser.userType === 'hr') {
                    document.getElementById('nav-hr').style.display = 'block';
                }
            } else {
                // 顯示登入按鈕，隱藏使用者資訊
                loginBtn.style.display = 'block';
                userInfo.style.display = 'none';
                
                // 首頁內容切換：顯示訪客模式，隱藏使用者模式
                if (homeGuest && homeUser) {
                    homeGuest.style.display = 'block';
                    homeUser.style.display = 'none';
                }
                
                // 隱藏所有導覽選項
                document.getElementById('nav-student').style.display = 'none';
                document.getElementById('nav-staff').style.display = 'none';
                document.getElementById('nav-hr').style.display = 'none';
                document.getElementById('nav-admin').style.display = 'none';
            }
        }

        // 顯示快速操作
        function showQuickActions() {
            if (!currentUser) {
                showToast('warning', '請先登入', '請先登入後再使用功能');
                return;
            }
            
            // 根據使用者類型顯示快速操作選項
            let quickActions = [];
            if (currentUser.userType === 'student') {
                quickActions = [
                    { id: 'student-info', name: '基本資料查詢', icon: 'bi-person-vcard' },
                    { id: 'student-schedule', name: '課程表查詢', icon: 'bi-calendar3' },
                    { id: 'student-grades', name: '成績查詢', icon: 'bi-bar-chart-line' }
                ];
            } else if (currentUser.userType === 'teacher') {
                quickActions = [
                    { id: 'staff-courses', name: '課程管理', icon: 'bi-book' },
                    { id: 'staff-grades', name: '成績管理', icon: 'bi-clipboard-data' },
                    { id: 'staff-schedule', name: '課程表管理', icon: 'bi-calendar-week' }
                ];
            } else if (currentUser.userType === 'admin') {
                quickActions = [
                    { id: 'admin-users', name: '用戶管理', icon: 'bi-people' },
                    { id: 'admin-courses', name: '課程管理', icon: 'bi-book' },
                    { id: 'admin-system', name: '系統設定', icon: 'bi-gear' }
                ];
            } else if (currentUser.userType === 'hr') {
                quickActions = [
                    { id: 'hr-employees', name: '員工管理', icon: 'bi-person-badge' },
                    { id: 'hr-departments', name: '部門管理', icon: 'bi-building' },
                    { id: 'hr-reports', name: '報表管理', icon: 'bi-file-earmark-text' }
                ];
            }
            
            // 創建快速操作選單
            let actionsList = quickActions.map(action => 
                `<div class="list-group-item list-group-item-action" onclick="showFeature('${action.id}'); dismissQuickActions();">
                    <i class="${action.icon} me-2"></i>${action.name}
                </div>`
            ).join('');
            
            // 使用確認模態框顯示快速操作
            const modal = document.getElementById('confirmModal');
            const modalTitle = document.getElementById('confirmModalTitle');
            const modalMessage = document.getElementById('confirmModalMessage');
            const confirmBtn = document.getElementById('confirmModalConfirm');
            
            modalTitle.innerHTML = '<i class="bi bi-lightning-fill me-2"></i>快速操作';
            modalMessage.innerHTML = `
                <div class="list-group">
                    ${actionsList}
                </div>
            `;
            
            // 隱藏確認按鈕
            confirmBtn.style.display = 'none';
            
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            
            // 當模態框關閉時恢復確認按鈕
            modal.addEventListener('hidden.bs.modal', function() {
                confirmBtn.style.display = 'block';
            }, { once: true });
        }
        
        // 關閉快速操作模態框
        function dismissQuickActions() {
            const modal = document.getElementById('confirmModal');
            const bootstrapModal = bootstrap.Modal.getInstance(modal);
            if (bootstrapModal) {
                bootstrapModal.hide();
            }
        }
        
        // 前往個人專區
        function gotoUserSection() {
            if (!currentUser) {
                showToast('warning', '請先登入', '請先登入後再使用功能');
                return;
            }
            
            // 根據使用者類型前往對應專區
            let sectionId = '';
            if (currentUser.userType === 'student') {
                sectionId = 'student';
            } else if (currentUser.userType === 'teacher') {
                sectionId = 'staff';
            } else if (currentUser.userType === 'admin') {
                sectionId = 'admin';
            } else if (currentUser.userType === 'hr') {
                sectionId = 'hr';
            }
            
            if (sectionId) {
                showSection(sectionId);
            }
        }

        // 顯示區塊
        function showSection(sectionId) {
            console.log('顯示區塊:', sectionId);
            
            // 添加淡出動畫
            const currentSection = document.querySelector('.content-section[style*="block"]');
            if (currentSection) {
                currentSection.style.animation = 'fadeOut 0.3s ease-in-out';
                setTimeout(() => {
                    currentSection.style.display = 'none';
                    currentSection.style.animation = '';
                }, 300);
            }
            
            // 延遲顯示新區塊
            setTimeout(() => {
                // 隱藏所有區塊
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => {
                    section.style.display = 'none';
                });
                
                // 顯示指定區塊
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.style.animation = 'pageSlideIn 0.6s ease-out';
                }
                
                // 隱藏功能區域
                document.getElementById('feature-area').style.display = 'none';
            }, 300);
        }

        // 顯示功能
        function showFeature(featureId) {
            console.log('顯示功能:', featureId);
            console.log('當前用戶:', currentUser);
            
            if (!currentUser) {
                console.log('用戶未登入，顯示登入提示');
                showToast('warning', '請先登入', '請先登入後再使用功能');
                return;
            }
            
            console.log('隱藏所有區塊');
            // 添加淡出動畫
            const currentSection = document.querySelector('.content-section[style*="block"]');
            if (currentSection) {
                currentSection.style.animation = 'fadeOut 0.3s ease-in-out';
                setTimeout(() => {
                    currentSection.style.display = 'none';
                    currentSection.style.animation = '';
                }, 300);
            }
            
            // 延遲顯示功能區域
            setTimeout(() => {
                // 隱藏所有區塊
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => {
                    section.style.display = 'none';
                });
                
                console.log('顯示功能區域');
                // 顯示功能區域
                const featureArea = document.getElementById('feature-area');
                featureArea.style.display = 'block';
                featureArea.style.animation = 'pageSlideIn 0.6s ease-out';
                
                console.log('載入功能內容');
                // 載入功能內容
                loadFeatureContent(featureId);
            }, 300);
        }

        // 載入功能內容
        function loadFeatureContent(featureId) {
            const content = document.getElementById('feature-content');
            
            switch(featureId) {
                case 'student-info':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-person me-2"></i>基本資料</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>姓名:</strong> ${currentUser.name}</p>
                                <p><strong>帳號:</strong> ${currentUser.username}</p>
                                <p><strong>身份:</strong> ${currentUser.userType}</p>
                                <p><strong>狀態:</strong> 正常</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'student-schedule':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="bi bi-calendar3 me-2"></i>課程表</h5>
                                <div class="btn-group">
                                    <select class="form-select" id="schedule-semester" onchange="loadStudentSchedule()">
                                        <option value="113-1">113學年度第1學期</option>
                                        <option value="113-2">113學年度第2學期</option>
                                        <option value="114-1">114學年度第1學期</option>
                                        <option value="114-2">114學年度第2學期</option>
                                    </select>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="exportSchedule()">
                                        <i class="bi bi-download me-1"></i>匯出課表
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- 課表統計 -->
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle me-2"></i>
                                            總學分：<span id="total-schedule-credits">7</span>學分 | 
                                            總課程：<span id="total-schedule-courses">3</span>門 | 
                                            上課時數：<span id="total-schedule-hours">9</span>小時 | 
                                            空閒時段：<span id="free-periods">32</span>節
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="schedule-table">
                                        <thead class="table-dark">
                                            <tr>
                                                <th style="width: 80px;">節次</th>
                                                <th style="width: 100px;">時間</th>
                                                <th style="width: 150px;">星期一</th>
                                                <th style="width: 150px;">星期二</th>
                                                <th style="width: 150px;">星期三</th>
                                                <th style="width: 150px;">星期四</th>
                                                <th style="width: 150px;">星期五</th>
                                                <th style="width: 150px;">星期六</th>
                                                <th style="width: 150px;">星期日</th>
                                            </tr>
                                        </thead>
                                        <tbody id="schedule-body">
                                            <!-- 課表內容將動態載入 -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- 課程詳細資訊 -->
                                <div class="row mt-4">
                                    <div class="col-md-12">
                                        <h6><i class="bi bi-list-ul me-2"></i>已選課程詳細資訊</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-striped">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>課程代碼</th>
                                                        <th>課程名稱</th>
                                                        <th>教師</th>
                                                        <th>學分</th>
                                                        <th>時間</th>
                                                        <th>教室</th>
                                                        <th>類別</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="enrolled-courses-detail">
                                                    <!-- 課程詳細資訊將動態載入 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 初始化課程表
                    setTimeout(() => {
                        loadStudentSchedule();
                    }, 100);
                    break;
                case 'student-grades':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-clipboard-data me-2"></i>成績查詢</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>課程名稱</th>
                                                <th>學分</th>
                                                <th>成績</th>
                                                <th>等第</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>程式設計基礎</td>
                                                <td>3</td>
                                                <td>85</td>
                                                <td>A</td>
                                            </tr>
                                            <tr>
                                                <td>資料結構</td>
                                                <td>3</td>
                                                <td>78</td>
                                                <td>B+</td>
                                            </tr>
                                            <tr>
                                                <td>微積分</td>
                                                <td>4</td>
                                                <td>92</td>
                                                <td>A+</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'student-enrollment':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-journal-plus me-2"></i>選課系統</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <select class="form-select" id="semester-select">
                                            <option value="">所有學期</option>
                                            <option value="113-1">113學年度第1學期</option>
                                            <option value="113-2">113學年度第2學期</option>
                                            <option value="114-1">114學年度第1學期</option>
                                            <option value="114-2">114學年度第2學期</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="college-filter-student">
                                            <option value="">所有學院</option>
                                            <option value="工學院">工學院</option>
                                            <option value="理學院">理學院</option>
                                            <option value="文學院">文學院</option>
                                            <option value="商學院">商學院</option>
                                            <option value="醫學院">醫學院</option>
                                            <option value="社會科學院">社會科學院</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="department-filter-student">
                                            <option value="">所有系所</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" id="course-search" placeholder="搜尋課程名稱或教師...">
                                    </div>
                                </div>
                                
                                <!-- 選課統計 -->
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle me-2"></i>
                                            已選學分：<span id="total-credits">6</span>/25 學分 | 
                                            已選課程：<span id="total-courses">2</span>/8 門 | 
                                            選課期間：2024/01/15 - 2024/01/25
                                        </div>
                                    </div>
                                </div>

                                <!-- 標籤頁 -->
                                <ul class="nav nav-tabs mb-3" id="enrollment-tabs">
                                    <li class="nav-item">
                                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#available-courses">
                                            <i class="bi bi-search me-1"></i>可選課程
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#enrolled-courses">
                                            <i class="bi bi-check-circle me-1"></i>已選課程 <span class="badge bg-primary ms-1" id="enrolled-count">2</span>
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#enrollment-history">
                                            <i class="bi bi-clock-history me-1"></i>選課紀錄
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content">
                                    <!-- 可選課程 -->
                                    <div class="tab-pane fade show active" id="available-courses">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th style="width: 120px;">課程代碼</th>
                                                        <th>課程名稱</th>
                                                        <th style="width: 100px;">教師</th>
                                                        <th style="width: 60px;">學分</th>
                                                        <th style="width: 200px;">時間地點</th>
                                                        <th style="width: 140px;">選課狀況</th>
                                                        <th style="width: 80px;">狀態</th>
                                                        <th style="width: 120px;">操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="available-courses-list">
                                                    <!-- 課程列表將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 已選課程 -->
                                    <div class="tab-pane fade" id="enrolled-courses">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-success">
                                                    <tr>
                                                        <th>課程代碼</th>
                                                        <th>課程名稱</th>
                                                        <th>教師</th>
                                                        <th>學分</th>
                                                        <th>時間</th>
                                                        <th>類別</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="enrolled-courses-list">
                                                    <!-- 已選課程列表將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 選課紀錄 -->
                                    <div class="tab-pane fade" id="enrollment-history">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-info">
                                                    <tr>
                                                        <th>時間</th>
                                                        <th>操作</th>
                                                        <th>課程代碼</th>
                                                        <th>課程名稱</th>
                                                        <th>教師</th>
                                                        <th>結果</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="enrollment-history-list">
                                                    <!-- 選課紀錄將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 初始化選課系統
                    setTimeout(() => {
                        initEnrollmentSystem();
                    }, 100);
                    break;
                case 'student-fees':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-credit-card me-2"></i>學雜費查詢</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select">
                                            <option>113學年度第1學期</option>
                                            <option>113學年度第2學期</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="alert alert-success">
                                    <i class="bi bi-check-circle me-2"></i>113學年度第1學期學雜費已繳清
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>項目</th>
                                                <th>金額</th>
                                                <th>狀態</th>
                                                <th>繳費日期</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>學費</td>
                                                <td>NT$ 45,000</td>
                                                <td><span class="badge bg-success">已繳費</span></td>
                                                <td>2024-01-15</td>
                                            </tr>
                                            <tr>
                                                <td>雜費</td>
                                                <td>NT$ 8,500</td>
                                                <td><span class="badge bg-success">已繳費</span></td>
                                                <td>2024-01-15</td>
                                            </tr>
                                            <tr>
                                                <td>實驗費</td>
                                                <td>NT$ 2,000</td>
                                                <td><span class="badge bg-success">已繳費</span></td>
                                                <td>2024-01-15</td>
                                            </tr>
                                            <tr class="table-info">
                                                <td><strong>總計</strong></td>
                                                <td><strong>NT$ 55,500</strong></td>
                                                <td><span class="badge bg-success">已繳清</span></td>
                                                <td>2024-01-15</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'student-activities':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-calendar-event me-2"></i>活動報名系統</h5>
                            </div>
                            <div class="card-body">
                                <!-- 篩選和搜尋 -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <select class="form-select" id="activity-category-filter">
                                            <option value="">全部活動</option>
                                            <option value="academic">學術活動</option>
                                            <option value="club">社團活動</option>
                                            <option value="sports">體育活動</option>
                                            <option value="cultural">文化活動</option>
                                            <option value="volunteer">志工服務</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="activity-status-filter">
                                            <option value="">全部狀態</option>
                                            <option value="open">開放報名</option>
                                            <option value="registered">已報名</option>
                                            <option value="closed">報名截止</option>
                                            <option value="full">人數額滿</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="activity-search" placeholder="搜尋活動名稱、地點或主辦單位...">
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-secondary w-100" onclick="resetActivityFilters()">
                                            <i class="bi bi-arrow-clockwise me-1"></i>重置
                                        </button>
                                    </div>
                                </div>

                                <!-- 活動統計 -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle me-2"></i>
                                            已報名活動：<span id="registered-activities-count">3</span> 個 | 
                                            可報名活動：<span id="available-activities-count">8</span> 個 | 
                                            本月活動：<span id="monthly-activities-count">15</span> 個
                                        </div>
                                    </div>
                                </div>

                                <!-- 標籤頁 -->
                                <ul class="nav nav-tabs mb-3" id="activities-tabs">
                                    <li class="nav-item">
                                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#all-activities">
                                            <i class="bi bi-calendar3 me-1"></i>所有活動
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#my-activities">
                                            <i class="bi bi-person-check me-1"></i>我的活動 <span class="badge bg-primary ms-1" id="my-activities-count">3</span>
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#activity-history">
                                            <i class="bi bi-clock-history me-1"></i>參與紀錄
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content">
                                    <!-- 所有活動 -->
                                    <div class="tab-pane fade show active" id="all-activities">
                                        <div id="activities-grid" class="row g-3">
                                            <!-- 活動卡片將通過 JavaScript 動態生成 -->
                                        </div>
                                    </div>

                                    <!-- 我的活動 -->
                                    <div class="tab-pane fade" id="my-activities">
                                        <div id="my-activities-list">
                                            <!-- 我的活動列表將通過 JavaScript 動態生成 -->
                                        </div>
                                    </div>

                                    <!-- 參與紀錄 -->
                                    <div class="tab-pane fade" id="activity-history">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th>活動名稱</th>
                                                        <th>報名時間</th>
                                                        <th>活動時間</th>
                                                        <th>參與狀態</th>
                                                        <th>評分</th>
                                                        <th>證書</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="activity-history-list">
                                                    <!-- 參與紀錄將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 初始化活動報名系統
                    setTimeout(() => {
                        initActivitySystem();
                    }, 100);
                    break;
                case 'student-announcements':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-megaphone me-2"></i>公告查詢</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select">
                                            <option>全部公告</option>
                                            <option>教務公告</option>
                                            <option>學務公告</option>
                                            <option>系所公告</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋公告...">
                                    </div>
                                </div>
                                <div class="list-group">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">113學年度第2學期選課公告</h6>
                                            <small class="text-danger">重要</small>
                                        </div>
                                        <p class="mb-1">第二學期選課時間為2024年1月15日至1月25日，請同學們把握時間完成選課。</p>
                                        <small class="text-muted">教務處 - 2024-01-10</small>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">期末考試時間表公布</h6>
                                            <small class="text-warning">一般</small>
                                        </div>
                                        <p class="mb-1">113學年度第1學期期末考試時間表已公布，請至教務系統查詢。</p>
                                        <small class="text-muted">教務處 - 2024-01-08</small>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">圖書館新年度開放時間</h6>
                                            <small class="text-info">通知</small>
                                        </div>
                                        <p class="mb-1">圖書館新年度開放時間調整，平日8:00-22:00，假日9:00-17:00。</p>
                                        <small class="text-muted">圖書館 - 2024-01-05</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'student-documents':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-file-earmark-text me-2"></i>文件申請</h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">成績單申請</h6>
                                                <p class="card-text">申請正式成績單，可選擇中文或英文版本</p>
                                                <button class="btn btn-primary btn-sm" onclick="showDocumentApplication('transcript')">申請成績單</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">在學證明</h6>
                                                <p class="card-text">申請在學證明文件，證明學生身份</p>
                                                <button class="btn btn-primary btn-sm" onclick="showDocumentApplication('enrollment')">申請在學證明</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">畢業證書</h6>
                                                <p class="card-text">申請畢業證書影本或英文版本</p>
                                                <button class="btn btn-primary btn-sm" onclick="showDocumentApplication('diploma')">申請畢業證書</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title">修課證明</h6>
                                                <p class="card-text">申請特定課程的修課證明</p>
                                                <button class="btn btn-primary btn-sm" onclick="showDocumentApplication('course')">申請修課證明</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <h6>申請記錄</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>申請日期</th>
                                                <th>文件類型</th>
                                                <th>語言版本</th>
                                                <th>狀態</th>
                                                <th>預計完成</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="document-applications-list">
                                            <!-- 動態載入申請記錄 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    // 初始化文件申請系統
                    loadDocumentApplications();
                    break;
                case 'student-library':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-book me-2"></i>圖書館服務系統</h5>
                            </div>
                            <div class="card-body">
                                <!-- 搜尋區域 -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="book-search-input" placeholder="搜尋書籍、作者、ISBN...">
                                            <select class="form-select" id="search-category" style="max-width: 150px;">
                                                <option value="all">全部</option>
                                                <option value="title">書名</option>
                                                <option value="author">作者</option>
                                                <option value="isbn">ISBN</option>
                                                <option value="subject">主題</option>
                                                <option value="publisher">出版社</option>
                                                <option value="keywords">關鍵字</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-primary w-100" onclick="searchBooks()">
                                            <i class="bi bi-search me-1"></i>搜尋
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-secondary w-100" onclick="showAdvancedSearch()">
                                            <i class="bi bi-funnel me-1"></i>進階搜尋
                                        </button>
                                    </div>
                                </div>

                                <!-- 快速統計 -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle me-2"></i>
                                            目前借閱：<span id="current-borrowed-count">3</span> 本 | 
                                            可借額度：<span id="borrow-limit">10</span> 本 | 
                                            預約中：<span id="reserved-count">2</span> 本 | 
                                            逾期：<span id="overdue-count">1</span> 本
                                        </div>
                                    </div>
                                </div>

                                <!-- 標籤頁 -->
                                <ul class="nav nav-tabs mb-3" id="library-tabs">
                                    <li class="nav-item">
                                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#search-results">
                                            <i class="bi bi-search me-1"></i>館藏查詢
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#my-books">
                                            <i class="bi bi-book me-1"></i>我的借閱 <span class="badge bg-primary ms-1" id="my-books-count">3</span>
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reservations">
                                            <i class="bi bi-bookmark me-1"></i>預約管理 <span class="badge bg-info ms-1" id="reservations-count">2</span>
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#wishlist">
                                            <i class="bi bi-heart me-1"></i>收藏清單 <span class="badge bg-warning ms-1" id="wishlist-count">0</span>
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#history">
                                            <i class="bi bi-clock-history me-1"></i>借閱歷史
                                        </button>
                                    </li>
                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#services">
                                            <i class="bi bi-gear me-1"></i>圖書館服務
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content">
                                    <!-- 館藏查詢 -->
                                    <div class="tab-pane fade show active" id="search-results">
                                        <div id="search-results-container">
                                            <div class="text-center py-4">
                                                <i class="bi bi-search display-4 text-muted"></i>
                                                <h5 class="mt-3 text-muted">請輸入關鍵字搜尋館藏</h5>
                                                <p class="text-muted">我們的圖書館擁有豐富的館藏資源</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 我的借閱 -->
                                    <div class="tab-pane fade" id="my-books">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th>書名</th>
                                                        <th>作者</th>
                                                        <th>借閱日期</th>
                                                        <th>應還日期</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="borrowed-books-list">
                                                    <!-- 借閱書籍列表將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 預約管理 -->
                                    <div class="tab-pane fade" id="reservations">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-info">
                                                    <tr>
                                                        <th>書名</th>
                                                        <th>作者</th>
                                                        <th>預約日期</th>
                                                        <th>預計可取書</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="reserved-books-list">
                                                    <!-- 預約書籍列表將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 收藏清單 -->
                                    <div class="tab-pane fade" id="wishlist">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6><i class="bi bi-heart-fill text-danger me-2"></i>我的收藏書單</h6>
                                            <button class="btn btn-outline-danger btn-sm" onclick="clearWishlist()">
                                                <i class="bi bi-trash me-1"></i>清空收藏
                                            </button>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-warning">
                                                    <tr>
                                                        <th>書名</th>
                                                        <th>作者</th>
                                                        <th>收藏日期</th>
                                                        <th>館藏狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="wishlist-books-list">
                                                    <!-- 收藏書籍列表將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 借閱歷史 -->
                                    <div class="tab-pane fade" id="history">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <select class="form-select" id="history-filter">
                                                    <option value="all">全部記錄</option>
                                                    <option value="returned">已歸還</option>
                                                    <option value="overdue">曾逾期</option>
                                                    <option value="renewed">曾續借</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="month" class="form-control" id="history-month" value="2025-07">
                                            </div>
                                            <div class="col-md-4">
                                                <button class="btn btn-outline-primary w-100" onclick="filterHistory()">
                                                    <i class="bi bi-funnel me-1"></i>篩選
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-secondary">
                                                    <tr>
                                                        <th>書名</th>
                                                        <th>借閱日期</th>
                                                        <th>歸還日期</th>
                                                        <th>續借次數</th>
                                                        <th>狀態</th>
                                                        <th>評分</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="borrow-history-list">
                                                    <!-- 借閱歷史將通過 JavaScript 動態生成 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 圖書館服務 -->
                                    <div class="tab-pane fade" id="services">
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <div class="card border-primary">
                                                    <div class="card-header bg-primary text-white">
                                                        <h6 class="mb-0"><i class="bi bi-clock me-2"></i>開放時間</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <ul class="list-unstyled mb-0">
                                                            <li><strong>週一至週五：</strong>08:00 - 22:00</li>
                                                            <li><strong>週六：</strong>09:00 - 18:00</li>
                                                            <li><strong>週日：</strong>09:00 - 17:00</li>
                                                            <li><strong>例假日：</strong>依公告調整</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card border-info">
                                                    <div class="card-header bg-info text-white">
                                                        <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>借閱規則</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <ul class="list-unstyled mb-0">
                                                            <li><strong>借閱期限：</strong>14天</li>
                                                            <li><strong>續借次數：</strong>最多2次</li>
                                                            <li><strong>借閱上限：</strong>10本</li>
                                                            <li><strong>逾期罰款：</strong>每日每本1元</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card border-success">
                                                    <div class="card-header bg-success text-white">
                                                        <h6 class="mb-0"><i class="bi bi-telephone me-2"></i>聯絡資訊</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <ul class="list-unstyled mb-0">
                                                            <li><strong>服務台：</strong>02-1234-5678 #101</li>
                                                            <li><strong>參考諮詢：</strong>02-1234-5678 #102</li>
                                                            <li><strong>Email：</strong>library@school.edu.tw</li>
                                                            <li><strong>位置：</strong>圖書館1樓服務台</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card border-warning">
                                                    <div class="card-header bg-warning text-dark">
                                                        <h6 class="mb-0"><i class="bi bi-tools me-2"></i>線上服務</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="d-grid gap-2">
                                                            <button class="btn btn-outline-primary btn-sm" onclick="showSeatingReservation()">
                                                                <i class="bi bi-person-workspace me-1"></i>座位預約
                                                            </button>
                                                            <button class="btn btn-outline-info btn-sm" onclick="showStudyRoomBooking()">
                                                                <i class="bi bi-door-open me-1"></i>討論室預約
                                                            </button>
                                                            <button class="btn btn-outline-success btn-sm" onclick="showDocumentDelivery()">
                                                                <i class="bi bi-file-text me-1"></i>文獻傳遞
                                                            </button>
                                                            <button class="btn btn-outline-warning btn-sm" onclick="showLibraryNews()">
                                                                <i class="bi bi-newspaper me-1"></i>最新消息
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 初始化圖書館系統
                    setTimeout(() => {
                        initLibrarySystem();
                    }, 100);
                    break;
                case 'staff-info':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-person-badge me-2"></i>教職員基本資料</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>姓名:</strong> ${currentUser.name}</p>
                                <p><strong>帳號:</strong> ${currentUser.username}</p>
                                <p><strong>身份:</strong> ${currentUser.userType}</p>
                                <p><strong>職稱:</strong> 助理教授</p>
                                <p><strong>系所:</strong> 資訊工程系</p>
                                <p><strong>辦公室:</strong> E301</p>
                                <p><strong>分機:</strong> 1234</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-courses':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="bi bi-book me-2"></i>課程管理</h5>
                                <div class="btn-group">
                                    <button class="btn btn-primary btn-sm" onclick="addNewCourse()">
                                        <i class="bi bi-plus-circle me-1"></i>新增課程
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="exportCourseData()">
                                        <i class="bi bi-download me-1"></i>匯出資料
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- 篩選和搜尋區域 -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <label class="form-label">搜尋課程</label>
                                        <input type="text" class="form-control" id="course-search" placeholder="課程名稱、代碼或教師">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">學院</label>
                                        <select class="form-select" id="college-filter">
                                            <option value="">全部學院</option>
                                            <option value="工學院">工學院</option>
                                            <option value="理學院">理學院</option>
                                            <option value="文學院">文學院</option>
                                            <option value="商學院">商學院</option>
                                            <option value="醫學院">醫學院</option>
                                            <option value="社會科學院">社會科學院</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">系所</label>
                                        <select class="form-select" id="department-filter">
                                            <option value="">全部系所</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">學期</label>
                                        <select class="form-select" id="semester-filter">
                                            <option value="">全部學期</option>
                                            <option value="113-1">113學年第1學期</option>
                                            <option value="113-2">113學年第2學期</option>
                                            <option value="114-1">114學年第1學期</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">課程狀態</label>
                                        <select class="form-select" id="status-filter">
                                            <option value="">全部狀態</option>
                                            <option value="開放選課">開放選課</option>
                                            <option value="已額滿">已額滿</option>
                                            <option value="停開">停開</option>
                                            <option value="已結束">已結束</option>
                                        </select>
                                    </div>
                                    <div class="col-md-1">
                                        <label class="form-label">&nbsp;</label>
                                        <button class="btn btn-outline-secondary w-100" onclick="resetCourseFilters()">
                                            <i class="bi bi-arrow-clockwise"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- 統計資訊 -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body text-center">
                                                <h3 id="total-courses-count">0</h3>
                                                <small>總課程數</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h3 id="active-courses-count">0</h3>
                                                <small>進行中課程</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <h3 id="full-courses-count">0</h3>
                                                <small>額滿課程</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-info text-white">
                                            <div class="card-body text-center">
                                                <h3 id="total-students-count">0</h3>
                                                <small>總選課人數</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 課程表格 -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>課程資訊</th>
                                                <th>時間地點</th>
                                                <th>選課狀況</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="staff-courses-list">
                                            <!-- 動態載入課程列表 -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 分頁 -->
                                <nav>
                                    <ul class="pagination justify-content-center" id="courses-pagination">
                                        <!-- 動態載入分頁 -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    `;
                    // 初始化教職員課程管理系統
                    setTimeout(() => {
                        initStaffCourseSystem();
                    }, 100);
                    break;
                case 'staff-grades':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-clipboard-data me-2"></i>成績管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">選擇課程:</label>
                                    <select class="form-select">
                                        <option>程式設計基礎 (CS101)</option>
                                        <option>資料結構 (CS201)</option>
                                    </select>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>學號</th>
                                                <th>姓名</th>
                                                <th>平時成績</th>
                                                <th>期中成績</th>
                                                <th>期末成績</th>
                                                <th>總成績</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>S001</td>
                                                <td>王小明</td>
                                                <td>85</td>
                                                <td>78</td>
                                                <td>92</td>
                                                <td>85</td>
                                            </tr>
                                            <tr>
                                                <td>S002</td>
                                                <td>李小華</td>
                                                <td>78</td>
                                                <td>82</td>
                                                <td>75</td>
                                                <td>78</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-schedule':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-calendar-week me-2"></i>課表查詢</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select">
                                            <option>113學年度第1學期</option>
                                            <option>113學年度第2學期</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>時間</th>
                                                <th>星期一</th>
                                                <th>星期二</th>
                                                <th>星期三</th>
                                                <th>星期四</th>
                                                <th>星期五</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>08:10-09:00</td>
                                                <td></td>
                                                <td class="table-info">程式設計基礎<br>A101</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>09:10-10:00</td>
                                                <td></td>
                                                <td class="table-info">程式設計基礎<br>A101</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>10:10-11:00</td>
                                                <td></td>
                                                <td class="table-info">程式設計基礎<br>A101</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>11:10-12:00</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td class="table-warning">資料結構<br>E201</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>13:20-14:10</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td class="table-warning">資料結構<br>E201</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>14:20-15:10</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td class="table-warning">資料結構<br>E201</td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-students':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-people me-2"></i>學生管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select">
                                            <option>程式設計基礎 (CS101)</option>
                                            <option>資料結構 (CS201)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋學生...">
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>學號</th>
                                                <th>姓名</th>
                                                <th>系所</th>
                                                <th>年級</th>
                                                <th>Email</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>S001</td>
                                                <td>王小明</td>
                                                <td>資訊工程系</td>
                                                <td>大一</td>
                                                <td>s001@example.com</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">詳細</button>
                                                    <button class="btn btn-sm btn-warning">聯絡</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>S002</td>
                                                <td>李小華</td>
                                                <td>資訊工程系</td>
                                                <td>大一</td>
                                                <td>s002@example.com</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">詳細</button>
                                                    <button class="btn btn-sm btn-warning">聯絡</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>S003</td>
                                                <td>張小美</td>
                                                <td>資訊工程系</td>
                                                <td>大一</td>
                                                <td>s003@example.com</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">詳細</button>
                                                    <button class="btn btn-sm btn-warning">聯絡</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-attendance':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-clipboard-check me-2"></i>出缺勤管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>程式設計基礎 (CS101)</option>
                                            <option>資料結構 (CS201)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="date" class="form-control" value="2024-01-15">
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">點名</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>學號</th>
                                                <th>姓名</th>
                                                <th>出席狀態</th>
                                                <th>備註</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>S001</td>
                                                <td>王小明</td>
                                                <td>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S001" id="present_S001" checked>
                                                        <label class="form-check-label text-success" for="present_S001">出席</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S001" id="absent_S001">
                                                        <label class="form-check-label text-danger" for="absent_S001">缺席</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S001" id="late_S001">
                                                        <label class="form-check-label text-warning" for="late_S001">遲到</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control form-control-sm" placeholder="備註"></td>
                                            </tr>
                                            <tr>
                                                <td>S002</td>
                                                <td>李小華</td>
                                                <td>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S002" id="present_S002" checked>
                                                        <label class="form-check-label text-success" for="present_S002">出席</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S002" id="absent_S002">
                                                        <label class="form-check-label text-danger" for="absent_S002">缺席</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="attendance_S002" id="late_S002">
                                                        <label class="form-check-label text-warning" for="late_S002">遲到</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control form-control-sm" placeholder="備註"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-success">儲存出缺勤</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-announcements':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-megaphone me-2"></i>發布公告</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>新增公告</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">公告標題</label>
                                                    <input type="text" class="form-control" placeholder="請輸入公告標題">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">公告類型</label>
                                                    <select class="form-select">
                                                        <option>一般公告</option>
                                                        <option>重要公告</option>
                                                        <option>緊急公告</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">適用課程</label>
                                                    <select class="form-select">
                                                        <option>全部課程</option>
                                                        <option>程式設計基礎 (CS101)</option>
                                                        <option>資料結構 (CS201)</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">公告內容</label>
                                                    <textarea class="form-control" rows="5" placeholder="請輸入公告內容"></textarea>
                                                </div>
                                                <button class="btn btn-primary">發布公告</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>我的公告</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item">
                                                        <h6 class="mb-1">期中考試公告</h6>
                                                        <p class="mb-1 small">程式設計基礎期中考試時間...</p>
                                                        <small class="text-muted">2024-01-10</small>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <h6 class="mb-1">作業繳交提醒</h6>
                                                        <p class="mb-1 small">請同學們記得繳交作業...</p>
                                                        <small class="text-muted">2024-01-08</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-reports':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-file-earmark-bar-graph me-2"></i>報表查詢</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>程式設計基礎 (CS101)</option>
                                            <option>資料結構 (CS201)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>成績分析</option>
                                            <option>出缺勤統計</option>
                                            <option>學習狀況</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">生成報表</button>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>成績分佈</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-3">
                                                        <div class="badge bg-success p-2">A級<br>12人</div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="badge bg-info p-2">B級<br>15人</div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="badge bg-warning p-2">C級<br>8人</div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="badge bg-danger p-2">D級<br>3人</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>出席率統計</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-success" style="width: 85%">85%</div>
                                                </div>
                                                <small class="text-muted">平均出席率</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive mt-3">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>學號</th>
                                                <th>姓名</th>
                                                <th>平均成績</th>
                                                <th>出席率</th>
                                                <th>作業完成率</th>
                                                <th>學習狀況</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>S001</td>
                                                <td>王小明</td>
                                                <td>85</td>
                                                <td>95%</td>
                                                <td>100%</td>
                                                <td><span class="badge bg-success">優秀</span></td>
                                            </tr>
                                            <tr>
                                                <td>S002</td>
                                                <td>李小華</td>
                                                <td>78</td>
                                                <td>88%</td>
                                                <td>90%</td>
                                                <td><span class="badge bg-info">良好</span></td>
                                            </tr>
                                            <tr>
                                                <td>S003</td>
                                                <td>張小美</td>
                                                <td>65</td>
                                                <td>70%</td>
                                                <td>75%</td>
                                                <td><span class="badge bg-warning">需關注</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-students':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-people me-2"></i>學生管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋學生...">
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增學生</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>學號</th>
                                                <th>姓名</th>
                                                <th>系所</th>
                                                <th>年級</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>S001</td>
                                                <td>王小明</td>
                                                <td>資訊工程系</td>
                                                <td>2</td>
                                                <td><span class="badge bg-success">正常</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">編輯</button>
                                                    <button class="btn btn-sm btn-outline-danger">刪除</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-courses':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-book-half me-2"></i>課程管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋課程...">
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增課程</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>課程代碼</th>
                                                <th>課程名稱</th>
                                                <th>授課教師</th>
                                                <th>學分</th>
                                                <th>人數</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>CS101</td>
                                                <td>程式設計基礎</td>
                                                <td>張教授</td>
                                                <td>3</td>
                                                <td>45/60</td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">編輯</button>
                                                    <button class="btn btn-sm btn-outline-danger">刪除</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-system':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-gear-wide-connected me-2"></i>系統管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6>系統狀態</h6>
                                                <p class="text-success">正常運行</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6>使用者數量</h6>
                                                <p>2,847 人</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6>課程數量</h6>
                                                <p>156 門</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6>系統版本</h6>
                                                <p>v1.0.0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-staff':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-person-badge me-2"></i>教職員管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋教職員...">
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增教職員</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>教職員ID</th>
                                                <th>姓名</th>
                                                <th>職稱</th>
                                                <th>系所</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>T001</td>
                                                <td>張教授</td>
                                                <td>教授</td>
                                                <td>資訊工程系</td>
                                                <td><span class="badge bg-success">在職</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>T002</td>
                                                <td>王助教</td>
                                                <td>助教</td>
                                                <td>資訊工程系</td>
                                                <td><span class="badge bg-success">在職</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>T003</td>
                                                <td>李教授</td>
                                                <td>副教授</td>
                                                <td>電機工程系</td>
                                                <td><span class="badge bg-warning">休假</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-users':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-people-fill me-2"></i>使用者管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="搜尋使用者...">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部角色</option>
                                            <option>學生</option>
                                            <option>教職員</option>
                                            <option>管理員</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">新增使用者</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>使用者ID</th>
                                                <th>姓名</th>
                                                <th>角色</th>
                                                <th>最後登入</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>student1</td>
                                                <td>王小明</td>
                                                <td><span class="badge bg-info">學生</span></td>
                                                <td>2024-01-15 10:30</td>
                                                <td><span class="badge bg-success">正常</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>teacher1</td>
                                                <td>張教授</td>
                                                <td><span class="badge bg-warning">教職員</span></td>
                                                <td>2024-01-15 09:15</td>
                                                <td><span class="badge bg-success">正常</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>admin1</td>
                                                <td>系統管理員</td>
                                                <td><span class="badge bg-danger">管理員</span></td>
                                                <td>2024-01-15 08:00</td>
                                                <td><span class="badge bg-success">正常</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-secondary" disabled>停用</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-logs':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-file-text me-2"></i>系統日誌</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <input type="date" class="form-control" value="2024-01-15">
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select">
                                            <option>全部類型</option>
                                            <option>登入</option>
                                            <option>登出</option>
                                            <option>資料修改</option>
                                            <option>系統錯誤</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select">
                                            <option>全部使用者</option>
                                            <option>學生</option>
                                            <option>教職員</option>
                                            <option>管理員</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-primary">查詢</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>時間</th>
                                                <th>使用者</th>
                                                <th>操作類型</th>
                                                <th>操作內容</th>
                                                <th>IP位址</th>
                                                <th>狀態</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2024-01-15 10:30:15</td>
                                                <td>王小明</td>
                                                <td><span class="badge bg-success">登入</span></td>
                                                <td>使用者登入系統</td>
                                                <td>192.168.1.100</td>
                                                <td><span class="badge bg-success">成功</span></td>
                                            </tr>
                                            <tr>
                                                <td>2024-01-15 10:25:32</td>
                                                <td>張教授</td>
                                                <td><span class="badge bg-info">資料修改</span></td>
                                                <td>修改學生成績</td>
                                                <td>192.168.1.50</td>
                                                <td><span class="badge bg-success">成功</span></td>
                                            </tr>
                                            <tr>
                                                <td>2024-01-15 10:20:18</td>
                                                <td>系統</td>
                                                <td><span class="badge bg-warning">系統錯誤</span></td>
                                                <td>資料庫連接超時</td>
                                                <td>-</td>
                                                <td><span class="badge bg-danger">失敗</span></td>
                                            </tr>
                                            <tr>
                                                <td>2024-01-15 10:15:45</td>
                                                <td>李小華</td>
                                                <td><span class="badge bg-secondary">登出</span></td>
                                                <td>使用者登出系統</td>
                                                <td>192.168.1.80</td>
                                                <td><span class="badge bg-success">成功</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-reports':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-bar-chart me-2"></i>統計報表</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body text-center">
                                                <i class="bi bi-people display-4"></i>
                                                <h4>2,847</h4>
                                                <p>總使用者數</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <i class="bi bi-person-check display-4"></i>
                                                <h4>1,234</h4>
                                                <p>今日活躍用戶</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <i class="bi bi-book display-4"></i>
                                                <h4>156</h4>
                                                <p>開設課程數</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-info text-white">
                                            <div class="card-body text-center">
                                                <i class="bi bi-graph-up display-4"></i>
                                                <h4>98.5%</h4>
                                                <p>系統正常運行率</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>使用者角色分佈</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="progress-stacked">
                                                    <div class="progress" style="width: 70%">
                                                        <div class="progress-bar bg-info" style="width: 100%">學生 70%</div>
                                                    </div>
                                                    <div class="progress" style="width: 25%">
                                                        <div class="progress-bar bg-warning" style="width: 100%">教職員 25%</div>
                                                    </div>
                                                    <div class="progress" style="width: 5%">
                                                        <div class="progress-bar bg-danger" style="width: 100%">管理員 5%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>本週登入統計</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>日期</th>
                                                                <th>登入次數</th>
                                                                <th>活躍用戶</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>01/15</td>
                                                                <td>1,234</td>
                                                                <td>856</td>
                                                            </tr>
                                                            <tr>
                                                                <td>01/14</td>
                                                                <td>1,156</td>
                                                                <td>798</td>
                                                            </tr>
                                                            <tr>
                                                                <td>01/13</td>
                                                                <td>1,089</td>
                                                                <td>743</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-backup':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-cloud-arrow-up me-2"></i>備份管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>建立備份</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">備份類型</label>
                                                    <select class="form-select">
                                                        <option>完整備份</option>
                                                        <option>增量備份</option>
                                                        <option>差異備份</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">備份範圍</label>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">使用者資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">課程資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">成績資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox">
                                                        <label class="form-check-label">系統設定</label>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary">開始備份</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>自動備份設定</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">啟用自動備份</label>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">備份頻率</label>
                                                    <select class="form-select">
                                                        <option>每日</option>
                                                        <option>每週</option>
                                                        <option>每月</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">保留天數</label>
                                                    <input type="number" class="form-control" value="30">
                                                </div>
                                                <button class="btn btn-success">儲存設定</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>備份時間</th>
                                                <th>備份類型</th>
                                                <th>檔案大小</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2024-01-15 02:00</td>
                                                <td>完整備份</td>
                                                <td>2.5 GB</td>
                                                <td><span class="badge bg-success">成功</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">下載</button>
                                                    <button class="btn btn-sm btn-success">還原</button>
                                                    <button class="btn btn-sm btn-danger">刪除</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>2024-01-14 02:00</td>
                                                <td>增量備份</td>
                                                <td>256 MB</td>
                                                <td><span class="badge bg-success">成功</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">下載</button>
                                                    <button class="btn btn-sm btn-success">還原</button>
                                                    <button class="btn btn-sm btn-danger">刪除</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>2024-01-13 02:00</td>
                                                <td>增量備份</td>
                                                <td>128 MB</td>
                                                <td><span class="badge bg-warning">警告</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">下載</button>
                                                    <button class="btn btn-sm btn-success">還原</button>
                                                    <button class="btn btn-sm btn-danger">刪除</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'backend-permissions':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-shield-lock me-2"></i>權限管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋角色或使用者...">
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增角色</button>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>角色權限設定</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>角色</th>
                                                                <th>權限範圍</th>
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td><span class="badge bg-info">學生</span></td>
                                                                <td>學生專區</td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><span class="badge bg-warning">教職員</span></td>
                                                                <td>教職員專區</td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><span class="badge bg-success">管理員</span></td>
                                                                <td>系統管理</td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>功能模組權限</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" checked>
                                                    <label class="form-check-label">學生資料管理</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" checked>
                                                    <label class="form-check-label">課程資料管理</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" checked>
                                                    <label class="form-check-label">成績資料管理</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox">
                                                    <label class="form-check-label">系統設定</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox">
                                                    <label class="form-check-label">使用者管理</label>
                                                </div>
                                                <div class="mt-3">
                                                    <button class="btn btn-success btn-sm">儲存權限</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-class-management':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-people-fill me-2"></i>班級管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>113學年度第1學期</option>
                                            <option>113學年度第2學期</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>資訊工程系</option>
                                            <option>電機工程系</option>
                                            <option>機械工程系</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="搜尋班級...">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="table-responsive">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>學號</th>
                                                        <th>姓名</th>
                                                        <th>班級</th>
                                                        <th>學分數</th>
                                                        <th>平均成績</th>
                                                        <th>出席率</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>S001</td>
                                                        <td>王小明</td>
                                                        <td>資工一甲</td>
                                                        <td>18</td>
                                                        <td>85.5</td>
                                                        <td>95%</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">詳細</button>
                                                            <button class="btn btn-sm btn-warning">編輯</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>S002</td>
                                                        <td>李小華</td>
                                                        <td>資工一甲</td>
                                                        <td>20</td>
                                                        <td>78.2</td>
                                                        <td>88%</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">詳細</button>
                                                            <button class="btn btn-sm btn-warning">編輯</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>S003</td>
                                                        <td>張小美</td>
                                                        <td>資工一甲</td>
                                                        <td>19</td>
                                                        <td>92.1</td>
                                                        <td>97%</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">詳細</button>
                                                            <button class="btn btn-sm btn-warning">編輯</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>班級統計</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-6">
                                                        <h5 class="text-primary">45</h5>
                                                        <small>總人數</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-success">43</h5>
                                                        <small>出席人數</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-info">84.2</h5>
                                                        <small>平均成績</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-warning">91%</h5>
                                                        <small>平均出席率</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6>快速操作</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-outline-primary btn-sm">匯出班級名單</button>
                                                    <button class="btn btn-outline-success btn-sm">批次發送通知</button>
                                                    <button class="btn btn-outline-warning btn-sm">生成班級報表</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'staff-course-planning':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-calendar-plus me-2"></i>課程規劃</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>課程時間安排</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>時間</th>
                                                                <th>週一</th>
                                                                <th>週二</th>
                                                                <th>週三</th>
                                                                <th>週四</th>
                                                                <th>週五</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>08:10-09:00</td>
                                                                <td></td>
                                                                <td class="table-info">程式設計基礎<br><small>A101</small></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                            <tr>
                                                                <td>09:10-10:00</td>
                                                                <td></td>
                                                                <td class="table-info">程式設計基礎<br><small>A101</small></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                            <tr>
                                                                <td>10:10-11:00</td>
                                                                <td></td>
                                                                <td class="table-info">程式設計基礎<br><small>A101</small></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                            <tr>
                                                                <td>11:10-12:00</td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td class="table-warning">資料結構<br><small>E201</small></td>
                                                                <td></td>
                                                            </tr>
                                                            <tr>
                                                                <td>13:20-14:10</td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td class="table-warning">資料結構<br><small>E201</small></td>
                                                                <td></td>
                                                            </tr>
                                                            <tr>
                                                                <td>14:20-15:10</td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td class="table-warning">資料結構<br><small>E201</small></td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>新增課程</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">課程名稱</label>
                                                    <input type="text" class="form-control" placeholder="輸入課程名稱">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">課程代碼</label>
                                                    <input type="text" class="form-control" placeholder="例如: CS101">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">學分數</label>
                                                    <select class="form-select">
                                                        <option>1</option>
                                                        <option>2</option>
                                                        <option>3</option>
                                                        <option>4</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">上課時間</label>
                                                    <select class="form-select">
                                                        <option>週一 第1節</option>
                                                        <option>週二 第1節</option>
                                                        <option>週三 第1節</option>
                                                        <option>週四 第1節</option>
                                                        <option>週五 第1節</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">教室</label>
                                                    <input type="text" class="form-control" placeholder="例如: A101">
                                                </div>
                                                <button class="btn btn-primary w-100">新增課程</button>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6>我的課程</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="mb-0">程式設計基礎</h6>
                                                            <small class="text-muted">CS101 - 3學分</small>
                                                        </div>
                                                        <button class="btn btn-sm btn-outline-danger">移除</button>
                                                    </div>
                                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="mb-0">資料結構</h6>
                                                            <small class="text-muted">CS201 - 3學分</small>
                                                        </div>
                                                        <button class="btn btn-sm btn-outline-danger">移除</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-employee-management':
                    loadEmployeeManagementPage();
                    break;
                case 'hr-attendance':
                    loadAttendanceManagementPage();
                    break;
                case 'hr-payroll':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-wallet2 me-2"></i>薪資管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>2024年01月</option>
                                            <option>2024年02月</option>
                                            <option>2024年03月</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部部門</option>
                                            <option>教務處</option>
                                            <option>學務處</option>
                                            <option>總務處</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">計算薪資</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body text-center">
                                                <h4>NT$ 2,856,000</h4>
                                                <small>本月薪資總額</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h4>85</h4>
                                                <small>已發放人數</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <h4>5</h4>
                                                <small>待審核</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>員工編號</th>
                                                <th>姓名</th>
                                                <th>基本薪資</th>
                                                <th>加班費</th>
                                                <th>津貼</th>
                                                <th>總薪資</th>
                                                <th>扣除項目</th>
                                                <th>實領金額</th>
                                                <th>狀態</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>E001</td>
                                                <td>張教授</td>
                                                <td>NT$ 80,000</td>
                                                <td>NT$ 5,000</td>
                                                <td>NT$ 10,000</td>
                                                <td>NT$ 95,000</td>
                                                <td>NT$ 15,000</td>
                                                <td>NT$ 80,000</td>
                                                <td><span class="badge bg-success">已發放</span></td>
                                            </tr>
                                            <tr>
                                                <td>E002</td>
                                                <td>李助教</td>
                                                <td>NT$ 45,000</td>
                                                <td>NT$ 2,000</td>
                                                <td>NT$ 3,000</td>
                                                <td>NT$ 50,000</td>
                                                <td>NT$ 8,000</td>
                                                <td>NT$ 42,000</td>
                                                <td><span class="badge bg-warning">待審核</span></td>
                                            </tr>
                                            <tr>
                                                <td>E003</td>
                                                <td>王秘書</td>
                                                <td>NT$ 35,000</td>
                                                <td>NT$ 1,500</td>
                                                <td>NT$ 2,000</td>
                                                <td>NT$ 38,500</td>
                                                <td>NT$ 6,000</td>
                                                <td>NT$ 32,500</td>
                                                <td><span class="badge bg-success">已發放</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-recruitment':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-person-plus me-2"></i>招聘管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">發布職缺</button>
                                        <button class="btn btn-success">匯入應徵資料</button>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋職缺或應徵者...">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>職缺管理</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>職缺名稱</th>
                                                                <th>部門</th>
                                                                <th>應徵人數</th>
                                                                <th>狀態</th>
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>資訊工程系助理教授</td>
                                                                <td>資訊工程系</td>
                                                                <td>15</td>
                                                                <td><span class="badge bg-success">進行中</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">管理</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>教務處行政助理</td>
                                                                <td>教務處</td>
                                                                <td>8</td>
                                                                <td><span class="badge bg-warning">待審核</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">管理</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>圖書館管理員</td>
                                                                <td>圖書館</td>
                                                                <td>12</td>
                                                                <td><span class="badge bg-info">已結束</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-primary">管理</button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>應徵者管理</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>姓名</th>
                                                                <th>應徵職位</th>
                                                                <th>應徵日期</th>
                                                                <th>狀態</th>
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>陳博士</td>
                                                                <td>助理教授</td>
                                                                <td>2024-01-10</td>
                                                                <td><span class="badge bg-warning">面試中</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>林小姐</td>
                                                                <td>行政助理</td>
                                                                <td>2024-01-12</td>
                                                                <td><span class="badge bg-primary">待面試</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>王先生</td>
                                                                <td>圖書館管理員</td>
                                                                <td>2024-01-08</td>
                                                                <td><span class="badge bg-success">已錄取</span></td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-performance':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-graph-up me-2"></i>績效考核</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>2024年度考核</option>
                                            <option>2023年度考核</option>
                                            <option>2022年度考核</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部部門</option>
                                            <option>教務處</option>
                                            <option>學務處</option>
                                            <option>總務處</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">開始考核</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h4>25</h4>
                                                <small>優秀</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body text-center">
                                                <h4>45</h4>
                                                <small>良好</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <h4>15</h4>
                                                <small>普通</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-danger text-white">
                                            <div class="card-body text-center">
                                                <h4>5</h4>
                                                <small>待改善</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>員工編號</th>
                                                <th>姓名</th>
                                                <th>部門</th>
                                                <th>工作表現</th>
                                                <th>團隊合作</th>
                                                <th>創新能力</th>
                                                <th>總分</th>
                                                <th>等級</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>E001</td>
                                                <td>張教授</td>
                                                <td>資訊工程系</td>
                                                <td>90</td>
                                                <td>85</td>
                                                <td>95</td>
                                                <td>90</td>
                                                <td><span class="badge bg-success">優秀</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>E002</td>
                                                <td>李助教</td>
                                                <td>資訊工程系</td>
                                                <td>78</td>
                                                <td>82</td>
                                                <td>75</td>
                                                <td>78</td>
                                                <td><span class="badge bg-primary">良好</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>E003</td>
                                                <td>王秘書</td>
                                                <td>教務處</td>
                                                <td>85</td>
                                                <td>88</td>
                                                <td>80</td>
                                                <td>84</td>
                                                <td><span class="badge bg-primary">良好</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-training':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-book-half me-2"></i>培訓管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增培訓課程</button>
                                        <button class="btn btn-success">匯入培訓資料</button>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋培訓課程...">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="table-responsive">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>課程名稱</th>
                                                        <th>講師</th>
                                                        <th>開課日期</th>
                                                        <th>時數</th>
                                                        <th>報名人數</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>數位教學工具應用</td>
                                                        <td>陳講師</td>
                                                        <td>2024-01-20</td>
                                                        <td>8小時</td>
                                                        <td>25/30</td>
                                                        <td><span class="badge bg-success">報名中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>校園安全管理</td>
                                                        <td>林警官</td>
                                                        <td>2024-01-25</td>
                                                        <td>4小時</td>
                                                        <td>15/20</td>
                                                        <td><span class="badge bg-warning">準備中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>行政效率提升</td>
                                                        <td>王顧問</td>
                                                        <td>2024-01-15</td>
                                                        <td>6小時</td>
                                                        <td>20/20</td>
                                                        <td><span class="badge bg-info">已完成</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>培訓統計</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-6">
                                                        <h5 class="text-primary">12</h5>
                                                        <small>本月課程</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-success">180</h5>
                                                        <small>參訓人次</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-warning">85%</h5>
                                                        <small>完成率</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-info">4.2</h5>
                                                        <small>平均評分</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6>員工培訓記錄</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item">
                                                        <div class="d-flex justify-content-between">
                                                            <strong>張教授</strong>
                                                            <small>32小時</small>
                                                        </div>
                                                        <small class="text-muted">本年度培訓時數</small>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <div class="d-flex justify-content-between">
                                                            <strong>李助教</strong>
                                                            <small>24小時</small>
                                                        </div>
                                                        <small class="text-muted">本年度培訓時數</small>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <div class="d-flex justify-content-between">
                                                            <strong>王秘書</strong>
                                                            <small>18小時</small>
                                                        </div>
                                                        <small class="text-muted">本年度培訓時數</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-leave':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-calendar-x me-2"></i>請假管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部狀態</option>
                                            <option>待審核</option>
                                            <option>已核准</option>
                                            <option>已拒絕</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="date" class="form-control">
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">查詢</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <h4>8</h4>
                                                <small>待審核</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h4>25</h4>
                                                <small>已核准</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-danger text-white">
                                            <div class="card-body text-center">
                                                <h4>3</h4>
                                                <small>已拒絕</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-info text-white">
                                            <div class="card-body text-center">
                                                <h4>36</h4>
                                                <small>本月總計</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>申請人</th>
                                                <th>假別</th>
                                                <th>請假日期</th>
                                                <th>天數</th>
                                                <th>請假事由</th>
                                                <th>申請日期</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>張教授</td>
                                                <td>病假</td>
                                                <td>2024-01-20</td>
                                                <td>1天</td>
                                                <td>身體不適</td>
                                                <td>2024-01-18</td>
                                                <td><span class="badge bg-warning">待審核</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-success">核准</button>
                                                    <button class="btn btn-sm btn-danger">拒絕</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>李助教</td>
                                                <td>事假</td>
                                                <td>2024-01-22</td>
                                                <td>0.5天</td>
                                                <td>處理私事</td>
                                                <td>2024-01-19</td>
                                                <td><span class="badge bg-success">已核准</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>王秘書</td>
                                                <td>特休</td>
                                                <td>2024-01-25~2024-01-26</td>
                                                <td>2天</td>
                                                <td>家族旅遊</td>
                                                <td>2024-01-15</td>
                                                <td><span class="badge bg-success">已核准</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-info">檢視</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-benefits':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-heart me-2"></i>福利管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <button class="btn btn-primary">新增福利方案</button>
                                        <button class="btn btn-success">福利調查</button>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="搜尋福利項目...">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="table-responsive">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>福利項目</th>
                                                        <th>類型</th>
                                                        <th>適用對象</th>
                                                        <th>預算</th>
                                                        <th>使用率</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>健康檢查</td>
                                                        <td>健康福利</td>
                                                        <td>全體員工</td>
                                                        <td>NT$ 200,000</td>
                                                        <td>85%</td>
                                                        <td><span class="badge bg-success">進行中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>團體保險</td>
                                                        <td>保險福利</td>
                                                        <td>正式員工</td>
                                                        <td>NT$ 500,000</td>
                                                        <td>100%</td>
                                                        <td><span class="badge bg-success">進行中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>員工旅遊</td>
                                                        <td>休閒福利</td>
                                                        <td>全體員工</td>
                                                        <td>NT$ 300,000</td>
                                                        <td>78%</td>
                                                        <td><span class="badge bg-warning">規劃中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>進修補助</td>
                                                        <td>教育福利</td>
                                                        <td>教職員工</td>
                                                        <td>NT$ 150,000</td>
                                                        <td>45%</td>
                                                        <td><span class="badge bg-success">進行中</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">管理</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>福利統計</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-6">
                                                        <h5 class="text-primary">12</h5>
                                                        <small>福利項目</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-success">NT$ 1.2M</h5>
                                                        <small>年度預算</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-warning">77%</h5>
                                                        <small>平均使用率</small>
                                    </div>
                                                    <div class="col-6">
                                                        <h5 class="text-info">4.5</h5>
                                                        <small>滿意度</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6>熱門福利</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item d-flex justify-content-between">
                                                        <span>團體保險</span>
                                                        <span class="badge bg-success">100%</span>
                                                    </div>
                                                    <div class="list-group-item d-flex justify-content-between">
                                                        <span>健康檢查</span>
                                                        <span class="badge bg-primary">85%</span>
                                                    </div>
                                                    <div class="list-group-item d-flex justify-content-between">
                                                        <span>員工旅遊</span>
                                                        <span class="badge bg-warning">78%</span>
                                                    </div>
                                                    <div class="list-group-item d-flex justify-content-between">
                                                        <span>進修補助</span>
                                                        <span class="badge bg-info">45%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'hr-reports':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-file-earmark-bar-graph me-2"></i>人事報表</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>月報表</option>
                                            <option>季報表</option>
                                            <option>年報表</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部類型</option>
                                            <option>人員統計</option>
                                            <option>薪資統計</option>
                                            <option>考勤統計</option>
                                            <option>培訓統計</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">生成報表</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body text-center">
                                                <h4>90</h4>
                                                <small>總員工數</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h4>8.5%</h4>
                                                <small>離職率</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-white">
                                            <div class="card-body text-center">
                                                <h4>NT$ 2.8M</h4>
                                                <small>月薪資總額</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-info text-white">
                                            <div class="card-body text-center">
                                                <h4>95.2%</h4>
                                                <small>平均出勤率</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>部門人員分佈</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>部門</th>
                                                                <th>人數</th>
                                                                <th>比例</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>資訊工程系</td>
                                                                <td>25</td>
                                                                <td>
                                                                    <div class="progress">
                                                                        <div class="progress-bar" style="width: 28%">28%</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>教務處</td>
                                                                <td>15</td>
                                                                <td>
                                                                    <div class="progress">
                                                                        <div class="progress-bar bg-success" style="width: 17%">17%</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>學務處</td>
                                                                <td>20</td>
                                                                <td>
                                                                    <div class="progress">
                                                                        <div class="progress-bar bg-warning" style="width: 22%">22%</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>總務處</td>
                                                                <td>18</td>
                                                                <td>
                                                                    <div class="progress">
                                                                        <div class="progress-bar bg-info" style="width: 20%">20%</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>其他</td>
                                                                <td>12</td>
                                                                <td>
                                                                    <div class="progress">
                                                                        <div class="progress-bar bg-secondary" style="width: 13%">13%</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>月份趨勢分析</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>月份</th>
                                                                <th>新進</th>
                                                                <th>離職</th>
                                                                <th>淨增長</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>2024-01</td>
                                                                <td>3</td>
                                                                <td>1</td>
                                                                <td class="text-success">+2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>2023-12</td>
                                                                <td>2</td>
                                                                <td>2</td>
                                                                <td class="text-muted">0</td>
                                                            </tr>
                                                            <tr>
                                                                <td>2023-11</td>
                                                                <td>1</td>
                                                                <td>3</td>
                                                                <td class="text-danger">-2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>2023-10</td>
                                                                <td>4</td>
                                                                <td>1</td>
                                                                <td class="text-success">+3</td>
                                                            </tr>
                                                            <tr>
                                                                <td>2023-09</td>
                                                                <td>5</td>
                                                                <td>2</td>
                                                                <td class="text-success">+3</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                // 系統管理員功能
                case 'admin-users':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-people me-2"></i>用戶管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="搜尋用戶...">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部角色</option>
                                            <option>學生</option>
                                            <option>教職員</option>
                                            <option>人事</option>
                                            <option>管理員</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">
                                            <i class="bi bi-plus-circle me-1"></i>新增用戶
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用戶名</th>
                                                <th>姓名</th>
                                                <th>角色</th>
                                                <th>部門</th>
                                                <th>狀態</th>
                                                <th>最後登入</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>admin</td>
                                                <td>系統管理員</td>
                                                <td><span class="badge bg-danger">管理員</span></td>
                                                <td>資訊中心</td>
                                                <td><span class="badge bg-success">啟用</span></td>
                                                <td>2025-01-16 10:30</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>2</td>
                                                <td>hr</td>
                                                <td>人事主管</td>
                                                <td><span class="badge bg-info">人事</span></td>
                                                <td>人事部</td>
                                                <td><span class="badge bg-success">啟用</span></td>
                                                <td>2025-01-16 09:15</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>3</td>
                                                <td>staff</td>
                                                <td>教職員</td>
                                                <td><span class="badge bg-warning">教職員</span></td>
                                                <td>教務處</td>
                                                <td><span class="badge bg-success">啟用</span></td>
                                                <td>2025-01-16 08:45</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>4</td>
                                                <td>student</td>
                                                <td>學生</td>
                                                <td><span class="badge bg-primary">學生</span></td>
                                                <td>資訊工程系</td>
                                                <td><span class="badge bg-success">啟用</span></td>
                                                <td>2025-01-16 07:30</td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-warning">重置密碼</button>
                                                    <button class="btn btn-sm btn-danger">停用</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'admin-courses':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-book me-2"></i>課程管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="搜尋課程...">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select">
                                            <option>全部學期</option>
                                            <option>113-1</option>
                                            <option>113-2</option>
                                            <option>112-1</option>
                                            <option>112-2</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary">
                                            <i class="bi bi-plus-circle me-1"></i>新增課程
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>課程代碼</th>
                                                <th>課程名稱</th>
                                                <th>授課教師</th>
                                                <th>學分</th>
                                                <th>容量</th>
                                                <th>已選人數</th>
                                                <th>狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>CS101</td>
                                                <td>程式設計概論</td>
                                                <td>王教授</td>
                                                <td>3</td>
                                                <td>50</td>
                                                <td>35</td>
                                                <td><span class="badge bg-success">開放</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-info">查看學生</button>
                                                    <button class="btn btn-sm btn-danger">停開</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>EE201</td>
                                                <td>電路學</td>
                                                <td>陳副教授</td>
                                                <td>3</td>
                                                <td>40</td>
                                                <td>28</td>
                                                <td><span class="badge bg-success">開放</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-info">查看學生</button>
                                                    <button class="btn btn-sm btn-danger">停開</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>MA301</td>
                                                <td>微積分</td>
                                                <td>李教授</td>
                                                <td>4</td>
                                                <td>60</td>
                                                <td>45</td>
                                                <td><span class="badge bg-warning">額滿</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary">編輯</button>
                                                    <button class="btn btn-sm btn-info">查看學生</button>
                                                    <button class="btn btn-sm btn-danger">停開</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'admin-system':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-gear me-2"></i>系統設定</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>基本設定</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">系統名稱</label>
                                                    <input type="text" class="form-control" value="校務系統網站">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">系統版本</label>
                                                    <input type="text" class="form-control" value="v1.0.0" readonly>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">預設語言</label>
                                                    <select class="form-select">
                                                        <option value="zh-TW" selected>繁體中文</option>
                                                        <option value="en">English</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary">儲存設定</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>安全設定</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">登入逾時時間（分鐘）</label>
                                                    <input type="number" class="form-control" value="30">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">密碼最小長度</label>
                                                    <input type="number" class="form-control" value="6">
                                                </div>
                                                <div class="mb-3">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">啟用兩步驟驗證</label>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary">儲存設定</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'admin-backup':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-cloud-arrow-down me-2"></i>資料備份</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>立即備份</h6>
                                            </div>
                                            <div class="card-body">
                                                <p>建立系統資料的即時備份</p>
                                                <div class="mb-3">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">使用者資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">課程資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" checked>
                                                        <label class="form-check-label">成績資料</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox">
                                                        <label class="form-check-label">系統日誌</label>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary">
                                                    <i class="bi bi-download me-1"></i>開始備份
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>還原資料</h6>
                                            </div>
                                            <div class="card-body">
                                                <p>從備份檔案還原系統資料</p>
                                                <div class="mb-3">
                                                    <label class="form-label">選擇備份檔案</label>
                                                    <input type="file" class="form-control" accept=".json,.sql">
                                                </div>
                                                <button class="btn btn-warning">
                                                    <i class="bi bi-upload me-1"></i>還原資料
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <h6>備份歷史</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>備份時間</th>
                                                        <th>檔案大小</th>
                                                        <th>備份類型</th>
                                                        <th>狀態</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>2025-01-16 10:00</td>
                                                        <td>2.5 MB</td>
                                                        <td>完整備份</td>
                                                        <td><span class="badge bg-success">成功</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">下載</button>
                                                            <button class="btn btn-sm btn-danger">刪除</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2025-01-15 23:30</td>
                                                        <td>1.8 MB</td>
                                                        <td>增量備份</td>
                                                        <td><span class="badge bg-success">成功</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-primary">下載</button>
                                                            <button class="btn btn-sm btn-danger">刪除</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'admin-logs':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-journal-text me-2"></i>系統日誌</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <select class="form-select">
                                            <option>全部等級</option>
                                            <option>錯誤</option>
                                            <option>警告</option>
                                            <option>資訊</option>
                                            <option>除錯</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="date" class="form-control" value="2025-01-16">
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="搜尋日誌...">
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary">搜尋</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>時間</th>
                                                <th>等級</th>
                                                <th>使用者</th>
                                                <th>操作</th>
                                                <th>IP 位址</th>
                                                <th>詳細資訊</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2025-01-16 10:30:15</td>
                                                <td><span class="badge bg-success">資訊</span></td>
                                                <td>admin</td>
                                                <td>登入系統</td>
                                                <td>192.168.1.100</td>
                                                <td>管理員登入成功</td>
                                            </tr>
                                            <tr>
                                                <td>2025-01-16 10:25:30</td>
                                                <td><span class="badge bg-warning">警告</span></td>
                                                <td>student</td>
                                                <td>登入失敗</td>
                                                <td>192.168.1.101</td>
                                                <td>密碼錯誤</td>
                                            </tr>
                                            <tr>
                                                <td>2025-01-16 10:20:45</td>
                                                <td><span class="badge bg-success">資訊</span></td>
                                                <td>staff</td>
                                                <td>查看成績</td>
                                                <td>192.168.1.102</td>
                                                <td>查看課程 CS101 成績</td>
                                            </tr>
                                            <tr>
                                                <td>2025-01-16 10:15:20</td>
                                                <td><span class="badge bg-danger">錯誤</span></td>
                                                <td>system</td>
                                                <td>資料庫連接</td>
                                                <td>localhost</td>
                                                <td>連接超時</td>
                                            </tr>
                                            <tr>
                                                <td>2025-01-16 10:10:10</td>
                                                <td><span class="badge bg-success">資訊</span></td>
                                                <td>hr</td>
                                                <td>新增員工</td>
                                                <td>192.168.1.103</td>
                                                <td>新增員工資料 T003</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'admin-security':
                    content.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-shield-check me-2"></i>安全性管理</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>系統狀態</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>防火牆狀態</span>
                                                    <span class="badge bg-success">啟用</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>SSL 憑證</span>
                                                    <span class="badge bg-success">有效</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>入侵偵測</span>
                                                    <span class="badge bg-success">啟用</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>資料加密</span>
                                                    <span class="badge bg-success">啟用</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span>備份狀態</span>
                                                    <span class="badge bg-success">正常</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h6>安全威脅</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="alert alert-success">
                                                    <i class="bi bi-shield-check me-2"></i>
                                                    無已知安全威脅
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>今日嘗試入侵</span>
                                                    <span class="badge bg-warning">3</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>已封鎖 IP</span>
                                                    <span class="badge bg-danger">12</span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span>異常登入</span>
                                                    <span class="badge bg-secondary">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <h6>封鎖 IP 清單</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <div class="input-group">
                                                <input type="text" class="form-control" placeholder="輸入要封鎖的 IP 位址">
                                                <button class="btn btn-danger">封鎖</button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>IP 位址</th>
                                                        <th>封鎖時間</th>
                                                        <th>封鎖原因</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>192.168.1.200</td>
                                                        <td>2025-01-16 09:30</td>
                                                        <td>暴力破解</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-success">解封</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>10.0.0.50</td>
                                                        <td>2025-01-16 08:15</td>
                                                        <td>異常連線</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-success">解封</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                default:
                    content.innerHTML = `
                        <div class="alert alert-info">
                            功能 ${featureId} 正在開發中...
                        </div>
                    `;
            }
        }

        // 登出
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUI();
            showSection('home');
            showToast('info', '登出成功', '您已成功登出系統');
        }

        // 顯示Toast
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // 自動移除Toast
            toast.addEventListener('hidden.bs.toast', function () {
                toast.remove();
            });
        }

        // 文件申請系統資料
        let documentApplicationData = {
            applications: [
                {
                    id: 'doc001',
                    type: 'transcript',
                    typeName: '成績單',
                    language: 'zh',
                    languageName: '中文',
                    copies: 2,
                    purpose: 'job',
                    purposeName: '求職',
                    applicantName: '學生一',
                    studentId: 'student1',
                    phoneNumber: '0912-345-678',
                    email: 'student1@example.com',
                    applicationDate: '2024-01-10',
                    expectedDate: '2024-01-17',
                    status: 'completed',
                    statusName: '已完成',
                    fee: 200,
                    remarks: '需加蓋學校印章'
                },
                {
                    id: 'doc002',
                    type: 'enrollment',
                    typeName: '在學證明',
                    language: 'zh',
                    languageName: '中文',
                    copies: 1,
                    purpose: 'visa',
                    purposeName: '簽證申請',
                    applicantName: '學生一',
                    studentId: 'student1',
                    phoneNumber: '0912-345-678',
                    email: 'student1@example.com',
                    applicationDate: '2024-01-08',
                    expectedDate: '2024-01-15',
                    status: 'processing',
                    statusName: '處理中',
                    fee: 100,
                    remarks: ''
                }
            ]
        };

        // 文件類型配置
        const documentTypes = {
            transcript: {
                name: '成績單',
                icon: 'bi-file-earmark-text',
                baseFee: 100,
                description: '正式成績單，包含所有修課記錄和成績',
                processingDays: 7,
                requirements: ['學生證影本', '申請表']
            },
            enrollment: {
                name: '在學證明',
                icon: 'bi-file-person',
                baseFee: 50,
                description: '證明目前在學狀態的正式文件',
                processingDays: 3,
                requirements: ['學生證影本']
            },
            diploma: {
                name: '畢業證書',
                icon: 'bi-award',
                baseFee: 200,
                description: '畢業證書正本影本或英文版本',
                processingDays: 10,
                requirements: ['身分證影本', '申請表', '畢業證書正本']
            },
            course: {
                name: '修課證明',
                icon: 'bi-journal-text',
                baseFee: 80,
                description: '特定課程的修課證明和成績',
                processingDays: 5,
                requirements: ['學生證影本', '課程清單']
            }
        };

        // 顯示文件申請表單
        function showDocumentApplication(type) {
            if (!currentUser) {
                showToast('warning', '請先登入', '請先登入系統才能申請文件');
                return;
            }

            const docType = documentTypes[type];
            if (!docType) {
                showToast('danger', '錯誤', '無效的文件類型');
                return;
            }

            // 設定模態框標題
            document.getElementById('documentApplicationTitle').innerHTML = 
                `<i class="bi ${docType.icon} me-2"></i>${docType.name}申請`;

            // 設定隱藏欄位
            document.getElementById('documentType').value = type;

            // 預填使用者資訊
            document.getElementById('applicantName').value = currentUser.name || '';
            document.getElementById('studentId').value = currentUser.username || '';
            document.getElementById('phoneNumber').value = currentUser.phone || '';
            document.getElementById('email').value = currentUser.email || '';

            // 重置表單
            document.getElementById('documentApplicationForm').reset();
            document.getElementById('applicantName').value = currentUser.name || '';
            document.getElementById('studentId').value = currentUser.username || '';
            document.getElementById('phoneNumber').value = currentUser.phone || '';
            document.getElementById('email').value = currentUser.email || '';
            document.getElementById('documentType').value = type;

            // 載入特殊選項
            loadSpecialOptions(type);

            // 計算初始費用
            calculateFee();

            // 顯示模態框
            const modal = new bootstrap.Modal(document.getElementById('documentApplicationModal'));
            modal.show();
        }

        // 載入特殊選項
        function loadSpecialOptions(type) {
            const container = document.getElementById('specialOptions');
            
            switch(type) {
                case 'transcript':
                    container.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">成績單類型</label>
                                    <select class="form-select" id="transcriptType" onchange="calculateFee()">
                                        <option value="complete">完整成績單</option>
                                        <option value="partial">部分成績單</option>
                                        <option value="ranking">含排名成績單</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">學期範圍</label>
                                    <select class="form-select" id="semesterRange">
                                        <option value="all">全部學期</option>
                                        <option value="current">當前學期</option>
                                        <option value="specific">指定學期</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'course':
                    container.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">課程清單</label>
                            <textarea class="form-control" id="courseList" rows="3" placeholder="請列出需要修課證明的課程名稱和課程代碼，一行一個"></textarea>
                        </div>
                    `;
                    break;
                case 'diploma':
                    container.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">證書類型</label>
                                    <select class="form-select" id="diplomaType" onchange="calculateFee()">
                                        <option value="copy">影本</option>
                                        <option value="certified">公證影本</option>
                                        <option value="english">英文版本</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">畢業年度</label>
                                    <input type="number" class="form-control" id="graduationYear" min="1990" max="2030" placeholder="例：2023">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    container.innerHTML = '';
            }
        }

        // 計算費用
        function calculateFee() {
            const type = document.getElementById('documentType').value;
            const language = document.getElementById('language').value;
            const copies = parseInt(document.getElementById('copies').value) || 1;
            
            if (!type || !documentTypes[type]) {
                document.getElementById('estimatedFee').textContent = '-';
                return;
            }

            let baseFee = documentTypes[type].baseFee;
            
            // 語言版本加成
            if (language === 'en') {
                baseFee = Math.floor(baseFee * 1.5); // 英文版本加收50%
            }
            
            // 特殊類型加成
            switch(type) {
                case 'transcript':
                    const transcriptType = document.getElementById('transcriptType')?.value;
                    if (transcriptType === 'ranking') {
                        baseFee += 50; // 含排名加收50元
                    }
                    break;
                case 'diploma':
                    const diplomaType = document.getElementById('diplomaType')?.value;
                    if (diplomaType === 'certified') {
                        baseFee += 100; // 公證版本加收100元
                    }
                    break;
            }
            
            const totalFee = baseFee * copies;
            document.getElementById('estimatedFee').textContent = `NT$ ${totalFee}`;
        }

        // 提交文件申請
        function submitDocumentApplication() {
            const form = document.getElementById('documentApplicationForm');
            
            // 表單驗證
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const type = document.getElementById('documentType').value;
            const docType = documentTypes[type];
            
            // 收集表單資料
            const formData = {
                id: 'doc' + Date.now(),
                type: type,
                typeName: docType.name,
                language: document.getElementById('language').value,
                languageName: document.getElementById('language').selectedOptions[0].text,
                copies: parseInt(document.getElementById('copies').value),
                purpose: document.getElementById('purpose').value,
                purposeName: document.getElementById('purpose').selectedOptions[0].text,
                applicantName: document.getElementById('applicantName').value,
                studentId: document.getElementById('studentId').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                email: document.getElementById('email').value,
                applicationDate: new Date().toLocaleDateString('zh-TW'),
                expectedDate: getExpectedDate(docType.processingDays),
                status: 'submitted',
                statusName: '已提交',
                fee: extractFeeAmount(document.getElementById('estimatedFee').textContent),
                remarks: document.getElementById('remarks').value,
                otherPurpose: document.getElementById('otherPurpose').value
            };

            // 收集特殊選項資料
            if (type === 'transcript') {
                formData.transcriptType = document.getElementById('transcriptType')?.value;
                formData.semesterRange = document.getElementById('semesterRange')?.value;
            } else if (type === 'course') {
                formData.courseList = document.getElementById('courseList')?.value;
            } else if (type === 'diploma') {
                formData.diplomaType = document.getElementById('diplomaType')?.value;
                formData.graduationYear = document.getElementById('graduationYear')?.value;
            }

            // 添加到申請記錄
            documentApplicationData.applications.unshift(formData);

            // 關閉模態框
            const modal = bootstrap.Modal.getInstance(document.getElementById('documentApplicationModal'));
            modal.hide();

            // 重新載入申請記錄
            if (document.getElementById('document-applications-list')) {
                loadDocumentApplications();
            }

            // 顯示成功訊息
            showConfirmModal(
                '申請提交成功',
                `您的${docType.name}申請已成功提交！<br><br>
                 <strong>申請資訊：</strong><br>
                 申請編號：${formData.id}<br>
                 語言版本：${formData.languageName}<br>
                 申請份數：${formData.copies}份<br>
                 申請費用：NT$ ${formData.fee}<br>
                 預計完成：${formData.expectedDate}<br><br>
                 <strong>注意事項：</strong><br>
                 • 請準備所需文件：${docType.requirements.join('、')}<br>
                 • 請於收到通知後三日內繳費<br>
                 • 可至學務處查詢申請進度`,
                function() {
                    // 可以在這裡添加其他後續動作
                }
            );
        }

        // 載入文件申請記錄
        function loadDocumentApplications() {
            const tbody = document.getElementById('document-applications-list');
            if (!tbody) return;

            const userApplications = documentApplicationData.applications.filter(app => 
                app.studentId === currentUser?.username
            );

            if (userApplications.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-3">
                            <i class="bi bi-inbox display-6 d-block mb-2"></i>
                            尚無申請記錄
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = userApplications.map(app => {
                const statusBadge = getApplicationStatusBadge(app.status);
                const actionButton = getApplicationActionButton(app);
                
                return `
                    <tr>
                        <td><small>${app.applicationDate}</small></td>
                        <td>
                            <i class="bi ${documentTypes[app.type].icon} me-1"></i>
                            ${app.typeName}
                        </td>
                        <td>${app.languageName}</td>
                        <td>${statusBadge}</td>
                        <td><small>${app.expectedDate}</small></td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            }).join('');
        }

        // 獲取申請狀態徽章
        function getApplicationStatusBadge(status) {
            switch (status) {
                case 'submitted':
                    return '<span class="badge bg-info">已提交</span>';
                case 'processing':
                    return '<span class="badge bg-warning">處理中</span>';
                case 'ready':
                    return '<span class="badge bg-primary">可領取</span>';
                case 'completed':
                    return '<span class="badge bg-success">已完成</span>';
                case 'cancelled':
                    return '<span class="badge bg-secondary">已取消</span>';
                default:
                    return '<span class="badge bg-secondary">未知</span>';
            }
        }

        // 獲取申請操作按鈕
        function getApplicationActionButton(app) {
            switch (app.status) {
                case 'submitted':
                case 'processing':
                    return `
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-info" onclick="viewApplicationDetails('${app.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="cancelApplication('${app.id}')">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    `;
                case 'ready':
                    return `
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-success" onclick="pickupDocument('${app.id}')">
                                <i class="bi bi-download"></i>
                            </button>
                            <button class="btn btn-outline-info" onclick="viewApplicationDetails('${app.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    `;
                case 'completed':
                    return `
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="downloadDocument('${app.id}')">
                                <i class="bi bi-download"></i>
                            </button>
                            <button class="btn btn-outline-info" onclick="viewApplicationDetails('${app.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    `;
                default:
                    return `
                        <button class="btn btn-outline-info btn-sm" onclick="viewApplicationDetails('${app.id}')">
                            <i class="bi bi-eye"></i>
                        </button>
                    `;
            }
        }

        // 輔助函數
        function getExpectedDate(processingDays) {
            const date = new Date();
            date.setDate(date.getDate() + processingDays);
            return date.toLocaleDateString('zh-TW');
        }

        function extractFeeAmount(feeText) {
            const match = feeText.match(/\d+/);
            return match ? parseInt(match[0]) : 0;
        }

        // 事件監聽器設定
        document.addEventListener('DOMContentLoaded', function() {
            // 監聽表單變更以計算費用
            const feeRelatedFields = ['language', 'copies'];
            feeRelatedFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', calculateFee);
                }
            });

            // 監聽申請用途變更
            const purposeField = document.getElementById('purpose');
            if (purposeField) {
                purposeField.addEventListener('change', function() {
                    const otherDiv = document.getElementById('otherPurposeDiv');
                    if (this.value === 'other') {
                        otherDiv.style.display = 'block';
                        document.getElementById('otherPurpose').required = true;
                    } else {
                        otherDiv.style.display = 'none';
                        document.getElementById('otherPurpose').required = false;
                    }
                });
            }
        });

        // 查看申請詳情
        function viewApplicationDetails(appId) {
            const app = documentApplicationData.applications.find(a => a.id === appId);
            if (!app) return;

            const docType = documentTypes[app.type];
            let specialInfo = '';

            // 添加特殊資訊
            if (app.type === 'transcript' && app.transcriptType) {
                const typeNames = {
                    'complete': '完整成績單',
                    'partial': '部分成績單',
                    'ranking': '含排名成績單'
                };
                specialInfo += `<li><strong>成績單類型：</strong>${typeNames[app.transcriptType] || app.transcriptType}</li>`;
            }

            if (app.type === 'course' && app.courseList) {
                specialInfo += `<li><strong>課程清單：</strong><br><pre class="mt-1">${app.courseList}</pre></li>`;
            }

            if (app.type === 'diploma') {
                if (app.diplomaType) {
                    const typeNames = {
                        'copy': '影本',
                        'certified': '公證影本',
                        'english': '英文版本'
                    };
                    specialInfo += `<li><strong>證書類型：</strong>${typeNames[app.diplomaType] || app.diplomaType}</li>`;
                }
                if (app.graduationYear) {
                    specialInfo += `<li><strong>畢業年度：</strong>${app.graduationYear}</li>`;
                }
            }

            showConfirmModal(
                `申請詳情 - ${app.typeName}`,
                `
                <div class="row">
                    <div class="col-12">
                        <h6><i class="bi bi-file-earmark-text me-2"></i>申請資訊</h6>
                        <ul class="list-unstyled mb-3">
                            <li><strong>申請編號：</strong>${app.id}</li>
                            <li><strong>申請人：</strong>${app.applicantName} (${app.studentId})</li>
                            <li><strong>聯絡方式：</strong>${app.phoneNumber} / ${app.email}</li>
                            <li><strong>申請日期：</strong>${app.applicationDate}</li>
                            <li><strong>預計完成：</strong>${app.expectedDate}</li>
                        </ul>
                        
                        <h6><i class="bi bi-gear me-2"></i>申請規格</h6>
                        <ul class="list-unstyled mb-3">
                            <li><strong>語言版本：</strong>${app.languageName}</li>
                            <li><strong>申請份數：</strong>${app.copies}份</li>
                            <li><strong>申請用途：</strong>${app.purposeName}</li>
                            ${specialInfo}
                            ${app.otherPurpose ? `<li><strong>其他用途：</strong>${app.otherPurpose}</li>` : ''}
                        </ul>
                        
                        <h6><i class="bi bi-credit-card me-2"></i>費用資訊</h6>
                        <ul class="list-unstyled mb-3">
                            <li><strong>申請費用：</strong>NT$ ${app.fee}</li>
                            <li><strong>狀態：</strong>${getApplicationStatusBadge(app.status)}</li>
                        </ul>
                        
                        ${app.remarks ? `
                        <h6><i class="bi bi-chat-text me-2"></i>備註</h6>
                        <p class="border p-2 rounded bg-light">${app.remarks}</p>
                        ` : ''}
                    </div>
                </div>
                `,
                null
            );

            // 隱藏確認按鈕，這是純查看模式
            document.getElementById('confirmModalConfirm').style.display = 'none';
            
            // 當模態框關閉時恢復確認按鈕
            const modal = document.getElementById('confirmModal');
            modal.addEventListener('hidden.bs.modal', function() {
                document.getElementById('confirmModalConfirm').style.display = 'block';
            }, { once: true });
        }

        // 顯示申請條款
        function showTerms() {
            showConfirmModal(
                '文件申請條款與規定',
                `
                <div class="text-start">
                    <h6>申請須知</h6>
                    <ol>
                        <li>申請人須為本校在學學生或畢業校友</li>
                        <li>申請文件僅供申請人本人使用，不得轉讓他人</li>
                        <li>申請時請準備相關證明文件</li>
                        <li>申請費用一經繳納，不予退還</li>
                    </ol>
                    
                    <h6>處理時間</h6>
                    <ul>
                        <li>在學證明：3個工作天</li>
                        <li>修課證明：5個工作天</li>
                        <li>成績單：7個工作天</li>
                        <li>畢業證書：10個工作天</li>
                    </ul>
                    
                    <h6>費用標準</h6>
                    <ul>
                        <li>中文版本：依公告標準收費</li>
                        <li>英文版本：加收50%費用</li>
                        <li>公證版本：額外加收公證費用</li>
                    </ul>
                    
                    <h6>注意事項</h6>
                    <ul>
                        <li>請確保聯絡資訊正確，以便通知取件</li>
                        <li>文件完成後請於一個月內領取</li>
                        <li>如有疑問請洽學務處</li>
                    </ul>
                </div>
                `,
                null
            );

            // 隱藏確認按鈕
            document.getElementById('confirmModalConfirm').style.display = 'none';
            
            // 當模態框關閉時恢復確認按鈕
            const modal = document.getElementById('confirmModal');
            modal.addEventListener('hidden.bs.modal', function() {
                document.getElementById('confirmModalConfirm').style.display = 'block';
            }, { once: true });
        }

        // 取消申請
        function cancelApplication(appId) {
            const app = documentApplicationData.applications.find(a => a.id === appId);
            if (!app) return;

            if (app.status === 'completed' || app.status === 'cancelled') {
                showToast('warning', '無法取消', '此申請已完成或已取消，無法再次取消');
                return;
            }

            showConfirmModal(
                '確認取消申請',
                `確定要取消「${app.typeName}」申請嗎？<br><br>
                 <strong>注意：</strong>取消後將無法恢復，如已繳費可能需要另外辦理退費手續。`,
                function() {
                    app.status = 'cancelled';
                    app.statusName = '已取消';
                    loadDocumentApplications();
                    showToast('success', '取消成功', `已成功取消${app.typeName}申請`);
                }
            );
        }

        // 領取文件
        function pickupDocument(appId) {
            const app = documentApplicationData.applications.find(a => a.id === appId);
            if (!app) return;

            if (app.status !== 'ready') {
                showToast('warning', '無法領取', '文件尚未準備完成');
                return;
            }

            showConfirmModal(
                '確認領取文件',
                `確認領取「${app.typeName}」嗎？<br><br>
                 <strong>領取資訊：</strong><br>
                 申請編號：${app.id}<br>
                 文件類型：${app.typeName} (${app.languageName})<br>
                 份數：${app.copies}份<br><br>
                 領取後狀態將更新為「已完成」`,
                function() {
                    app.status = 'completed';
                    app.statusName = '已完成';
                    loadDocumentApplications();
                    showToast('success', '領取成功', `已成功領取${app.typeName}`);
                }
            );
        }

        // 下載文件
        function downloadDocument(appId) {
            const app = documentApplicationData.applications.find(a => a.id === appId);
            if (!app) return;

            if (app.status !== 'completed') {
                showToast('warning', '無法下載', '文件尚未完成');
                return;
            }

            // 模擬文件下載
            showToast('info', '下載中', `正在下載 ${app.typeName}...`);
            
            // 實際應用中這裡會處理真正的文件下載
            setTimeout(() => {
                showToast('success', '下載完成', `${app.typeName} 已成功下載`);
            }, 1000);
        }

        // ===========================================
        // 全域課程資料庫系統 - 統一管理所有課程資料
        // ===========================================
        
        let globalCourseDatabase = {
            // 學院和系所對應關係
            collegesDepartments: {
                '工學院': ['資訊工程系', '電機工程系', '機械工程系', '土木工程系', '化學工程系', '材料科學系'],
                '理學院': ['數學系', '物理系', '化學系', '生物系', '統計系', '應用數學系'],
                '文學院': ['中國文學系', '外國語文系', '歷史系', '哲學系', '藝術系', '音樂系'],
                '商學院': ['企業管理系', '會計系', '經濟系', '財務金融系', '國際貿易系', '資訊管理系'],
                '醫學院': ['醫學系', '護理系', '藥學系', '公共衛生系', '醫學檢驗系', '物理治療系'],
                '社會科學院': ['社會學系', '政治學系', '心理學系', '社會工作系', '新聞傳播系', '法律系']
            },
            
            // 時間段定義
            timePeriods: {
                '1': '08:10-09:00',
                '2': '09:10-10:00', 
                '3': '10:20-11:10',
                '4': '11:20-12:10',
                '5': '13:20-14:10',
                '6': '14:20-15:10',
                '7': '15:30-16:20',
                '8': '16:30-17:20',
                '9': '18:20-19:10',
                '10': '19:20-20:10',
                '11': '20:20-21:10'
            },
            
            // 週次定義
            weekDays: {
                '1': '週一',
                '2': '週二', 
                '3': '週三',
                '4': '週四',
                '5': '週五',
                '6': '週六',
                '7': '週日'
            },
            
            // 課程主資料庫
            courses: [
                // 資訊工程系課程
                {
                    id: 'CS101',
                    name: '程式設計基礎',
                    code: 'CS101',
                    college: '工學院',
                    department: '資訊工程系',
                    instructor: '張志明',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'E101',
                    schedule: '週二 10:20-13:10',
                    scheduleCode: '2-3,4,5', // 週二第3,4,5節
                    maxStudents: 60,
                    currentStudents: 45,
                    description: '程式設計基礎概念，包含變數、迴圈、函數等基本語法',
                    prerequisites: '無',
                    textbook: '程式設計入門 - C語言 (第三版)',
                    status: '開放選課',
                    syllabus: 'https://example.com/cs101-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、作業30%、出席10%',
                    officeHours: '週三 14:00-16:00',
                    assistants: ['李小明', '王小華'],
                    announcements: [
                        { date: '2024-02-15', title: '第一次作業發布', content: '請於下週三前繳交' },
                        { date: '2024-02-20', title: '期中考日期', content: '預定4月10日舉行' }
                    ]
                },
                {
                    id: 'CS102',
                    name: '計算機概論',
                    code: 'CS102',
                    college: '工學院',
                    department: '資訊工程系',
                    instructor: '陳美玲',
                    credits: 2,
                    hours: 2,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'E102',
                    schedule: '週四 15:30-17:20',
                    scheduleCode: '4-7,8', // 週四第7,8節
                    maxStudents: 50,
                    currentStudents: 42,
                    description: '計算機硬體、軟體、網路基礎知識介紹',
                    prerequisites: '無',
                    textbook: '計算機概論 (第五版)',
                    status: '開放選課',
                    syllabus: 'https://example.com/cs102-syllabus.pdf',
                    evaluationMethod: '期中考40%、期末考40%、報告20%',
                    officeHours: '週五 10:00-12:00',
                    assistants: ['劉大明'],
                    announcements: []
                },
                {
                    id: 'CS201',
                    name: '資料結構',
                    code: 'CS201',
                    college: '工學院',
                    department: '資訊工程系',
                    instructor: '林建志',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 2,
                    type: '必修',
                    classroom: 'E201',
                    schedule: '週三 13:20-16:10',
                    scheduleCode: '3-5,6,7', // 週三第5,6,7節
                    maxStudents: 45,
                    currentStudents: 38,
                    description: '陣列、鏈結串列、堆疊、佇列、樹狀結構等資料結構',
                    prerequisites: 'CS101 程式設計基礎',
                    textbook: 'Data Structures and Algorithms in C++',
                    status: '開放選課',
                    syllabus: 'https://example.com/cs201-syllabus.pdf',
                    evaluationMethod: '期中考25%、期末考25%、程式作業40%、出席10%',
                    officeHours: '週二 13:00-15:00',
                    assistants: ['周小芳', '黃大華'],
                    announcements: [
                        { date: '2024-02-18', title: '第一次程式作業', content: 'Linked List實作，期限3/1' }
                    ]
                },
                {
                    id: 'CS301',
                    name: '資料庫系統',
                    code: 'CS301',
                    college: '工學院',
                    department: '資訊工程系',
                    instructor: '王志強',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 3,
                    type: '必修',
                    classroom: 'E301',
                    schedule: '週一 09:10-12:00',
                    scheduleCode: '1-2,3,4', // 週一第2,3,4節
                    maxStudents: 40,
                    currentStudents: 35,
                    description: '關聯式資料庫設計、SQL語言、資料庫管理系統',
                    prerequisites: 'CS201 資料結構',
                    textbook: 'Database System Concepts (7th Edition)',
                    status: '開放選課',
                    syllabus: 'https://example.com/cs301-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、專題30%、出席10%',
                    officeHours: '週四 14:00-16:00',
                    assistants: ['鄭小明'],
                    announcements: []
                },
                {
                    id: 'CS401',
                    name: '人工智慧',
                    code: 'CS401',
                    college: '工學院',
                    department: '資訊工程系',
                    instructor: '李智慧',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 4,
                    type: '選修',
                    classroom: 'E401',
                    schedule: '週五 13:20-16:10',
                    scheduleCode: '5-5,6,7', // 週五第5,6,7節
                    maxStudents: 30,
                    currentStudents: 28,
                    description: '機器學習、深度學習、自然語言處理基礎',
                    prerequisites: 'CS301 資料庫系統, MATH201 線性代數',
                    textbook: 'Artificial Intelligence: A Modern Approach',
                    status: '開放選課',
                    syllabus: 'https://example.com/cs401-syllabus.pdf',
                    evaluationMethod: '期中考25%、期末考25%、專題報告35%、作業15%',
                    officeHours: '週三 15:00-17:00',
                    assistants: ['楊小智', '馬大明'],
                    announcements: [
                        { date: '2024-02-25', title: '專題報告分組', content: '請於3/5前完成分組' }
                    ]
                },

                // 電機工程系課程
                {
                    id: 'EE101',
                    name: '電路學',
                    code: 'EE101',
                    college: '工學院',
                    department: '電機工程系',
                    instructor: '黃志成',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'F101',
                    schedule: '週一 10:20-13:10',
                    scheduleCode: '1-3,4,5', // 週一第3,4,5節
                    maxStudents: 50,
                    currentStudents: 47,
                    description: '基本電路分析、歐姆定律、基爾霍夫定律',
                    prerequisites: 'MATH101 微積分',
                    textbook: 'Fundamentals of Electric Circuits',
                    status: '開放選課',
                    syllabus: 'https://example.com/ee101-syllabus.pdf',
                    evaluationMethod: '期中考35%、期末考35%、實驗20%、出席10%',
                    officeHours: '週二 14:00-16:00',
                    assistants: ['陳小電'],
                    announcements: []
                },
                {
                    id: 'EE201',
                    name: '電子學',
                    code: 'EE201',
                    college: '工學院',
                    department: '電機工程系',
                    instructor: '劉電子',
                    credits: 4,
                    hours: 4,
                    semester: '113-1',
                    year: 2,
                    type: '必修',
                    classroom: 'F201',
                    schedule: '週二 08:10-12:00',
                    scheduleCode: '2-1,2,3,4', // 週二第1,2,3,4節
                    maxStudents: 45,
                    currentStudents: 40,
                    description: '二極體、電晶體、放大器電路設計',
                    prerequisites: 'EE101 電路學',
                    textbook: 'Electronic Devices and Circuit Theory',
                    status: '開放選課',
                    syllabus: 'https://example.com/ee201-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、實驗30%、作業10%',
                    officeHours: '週三 10:00-12:00',
                    assistants: ['王小晶'],
                    announcements: []
                },

                // 數學系課程
                {
                    id: 'MATH101',
                    name: '微積分',
                    code: 'MATH101',
                    college: '理學院',
                    department: '數學系',
                    instructor: '陳數學',
                    credits: 4,
                    hours: 4,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'A101',
                    schedule: '週一 08:10-10:00, 週三 08:10-10:00',
                    scheduleCode: '1-1,2;3-1,2', // 週一第1,2節；週三第1,2節
                    maxStudents: 80,
                    currentStudents: 75,
                    description: '極限、導數、積分、微分方程基礎',
                    prerequisites: '無',
                    textbook: 'Calculus: Early Transcendentals',
                    status: '開放選課',
                    syllabus: 'https://example.com/math101-syllabus.pdf',
                    evaluationMethod: '期中考40%、期末考40%、小考20%',
                    officeHours: '週二 15:00-17:00',
                    assistants: ['林小分', '黃大積'],
                    announcements: [
                        { date: '2024-02-20', title: '第一次小考', content: '範圍第1-3章，預定3/8舉行' }
                    ]
                },
                {
                    id: 'MATH201',
                    name: '線性代數',
                    code: 'MATH201',
                    college: '理學院',
                    department: '數學系',
                    instructor: '王代數',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 2,
                    type: '必修',
                    classroom: 'A201',
                    schedule: '週二 13:20-16:10',
                    scheduleCode: '2-5,6,7', // 週二第5,6,7節
                    maxStudents: 60,
                    currentStudents: 55,
                    description: '矩陣運算、向量空間、特徵值與特徵向量',
                    prerequisites: 'MATH101 微積分',
                    textbook: 'Linear Algebra and Its Applications',
                    status: '開放選課',
                    syllabus: 'https://example.com/math201-syllabus.pdf',
                    evaluationMethod: '期中考35%、期末考35%、作業20%、出席10%',
                    officeHours: '週四 10:00-12:00',
                    assistants: ['鄭小線'],
                    announcements: []
                },

                // 物理系課程
                {
                    id: 'PHY101',
                    name: '普通物理學',
                    code: 'PHY101',
                    college: '理學院',
                    department: '物理系',
                    instructor: '牛頓',
                    credits: 4,
                    hours: 4,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'D101',
                    schedule: '週一 13:20-15:10, 週三 13:20-15:10',
                    scheduleCode: '1-5,6;3-5,6', // 週一第5,6節；週三第5,6節
                    maxStudents: 60,
                    currentStudents: 60,
                    description: '力學、熱學、電磁學基礎',
                    prerequisites: 'MATH101 微積分',
                    textbook: 'University Physics with Modern Physics',
                    status: '已額滿',
                    syllabus: 'https://example.com/phy101-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、實驗25%、作業15%',
                    officeHours: '週二 10:00-12:00',
                    assistants: ['愛因斯坦'],
                    announcements: []
                },

                // 化學系課程
                {
                    id: 'CHEM101',
                    name: '普通化學',
                    code: 'CHEM101',
                    college: '理學院',
                    department: '化學系',
                    instructor: '居禮夫人',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'D201',
                    schedule: '週四 10:20-13:10',
                    scheduleCode: '4-3,4,5', // 週四第3,4,5節
                    maxStudents: 55,
                    currentStudents: 50,
                    description: '原子結構、化學鍵、化學反應',
                    prerequisites: '無',
                    textbook: 'General Chemistry: Principles and Modern Applications',
                    status: '開放選課',
                    syllabus: 'https://example.com/chem101-syllabus.pdf',
                    evaluationMethod: '期中考35%、期末考35%、實驗20%、出席10%',
                    officeHours: '週五 15:00-17:00',
                    assistants: ['道耳頓'],
                    announcements: []
                },

                // 外語系課程
                {
                    id: 'ENG101',
                    name: '大一英文',
                    code: 'ENG101',
                    college: '文學院',
                    department: '外國語文系',
                    instructor: 'Shakespeare',
                    credits: 2,
                    hours: 2,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'C301',
                    schedule: '週三 15:30-17:20',
                    scheduleCode: '3-7,8', // 週三第7,8節
                    maxStudents: 30,
                    currentStudents: 28,
                    description: '英語聽說讀寫綜合訓練',
                    prerequisites: '無',
                    textbook: 'English File Upper-Intermediate',
                    status: '開放選課',
                    syllabus: 'https://example.com/eng101-syllabus.pdf',
                    evaluationMethod: '期中考25%、期末考25%、口試25%、作業25%',
                    officeHours: 'Tuesday 2:00-4:00 PM',
                    assistants: ['Jane Austen'],
                    announcements: []
                },

                // 商學院課程
                {
                    id: 'BA101',
                    name: '管理學',
                    code: 'BA101',
                    college: '商學院',
                    department: '企業管理系',
                    instructor: '張管理',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'B101',
                    schedule: '週三 10:20-13:10',
                    scheduleCode: '3-3,4,5', // 週三第3,4,5節
                    maxStudents: 70,
                    currentStudents: 65,
                    description: '管理理論、組織行為、領導統御',
                    prerequisites: '無',
                    textbook: 'Management: Leading & Collaborating',
                    status: '開放選課',
                    syllabus: 'https://example.com/ba101-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、個案分析25%、出席15%',
                    officeHours: '週四 13:00-15:00',
                    assistants: ['劉小管'],
                    announcements: []
                },
                {
                    id: 'ECON101',
                    name: '經濟學原理',
                    code: 'ECON101',
                    college: '商學院',
                    department: '經濟系',
                    instructor: '亞當斯密',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'B301',
                    schedule: '週一 15:30-18:20',
                    scheduleCode: '1-7,8,9', // 週一第7,8,9節
                    maxStudents: 80,
                    currentStudents: 75,
                    description: '供需理論、市場結構、總體經濟政策',
                    prerequisites: '無',
                    textbook: 'Principles of Economics (8th Edition)',
                    status: '開放選課',
                    syllabus: 'https://example.com/econ101-syllabus.pdf',
                    evaluationMethod: '期中考40%、期末考40%、作業20%',
                    officeHours: '週三 14:00-16:00',
                    assistants: ['凱因斯'],
                    announcements: []
                },

                // 心理系課程
                {
                    id: 'PSY101',
                    name: '普通心理學',
                    code: 'PSY101',
                    college: '社會科學院',
                    department: '心理學系',
                    instructor: '佛洛伊德',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'G101',
                    schedule: '週二 09:10-12:00',
                    scheduleCode: '2-2,3,4', // 週二第2,3,4節
                    maxStudents: 70,
                    currentStudents: 65,
                    description: '認知、學習、記憶、情緒等心理歷程',
                    prerequisites: '無',
                    textbook: 'Psychology: The Science of Mind and Behaviour',
                    status: '開放選課',
                    syllabus: 'https://example.com/psy101-syllabus.pdf',
                    evaluationMethod: '期中考30%、期末考30%、實驗報告25%、出席15%',
                    officeHours: '週四 14:00-16:00',
                    assistants: ['榮格'],
                    announcements: []
                },
                {
                    id: 'SOC101',
                    name: '社會學概論',
                    code: 'SOC101',
                    college: '社會科學院',
                    department: '社會學系',
                    instructor: '韋伯',
                    credits: 3,
                    hours: 3,
                    semester: '113-1',
                    year: 1,
                    type: '必修',
                    classroom: 'G201',
                    schedule: '週五 10:20-13:10',
                    scheduleCode: '5-3,4,5', // 週五第3,4,5節
                    maxStudents: 60,
                    currentStudents: 55,
                    description: '社會結構、社會制度、社會變遷',
                    prerequisites: '無',
                    textbook: 'Sociology: A Global Perspective',
                    status: '開放選課',
                    syllabus: 'https://example.com/soc101-syllabus.pdf',
                    evaluationMethod: '期中考35%、期末考35%、田野調查20%、出席10%',
                    officeHours: '週一 13:00-15:00',
                    assistants: ['涂爾幹'],
                    announcements: []
                }
            ],
            
            // 課程資料庫操作方法
            getCourseById: function(courseId) {
                return this.courses.find(course => course.id === courseId);
            },
            
            getCoursesByDepartment: function(department) {
                return this.courses.filter(course => course.department === department);
            },
            
            getCoursesByCollege: function(college) {
                return this.courses.filter(course => course.college === college);
            },
            
            getCoursesBySemester: function(semester) {
                return this.courses.filter(course => course.semester === semester);
            },
            
            getCoursesByInstructor: function(instructor) {
                return this.courses.filter(course => course.instructor === instructor);
            },
            
            getAvailableCourses: function() {
                return this.courses.filter(course => course.status === '開放選課');
            },
            
            addCourse: function(courseData) {
                // 檢查課程代碼是否重複
                if (this.getCourseById(courseData.id)) {
                    return { success: false, message: '課程代碼已存在' };
                }
                
                this.courses.push(courseData);
                return { success: true, message: '課程新增成功' };
            },
            
            updateCourse: function(courseId, updateData) {
                const courseIndex = this.courses.findIndex(course => course.id === courseId);
                if (courseIndex === -1) {
                    return { success: false, message: '找不到課程' };
                }
                
                this.courses[courseIndex] = { ...this.courses[courseIndex], ...updateData };
                return { success: true, message: '課程更新成功' };
            },
            
            deleteCourse: function(courseId) {
                const courseIndex = this.courses.findIndex(course => course.id === courseId);
                if (courseIndex === -1) {
                    return { success: false, message: '找不到課程' };
                }
                
                this.courses.splice(courseIndex, 1);
                return { success: true, message: '課程刪除成功' };
            },
            
            // 解析課程時間為課表格式
            parseScheduleToGrid: function(scheduleCode) {
                const schedule = {};
                if (!scheduleCode) return schedule;
                
                const parts = scheduleCode.split(';');
                parts.forEach(part => {
                    const [dayCode, periods] = part.split('-');
                    const day = parseInt(dayCode);
                    const periodList = periods.split(',').map(p => parseInt(p));
                    
                    if (!schedule[day]) schedule[day] = [];
                    schedule[day] = [...schedule[day], ...periodList];
                });
                
                return schedule;
            },
            
            // 檢查時間衝突
            checkTimeConflict: function(courseIds) {
                const scheduleGrid = {};
                
                courseIds.forEach(courseId => {
                    const course = this.getCourseById(courseId);
                    if (!course || !course.scheduleCode) return;
                    
                    const schedule = this.parseScheduleToGrid(course.scheduleCode);
                    Object.keys(schedule).forEach(day => {
                        if (!scheduleGrid[day]) scheduleGrid[day] = {};
                        
                        schedule[day].forEach(period => {
                            if (scheduleGrid[day][period]) {
                                // 發現衝突
                                return {
                                    conflict: true,
                                    course1: scheduleGrid[day][period],
                                    course2: course.name,
                                    time: `${this.weekDays[day]} 第${period}節`
                                };
                            }
                            scheduleGrid[day][period] = course.name;
                        });
                    });
                });
                
                return { conflict: false };
            }
        };

        // 為了向後兼容，讓舊的 staffCourseData 指向新的全域資料庫
        let staffCourseData = {
            get collegesDepartments() {
                return globalCourseDatabase.collegesDepartments;
            },
            get courses() {
                return globalCourseDatabase.courses;
            },
            set courses(value) {
                globalCourseDatabase.courses = value;
            },
            pagination: {
                currentPage: 1,
                itemsPerPage: 10,
                totalPages: 0
            },
            filters: {
                search: '',
                college: '',
                department: '',
                semester: '',
                status: ''
            }
        };

        // 教職員課程管理系統資料

        // 初始化教職員課程管理系統
        function initStaffCourseSystem() {
            console.log('初始化教職員課程管理系統');
            
            // 綁定事件監聽器
            bindCourseSystemEvents();
            
            // 載入系所選項
            loadDepartmentOptions();
            
            // 載入課程列表
            loadStaffCourses();
            
            // 更新統計
            updateCourseStatistics();
        }

        // 綁定事件監聽器
        function bindCourseSystemEvents() {
            // 搜尋框
            const searchInput = document.getElementById('course-search');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    staffCourseData.filters.search = this.value;
                    staffCourseData.pagination.currentPage = 1;
                    loadStaffCourses();
                });
            }

            // 學院篩選
            const collegeFilter = document.getElementById('college-filter');
            if (collegeFilter) {
                collegeFilter.addEventListener('change', function() {
                    staffCourseData.filters.college = this.value;
                    loadDepartmentOptions();
                    staffCourseData.filters.department = '';
                    document.getElementById('department-filter').value = '';
                    staffCourseData.pagination.currentPage = 1;
                    loadStaffCourses();
                });
            }

            // 系所篩選
            const departmentFilter = document.getElementById('department-filter');
            if (departmentFilter) {
                departmentFilter.addEventListener('change', function() {
                    staffCourseData.filters.department = this.value;
                    staffCourseData.pagination.currentPage = 1;
                    loadStaffCourses();
                });
            }

            // 學期篩選
            const semesterFilter = document.getElementById('semester-filter');
            if (semesterFilter) {
                semesterFilter.addEventListener('change', function() {
                    staffCourseData.filters.semester = this.value;
                    staffCourseData.pagination.currentPage = 1;
                    loadStaffCourses();
                });
            }

            // 狀態篩選
            const statusFilter = document.getElementById('status-filter');
            if (statusFilter) {
                statusFilter.addEventListener('change', function() {
                    staffCourseData.filters.status = this.value;
                    staffCourseData.pagination.currentPage = 1;
                    loadStaffCourses();
                });
            }
        }

        // 載入系所選項
        function loadDepartmentOptions() {
            const departmentFilter = document.getElementById('department-filter');
            if (!departmentFilter) return;

            const selectedCollege = staffCourseData.filters.college;
            let departments = [];

            if (selectedCollege && staffCourseData.collegesDepartments[selectedCollege]) {
                departments = staffCourseData.collegesDepartments[selectedCollege];
            } else {
                // 顯示所有系所
                departments = Object.values(staffCourseData.collegesDepartments).flat();
            }

            departmentFilter.innerHTML = '<option value="">全部系所</option>' +
                departments.map(dept => `<option value="${dept}">${dept}</option>`).join('');
        }

        // 載入課程列表
        function loadStaffCourses() {
            const tbody = document.getElementById('staff-courses-list');
            if (!tbody) return;

            // 應用篩選
            let filteredCourses = staffCourseData.courses.filter(course => {
                const searchMatch = !staffCourseData.filters.search || 
                    course.name.toLowerCase().includes(staffCourseData.filters.search.toLowerCase()) ||
                    course.code.toLowerCase().includes(staffCourseData.filters.search.toLowerCase()) ||
                    course.instructor.toLowerCase().includes(staffCourseData.filters.search.toLowerCase());

                const collegeMatch = !staffCourseData.filters.college || course.college === staffCourseData.filters.college;
                const departmentMatch = !staffCourseData.filters.department || course.department === staffCourseData.filters.department;
                const semesterMatch = !staffCourseData.filters.semester || course.semester === staffCourseData.filters.semester;
                const statusMatch = !staffCourseData.filters.status || course.status === staffCourseData.filters.status;

                return searchMatch && collegeMatch && departmentMatch && semesterMatch && statusMatch;
            });

            // 計算分頁
            const totalItems = filteredCourses.length;
            const totalPages = Math.ceil(totalItems / staffCourseData.pagination.itemsPerPage);
            staffCourseData.pagination.totalPages = totalPages;

            // 確保當前頁面不超過總頁數
            if (staffCourseData.pagination.currentPage > totalPages) {
                staffCourseData.pagination.currentPage = Math.max(1, totalPages);
            }

            // 取得當前頁面的資料
            const startIndex = (staffCourseData.pagination.currentPage - 1) * staffCourseData.pagination.itemsPerPage;
            const endIndex = startIndex + staffCourseData.pagination.itemsPerPage;
            const currentPageCourses = filteredCourses.slice(startIndex, endIndex);

            // 渲染課程列表
            if (currentPageCourses.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="bi bi-search display-6 d-block mb-2"></i>
                            沒有找到符合條件的課程
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = currentPageCourses.map(course => {
                    const statusBadge = getCourseStatusBadge(course.status);
                    const enrollmentRate = (course.currentStudents / course.maxStudents * 100).toFixed(1);
                    const enrollmentClass = enrollmentRate >= 90 ? 'danger' : enrollmentRate >= 70 ? 'warning' : 'success';

                    return `
                        <tr>
                            <td>
                                <div class="fw-bold">${course.name}</div>
                                <small class="text-muted">${course.code} | ${course.instructor}</small><br>
                                <small class="text-muted">${course.college} - ${course.department}</small><br>
                                <small class="text-muted">${course.credits}學分 | ${course.type} | ${course.semester}</small>
                            </td>
                            <td>
                                <div class="fw-bold">${course.schedule}</div>
                                <small class="text-muted">
                                    <i class="bi bi-geo-alt me-1"></i>${course.classroom}
                                </small>
                            </td>
                            <td>
                                <div class="progress mb-1" style="height: 20px;">
                                    <div class="progress-bar bg-${enrollmentClass}" style="width: ${enrollmentRate}%">
                                        ${course.currentStudents}/${course.maxStudents}
                                    </div>
                                </div>
                                <small class="text-muted">${enrollmentRate}% 滿</small>
                            </td>
                            <td>${statusBadge}</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="viewCourseDetails('${course.id}')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="manageCourseStudents('${course.id}')">
                                        <i class="bi bi-people"></i>
                                    </button>
                                    <button class="btn btn-outline-info" onclick="editCourse('${course.id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-success" onclick="courseAnnouncements('${course.id}')">
                                        <i class="bi bi-megaphone"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // 更新分頁
            updateCoursePagination();
            
            // 更新統計
            updateCourseStatistics();
        }

        // 更新分頁
        function updateCoursePagination() {
            const pagination = document.getElementById('courses-pagination');
            if (!pagination) return;

            const currentPage = staffCourseData.pagination.currentPage;
            const totalPages = staffCourseData.pagination.totalPages;

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // 上一頁
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">上一頁</a>
                </li>
            `;

            // 頁碼
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }

            // 下一頁
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">下一頁</a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        }

        // 更改頁面
        function changePage(page) {
            if (page < 1 || page > staffCourseData.pagination.totalPages) return;
            staffCourseData.pagination.currentPage = page;
            loadStaffCourses();
        }

        // 更新課程統計
        function updateCourseStatistics() {
            const totalCoursesElement = document.getElementById('total-courses-count');
            const activeCoursesElement = document.getElementById('active-courses-count');
            const fullCoursesElement = document.getElementById('full-courses-count');
            const totalStudentsElement = document.getElementById('total-students-count');

            if (!totalCoursesElement) return;

            const totalCourses = staffCourseData.courses.length;
            const activeCourses = staffCourseData.courses.filter(c => c.status === '開放選課').length;
            const fullCourses = staffCourseData.courses.filter(c => c.status === '已額滿').length;
            const totalStudents = staffCourseData.courses.reduce((sum, c) => sum + c.currentStudents, 0);

            totalCoursesElement.textContent = totalCourses;
            activeCoursesElement.textContent = activeCourses;
            fullCoursesElement.textContent = fullCourses;
            totalStudentsElement.textContent = totalStudents;
        }

        // 獲取課程狀態徽章
        function getCourseStatusBadge(status) {
            switch (status) {
                case '開放選課':
                    return '<span class="badge bg-success">開放選課</span>';
                case '已額滿':
                    return '<span class="badge bg-danger">已額滿</span>';
                case '停開':
                    return '<span class="badge bg-secondary">停開</span>';
                case '已結束':
                    return '<span class="badge bg-dark">已結束</span>';
                default:
                    return '<span class="badge bg-secondary">未知</span>';
            }
        }

        // 重置篩選器
        function resetCourseFilters() {
            staffCourseData.filters = {
                search: '',
                college: '',
                department: '',
                semester: '',
                status: ''
            };

            document.getElementById('course-search').value = '';
            document.getElementById('college-filter').value = '';
            document.getElementById('department-filter').value = '';
            document.getElementById('semester-filter').value = '';
            document.getElementById('status-filter').value = '';

            loadDepartmentOptions();
            staffCourseData.pagination.currentPage = 1;
            loadStaffCourses();
        }

        // 查看課程詳情
        function viewCourseDetails(courseId) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course) return;

            const enrollmentRate = (course.currentStudents / course.maxStudents * 100).toFixed(1);
            
            showConfirmModal(
                `課程詳情 - ${course.name}`,
                `
                <div class="row">
                    <div class="col-12">
                        <h6><i class="bi bi-book me-2"></i>基本資訊</h6>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><strong>課程代碼：</strong>${course.code}</li>
                                    <li><strong>課程名稱：</strong>${course.name}</li>
                                    <li><strong>授課教師：</strong>${course.instructor}</li>
                                    <li><strong>學分數：</strong>${course.credits}學分</li>
                                    <li><strong>週時數：</strong>${course.hours}小時</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><strong>學院：</strong>${course.college}</li>
                                    <li><strong>系所：</strong>${course.department}</li>
                                    <li><strong>學期：</strong>${course.semester}</li>
                                    <li><strong>年級：</strong>${course.year}年級</li>
                                    <li><strong>類別：</strong>${course.type}</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h6><i class="bi bi-clock me-2"></i>時間地點</h6>
                        <ul class="list-unstyled mb-3">
                            <li><strong>上課時間：</strong>${course.schedule}</li>
                            <li><strong>教室：</strong>${course.classroom}</li>
                        </ul>
                        
                        <h6><i class="bi bi-people me-2"></i>選課狀況</h6>
                        <div class="progress mb-2" style="height: 25px;">
                            <div class="progress-bar ${enrollmentRate >= 90 ? 'bg-danger' : enrollmentRate >= 70 ? 'bg-warning' : 'bg-success'}" 
                                 style="width: ${enrollmentRate}%">
                                ${course.currentStudents}/${course.maxStudents} (${enrollmentRate}%)
                            </div>
                        </div>
                        <p class="mb-3"><strong>狀態：</strong>${getCourseStatusBadge(course.status)}</p>
                        
                        <h6><i class="bi bi-file-text me-2"></i>課程描述</h6>
                        <p class="mb-3">${course.description}</p>
                        
                        <h6><i class="bi bi-bookmark me-2"></i>先修科目</h6>
                        <p class="mb-3">${course.prerequisites}</p>
                        
                        <h6><i class="bi bi-book-half me-2"></i>指定教科書</h6>
                        <p class="mb-3">${course.textbook}</p>
                        
                        <h6><i class="bi bi-clipboard-check me-2"></i>評分方式</h6>
                        <p class="mb-3">${course.evaluationMethod}</p>
                        
                        <h6><i class="bi bi-calendar-week me-2"></i>Office Hours</h6>
                        <p class="mb-3">${course.officeHours}</p>
                        
                        <h6><i class="bi bi-person-plus me-2"></i>教學助理</h6>
                        <p class="mb-3">${course.assistants.join('、')}</p>
                        
                        ${course.announcements.length > 0 ? `
                        <h6><i class="bi bi-megaphone me-2"></i>課程公告</h6>
                        <div class="mb-3">
                            ${course.announcements.map(ann => `
                                <div class="border-start border-primary ps-3 mb-2">
                                    <div class="fw-bold">${ann.title}</div>
                                    <small class="text-muted">${ann.date}</small>
                                    <p class="mb-0">${ann.content}</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                </div>
                `,
                null
            );

            // 隱藏確認按鈕
            document.getElementById('confirmModalConfirm').style.display = 'none';
            
            // 當模態框關閉時恢復確認按鈕
            const modal = document.getElementById('confirmModal');
            modal.addEventListener('hidden.bs.modal', function() {
                document.getElementById('confirmModalConfirm').style.display = 'block';
            }, { once: true });
        }

        // 管理課程學生
        function manageCourseStudents(courseId) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course) return;

            // 生成模擬學生資料
            const students = generateMockStudents(course.currentStudents);
            
            showConfirmModal(
                `學生管理 - ${course.name}`,
                `
                <div class="mb-3">
                    <h6>選課學生名單 (${course.currentStudents}/${course.maxStudents})</h6>
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-sm">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th>學號</th>
                                    <th>姓名</th>
                                    <th>系所</th>
                                    <th>年級</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.map(student => `
                                    <tr>
                                        <td>${student.id}</td>
                                        <td>${student.name}</td>
                                        <td>${student.department}</td>
                                        <td>${student.year}年級</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-danger" onclick="removeStudentFromCourse('${courseId}', '${student.id}')">
                                                <i class="bi bi-x"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                `,
                null
            );

            // 隱藏確認按鈕
            document.getElementById('confirmModalConfirm').style.display = 'none';
            
            // 當模態框關閉時恢復確認按鈕
            const modal = document.getElementById('confirmModal');
            modal.addEventListener('hidden.bs.modal', function() {
                document.getElementById('confirmModalConfirm').style.display = 'block';
            }, { once: true });
        }

        // 生成模擬學生資料
        function generateMockStudents(count) {
            const lastNames = ['王', '李', '張', '劉', '陳', '楊', '黃', '吳', '林', '周', '徐', '朱', '馬', '胡', '鄭', '高', '梁', '謝', '韓', '唐'];
            const firstNames = ['小明', '小華', '小美', '大雄', '靜香', '小傑', '雅婷', '志明', '春嬌', '阿強', '小芬', '大偉', '美玲', '建華', '淑芬', '家豪', '怡君', '俊傑', '雅慧', '志偉'];
            const departments = ['資訊工程系', '電機工程系', '機械工程系', '企業管理系', '經濟系', '數學系', '物理系', '化學系'];
            
            const students = [];
            for (let i = 0; i < count; i++) {
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const department = departments[Math.floor(Math.random() * departments.length)];
                const year = Math.floor(Math.random() * 4) + 1;
                const studentId = `${year}${String(Math.floor(Math.random() * 900) + 100).padStart(3, '0')}${String(i + 1).padStart(3, '0')}`;
                
                students.push({
                    id: studentId,
                    name: lastName + firstName,
                    department: department,
                    year: year
                });
            }
            
            return students.sort((a, b) => a.id.localeCompare(b.id));
        }

        // 移除學生從課程
        function removeStudentFromCourse(courseId, studentId) {
            showConfirmModal(
                '確認移除學生',
                '確定要將此學生從課程中移除嗎？',
                function() {
                    const course = staffCourseData.courses.find(c => c.id === courseId);
                    if (course) {
                        course.currentStudents = Math.max(0, course.currentStudents - 1);
                        showAlert('success', '學生已成功移除');
                        loadStaffCourses();
                        // 重新打開學生管理視窗
                        setTimeout(() => manageCourseStudents(courseId), 500);
                    }
                }
            );
        }

        // 編輯課程
        function editCourse(courseId) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course) return;

            showConfirmModal(
                `編輯課程 - ${course.name}`,
                `
                <form id="editCourseForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程代碼</label>
                            <input type="text" class="form-control" id="edit-course-code" value="${course.code}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程名稱 *</label>
                            <input type="text" class="form-control" id="edit-course-name" value="${course.name}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">授課教師 *</label>
                            <input type="text" class="form-control" id="edit-course-instructor" value="${course.instructor}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">學分數 *</label>
                            <select class="form-control" id="edit-course-credits" required>
                                <option value="1" ${course.credits === 1 ? 'selected' : ''}>1學分</option>
                                <option value="2" ${course.credits === 2 ? 'selected' : ''}>2學分</option>
                                <option value="3" ${course.credits === 3 ? 'selected' : ''}>3學分</option>
                                <option value="4" ${course.credits === 4 ? 'selected' : ''}>4學分</option>
                                <option value="5" ${course.credits === 5 ? 'selected' : ''}>5學分</option>
                                <option value="6" ${course.credits === 6 ? 'selected' : ''}>6學分</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">週時數</label>
                            <input type="number" class="form-control" id="edit-course-hours" value="${course.hours}" min="1" max="10">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程類別</label>
                            <select class="form-control" id="edit-course-type">
                                <option value="必修" ${course.type === '必修' ? 'selected' : ''}>必修</option>
                                <option value="選修" ${course.type === '選修' ? 'selected' : ''}>選修</option>
                                <option value="通識" ${course.type === '通識' ? 'selected' : ''}>通識</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">教室</label>
                            <input type="text" class="form-control" id="edit-course-classroom" value="${course.classroom}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">上課時間</label>
                            <input type="text" class="form-control" id="edit-course-schedule" value="${course.schedule}" placeholder="例：週一 10:20-13:10">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">修課人數上限</label>
                            <input type="number" class="form-control" id="edit-course-max-students" value="${course.maxStudents}" min="1" max="200">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程狀態</label>
                            <select class="form-control" id="edit-course-status">
                                <option value="開放選課" ${course.status === '開放選課' ? 'selected' : ''}>開放選課</option>
                                <option value="已額滿" ${course.status === '已額滿' ? 'selected' : ''}>已額滿</option>
                                <option value="停開" ${course.status === '停開' ? 'selected' : ''}>停開</option>
                                <option value="已結束" ${course.status === '已結束' ? 'selected' : ''}>已結束</option>
                            </select>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">課程描述</label>
                            <textarea class="form-control" id="edit-course-description" rows="3">${course.description}</textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">先修科目</label>
                            <input type="text" class="form-control" id="edit-course-prerequisites" value="${course.prerequisites}">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">指定教科書</label>
                            <input type="text" class="form-control" id="edit-course-textbook" value="${course.textbook}">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">評分方式</label>
                            <textarea class="form-control" id="edit-course-evaluation" rows="2">${course.evaluationMethod}</textarea>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Office Hours</label>
                            <input type="text" class="form-control" id="edit-course-office-hours" value="${course.officeHours}">
                        </div>
                    </div>
                </form>
                `,
                function() {
                    const formData = {
                        name: document.getElementById('edit-course-name').value,
                        instructor: document.getElementById('edit-course-instructor').value,
                        credits: parseInt(document.getElementById('edit-course-credits').value),
                        hours: parseInt(document.getElementById('edit-course-hours').value),
                        type: document.getElementById('edit-course-type').value,
                        classroom: document.getElementById('edit-course-classroom').value,
                        schedule: document.getElementById('edit-course-schedule').value,
                        maxStudents: parseInt(document.getElementById('edit-course-max-students').value),
                        status: document.getElementById('edit-course-status').value,
                        description: document.getElementById('edit-course-description').value,
                        prerequisites: document.getElementById('edit-course-prerequisites').value,
                        textbook: document.getElementById('edit-course-textbook').value,
                        evaluationMethod: document.getElementById('edit-course-evaluation').value,
                        officeHours: document.getElementById('edit-course-office-hours').value
                    };

                    // 驗證必填欄位
                    if (!formData.name || !formData.instructor) {
                        showAlert('danger', '請填寫所有必填欄位');
                        return;
                    }

                    // 更新課程資料
                    Object.assign(course, formData);
                    
                    showAlert('success', '課程資料已更新');
                    loadStaffCourses();
                }
            );
        }

        // 課程公告管理
        function courseAnnouncements(courseId) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course) return;

            showConfirmModal(
                `課程公告 - ${course.name}`,
                `
                <div class="mb-3">
                    <button class="btn btn-primary btn-sm" onclick="addCourseAnnouncement('${courseId}')">
                        <i class="bi bi-plus"></i> 新增公告
                    </button>
                </div>
                <div id="announcements-list">
                    ${course.announcements.length === 0 ? 
                        '<div class="text-center text-muted py-4">尚無課程公告</div>' :
                        course.announcements.map((ann, index) => `
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title mb-1">${ann.title}</h6>
                                            <small class="text-muted">${ann.date}</small>
                                            <p class="card-text mt-2">${ann.content}</p>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-info" onclick="editAnnouncement('${courseId}', ${index})">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteAnnouncement('${courseId}', ${index})">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
                `,
                null
            );

            // 隱藏確認按鈕
            document.getElementById('confirmModalConfirm').style.display = 'none';
            
            // 當模態框關閉時恢復確認按鈕
            const modal = document.getElementById('confirmModal');
            modal.addEventListener('hidden.bs.modal', function() {
                document.getElementById('confirmModalConfirm').style.display = 'block';
            }, { once: true });
        }

        // 新增課程公告
        function addCourseAnnouncement(courseId) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course) return;

            showConfirmModal(
                '新增課程公告',
                `
                <form id="addAnnouncementForm">
                    <div class="mb-3">
                        <label class="form-label">公告標題 *</label>
                        <input type="text" class="form-control" id="announcement-title" required placeholder="請輸入公告標題">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">公告內容 *</label>
                        <textarea class="form-control" id="announcement-content" rows="4" required placeholder="請輸入公告內容"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">發布日期</label>
                        <input type="date" class="form-control" id="announcement-date" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                </form>
                `,
                function() {
                    const title = document.getElementById('announcement-title').value;
                    const content = document.getElementById('announcement-content').value;
                    const date = document.getElementById('announcement-date').value;

                    if (!title || !content) {
                        showAlert('danger', '請填寫所有必填欄位');
                        return;
                    }

                    // 新增公告
                    course.announcements.push({
                        date: date,
                        title: title,
                        content: content
                    });

                    showAlert('success', '公告已新增');
                    // 重新打開公告管理視窗
                    setTimeout(() => courseAnnouncements(courseId), 500);
                }
            );
        }

        // 編輯公告
        function editAnnouncement(courseId, announcementIndex) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course || !course.announcements[announcementIndex]) return;

            const announcement = course.announcements[announcementIndex];

            showConfirmModal(
                '編輯課程公告',
                `
                <form id="editAnnouncementForm">
                    <div class="mb-3">
                        <label class="form-label">公告標題 *</label>
                        <input type="text" class="form-control" id="edit-announcement-title" value="${announcement.title}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">公告內容 *</label>
                        <textarea class="form-control" id="edit-announcement-content" rows="4" required>${announcement.content}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">發布日期</label>
                        <input type="date" class="form-control" id="edit-announcement-date" value="${announcement.date}">
                    </div>
                </form>
                `,
                function() {
                    const title = document.getElementById('edit-announcement-title').value;
                    const content = document.getElementById('edit-announcement-content').value;
                    const date = document.getElementById('edit-announcement-date').value;

                    if (!title || !content) {
                        showAlert('danger', '請填寫所有必填欄位');
                        return;
                    }

                    // 更新公告
                    course.announcements[announcementIndex] = {
                        date: date,
                        title: title,
                        content: content
                    };

                    showAlert('success', '公告已更新');
                    // 重新打開公告管理視窗
                    setTimeout(() => courseAnnouncements(courseId), 500);
                }
            );
        }

        // 刪除公告
        function deleteAnnouncement(courseId, announcementIndex) {
            const course = staffCourseData.courses.find(c => c.id === courseId);
            if (!course || !course.announcements[announcementIndex]) return;

            showConfirmModal(
                '確認刪除',
                '確定要刪除這則公告嗎？',
                function() {
                    course.announcements.splice(announcementIndex, 1);
                    showAlert('success', '公告已刪除');
                    // 重新打開公告管理視窗
                    setTimeout(() => courseAnnouncements(courseId), 500);
                }
            );
        }

        // 新增課程
        function addNewCourse() {
            showConfirmModal(
                '新增課程',
                `
                <form id="addCourseForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程代碼 *</label>
                            <input type="text" class="form-control" id="new-course-code" required placeholder="例：CS101">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程名稱 *</label>
                            <input type="text" class="form-control" id="new-course-name" required placeholder="例：程式設計基礎">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">學院 *</label>
                            <select class="form-control" id="new-course-college" required onchange="updateNewCourseDepartments()">
                                <option value="">請選擇學院</option>
                                ${Object.keys(staffCourseData.collegesDepartments).map(college => 
                                    `<option value="${college}">${college}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">系所 *</label>
                            <select class="form-control" id="new-course-department" required>
                                <option value="">請先選擇學院</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">授課教師 *</label>
                            <input type="text" class="form-control" id="new-course-instructor" required placeholder="教師姓名">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">學分數 *</label>
                            <select class="form-control" id="new-course-credits" required>
                                <option value="">請選擇</option>
                                <option value="1">1學分</option>
                                <option value="2">2學分</option>
                                <option value="3">3學分</option>
                                <option value="4">4學分</option>
                                <option value="5">5學分</option>
                                <option value="6">6學分</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">週時數</label>
                            <input type="number" class="form-control" id="new-course-hours" min="1" max="10" value="3">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">學期</label>
                            <select class="form-control" id="new-course-semester">
                                <option value="113-1">113-1</option>
                                <option value="113-2">113-2</option>
                                <option value="114-1">114-1</option>
                                <option value="114-2">114-2</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">年級</label>
                            <select class="form-control" id="new-course-year">
                                <option value="1">1年級</option>
                                <option value="2">2年級</option>
                                <option value="3">3年級</option>
                                <option value="4">4年級</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">課程類別</label>
                            <select class="form-control" id="new-course-type">
                                <option value="必修">必修</option>
                                <option value="選修">選修</option>
                                <option value="通識">通識</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">教室</label>
                            <input type="text" class="form-control" id="new-course-classroom" placeholder="例：E101">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">上課時間</label>
                            <input type="text" class="form-control" id="new-course-schedule" placeholder="例：週一 10:20-13:10">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">修課人數上限</label>
                            <input type="number" class="form-control" id="new-course-max-students" min="1" max="200" value="50">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">課程描述</label>
                            <textarea class="form-control" id="new-course-description" rows="3" placeholder="課程內容簡述"></textarea>
                        </div>
                    </div>
                </form>
                `,
                function() {
                    const formData = {
                        id: document.getElementById('new-course-code').value,
                        code: document.getElementById('new-course-code').value,
                        name: document.getElementById('new-course-name').value,
                        college: document.getElementById('new-course-college').value,
                        department: document.getElementById('new-course-department').value,
                        instructor: document.getElementById('new-course-instructor').value,
                        credits: parseInt(document.getElementById('new-course-credits').value),
                        hours: parseInt(document.getElementById('new-course-hours').value) || 3,
                        semester: document.getElementById('new-course-semester').value,
                        year: parseInt(document.getElementById('new-course-year').value),
                        type: document.getElementById('new-course-type').value,
                        classroom: document.getElementById('new-course-classroom').value,
                        schedule: document.getElementById('new-course-schedule').value,
                        maxStudents: parseInt(document.getElementById('new-course-max-students').value) || 50,
                        currentStudents: 0,
                        description: document.getElementById('new-course-description').value,
                        prerequisites: '無',
                        textbook: '待定',
                        status: '開放選課',
                        syllabus: '',
                        evaluationMethod: '期中考30%、期末考30%、作業30%、出席10%',
                        officeHours: '待定',
                        assistants: [],
                        announcements: []
                    };

                    // 驗證必填欄位
                    if (!formData.code || !formData.name || !formData.college || !formData.department || 
                        !formData.instructor || !formData.credits) {
                        showAlert('danger', '請填寫所有必填欄位');
                        return;
                    }

                    // 檢查課程代碼是否重複
                    if (staffCourseData.courses.find(c => c.code === formData.code)) {
                        showAlert('danger', '課程代碼已存在，請使用不同的代碼');
                        return;
                    }

                    // 新增課程
                    staffCourseData.courses.push(formData);
                    
                    showAlert('success', '課程已新增');
                    loadStaffCourses();
                }
            );
        }

        // 更新新增課程的系所選項
        function updateNewCourseDepartments() {
            const collegeSelect = document.getElementById('new-course-college');
            const departmentSelect = document.getElementById('new-course-department');
            
            if (!collegeSelect || !departmentSelect) return;

            const selectedCollege = collegeSelect.value;
            
            if (selectedCollege && staffCourseData.collegesDepartments[selectedCollege]) {
                const departments = staffCourseData.collegesDepartments[selectedCollege];
                departmentSelect.innerHTML = '<option value="">請選擇系所</option>' +
                    departments.map(dept => `<option value="${dept}">${dept}</option>`).join('');
            } else {
                departmentSelect.innerHTML = '<option value="">請先選擇學院</option>';
            }
        }

        // 匯出課程資料
        function exportCourseData() {
            const currentDate = new Date().toISOString().split('T')[0];
            const csvContent = generateCourseCSV();
            downloadCSV(csvContent, `課程資料_${currentDate}.csv`);
            showAlert('success', '課程資料已匯出');
        }

        // 生成課程CSV資料
        function generateCourseCSV() {
            const headers = ['課程代碼', '課程名稱', '學院', '系所', '授課教師', '學分數', '週時數', '學期', '年級', '類別', '教室', '上課時間', '修課人數上限', '目前修課人數', '課程狀態', '課程描述'];
            
            const rows = staffCourseData.courses.map(course => [
                course.code,
                course.name,
                course.college,
                course.department,
                course.instructor,
                course.credits,
                course.hours,
                course.semester,
                course.year,
                course.type,
                course.classroom,
                course.schedule,
                course.maxStudents,
                course.currentStudents,
                course.status,
                course.description.replace(/,/g, '，') // 替換逗號避免CSV問題
            ]);

            return [headers, ...rows].map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');
        }

        // 下載CSV檔案
        function downloadCSV(content, filename) {
            const BOM = '\uFEFF'; // UTF-8 BOM for Excel compatibility
            const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // 活動報名系統資料
        let activityData = {
            activities: [
                {
                    id: 'act001',
                    title: '程式設計競賽',
                    category: 'academic',
                    organizer: '資訊工程系',
                    date: '2025-08-15',
                    time: '09:00-17:00',
                    location: '電腦教室A',
                    description: '校內程式設計競賽，歡迎所有學生參加。比賽將考驗演算法設計、程式實作能力。',
                    maxParticipants: 50,
                    currentParticipants: 25,
                    registrationDeadline: '2025-08-10',
                    requirements: ['具備程式設計基礎', '自備筆電'],
                    benefits: ['參與證書', '優勝獎金', '學習點數2點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=程式設計競賽'
                },
                {
                    id: 'act002',
                    title: '校園路跑活動',
                    category: 'sports',
                    organizer: '體育室',
                    date: '2025-07-28',
                    time: '07:00-09:00',
                    location: '操場',
                    description: '晨間路跑活動，促進身心健康，全校師生皆可參加。',
                    maxParticipants: 100,
                    currentParticipants: 80,
                    registrationDeadline: '2025-07-26',
                    requirements: ['身體健康', '穿著運動服裝'],
                    benefits: ['參與證書', '運動毛巾', '學習點數1點'],
                    status: 'registered',
                    image: 'https://via.placeholder.com/300x200?text=校園路跑'
                },
                {
                    id: 'act003',
                    title: '文學講座：現代詩賞析',
                    category: 'cultural',
                    organizer: '中文系',
                    date: '2025-08-05',
                    time: '14:00-16:00',
                    location: '國際會議廳',
                    description: '邀請知名詩人分享現代詩創作心得與作品賞析。',
                    maxParticipants: 200,
                    currentParticipants: 120,
                    registrationDeadline: '2025-08-03',
                    requirements: ['對文學有興趣'],
                    benefits: ['參與證書', '詩集贈書', '學習點數1點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=文學講座'
                },
                {
                    id: 'act004',
                    title: '社團博覽會',
                    category: 'club',
                    organizer: '學務處',
                    date: '2025-09-15',
                    time: '10:00-16:00',
                    location: '學生活動中心',
                    description: '各社團展示活動，提供新生了解社團資訊的機會。',
                    maxParticipants: 500,
                    currentParticipants: 380,
                    registrationDeadline: '2025-09-10',
                    requirements: [],
                    benefits: ['社團資料包', '紀念品'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=社團博覽會'
                },
                {
                    id: 'act005',
                    title: '環保志工活動',
                    category: 'volunteer',
                    organizer: '環保社',
                    date: '2025-08-10',
                    time: '08:00-12:00',
                    location: '校園各區域',
                    description: '校園環境清潔志工活動，為校園環境盡一份心力。',
                    maxParticipants: 30,
                    currentParticipants: 18,
                    registrationDeadline: '2025-08-08',
                    requirements: ['願意付出愛心', '準時參與'],
                    benefits: ['志工時數4小時', '環保小禮品', '學習點數2點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=環保志工'
                },
                {
                    id: 'act006',
                    title: '創業講座',
                    category: 'academic',
                    organizer: '創新育成中心',
                    date: '2025-08-20',
                    time: '13:30-17:30',
                    location: '創新大樓101',
                    description: '邀請成功創業家分享創業經驗與心得。',
                    maxParticipants: 80,
                    currentParticipants: 45,
                    registrationDeadline: '2025-08-18',
                    requirements: ['對創業有興趣'],
                    benefits: ['參與證書', '創業手冊', '學習點數3點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=創業講座'
                },
                {
                    id: 'act007',
                    title: '籃球三對三比賽',
                    category: 'sports',
                    organizer: '籃球社',
                    date: '2025-07-30',
                    time: '15:00-18:00',
                    location: '籃球場',
                    description: '籃球三對三比賽，展現團隊合作精神。',
                    maxParticipants: 24,
                    currentParticipants: 18,
                    registrationDeadline: '2025-07-28',
                    requirements: ['3人一組報名'],
                    benefits: ['獎盃', '運動用品'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=籃球比賽'
                },
                {
                    id: 'act008',
                    title: '音樂會：青春旋律',
                    category: 'cultural',
                    organizer: '音樂社',
                    date: '2025-08-25',
                    time: '19:00-21:00',
                    location: '大禮堂',
                    description: '學生音樂社團聯合演出，展現青春活力。',
                    maxParticipants: 300,
                    currentParticipants: 120,
                    registrationDeadline: '2025-08-23',
                    requirements: [],
                    benefits: ['音樂會程序單', '紀念徽章'],
                    status: 'registered',
                    image: 'https://via.placeholder.com/300x200?text=音樂會'
                },
                {
                    id: 'act009',
                    title: '科學實驗體驗營',
                    category: 'academic',
                    organizer: '化學系',
                    date: '2025-08-30',
                    time: '09:00-16:00',
                    location: '化學實驗室',
                    description: '趣味科學實驗體驗，激發科學興趣。',
                    maxParticipants: 20,
                    currentParticipants: 12,
                    registrationDeadline: '2025-08-28',
                    requirements: ['穿著長袖衣物', '遵守實驗室規則'],
                    benefits: ['實驗報告', '科學小禮品', '學習點數2點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=科學實驗'
                },
                {
                    id: 'act010',
                    title: '國際文化節',
                    category: 'cultural',
                    organizer: '國際事務處',
                    date: '2025-09-05',
                    time: '10:00-17:00',
                    location: '中央廣場',
                    description: '各國文化展示與交流活動，體驗多元文化。',
                    maxParticipants: 400,
                    currentParticipants: 280,
                    registrationDeadline: '2025-09-03',
                    requirements: [],
                    benefits: ['文化護照', '國際美食券', '紀念品'],
                    status: 'registered',
                    image: 'https://via.placeholder.com/300x200?text=國際文化節'
                },
                {
                    id: 'act011',
                    title: '攝影工作坊',
                    category: 'cultural',
                    organizer: '攝影社',
                    date: '2025-07-26',
                    time: '14:00-17:00',
                    location: '藝術大樓201',
                    description: '專業攝影師指導，學習攝影技巧與後製。',
                    maxParticipants: 25,
                    currentParticipants: 8,
                    registrationDeadline: '2025-07-25',
                    requirements: ['自備相機或手機'],
                    benefits: ['攝影作品集', '攝影技巧手冊', '學習點數1點'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=攝影工作坊'
                },
                {
                    id: 'act012',
                    title: '桌遊大賽',
                    category: 'club',
                    organizer: '桌遊社',
                    date: '2025-07-25',
                    time: '18:00-22:00',
                    location: '學生餐廳2樓',
                    description: '多種桌遊競賽，與同學一起享受桌遊樂趣。',
                    maxParticipants: 40,
                    currentParticipants: 15,
                    registrationDeadline: '2025-07-24',
                    requirements: ['具備基本桌遊經驗'],
                    benefits: ['桌遊獎品', '參與證書'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=桌遊大賽'
                },
                {
                    id: 'act013',
                    title: '健身講座',
                    category: 'sports',
                    organizer: '健身社',
                    date: '2025-07-29',
                    time: '16:00-18:00',
                    location: '健身房',
                    description: '專業健身教練分享健身知識與正確運動方法。',
                    maxParticipants: 35,
                    currentParticipants: 22,
                    registrationDeadline: '2025-07-27',
                    requirements: ['穿著運動服裝'],
                    benefits: ['健身指導手冊', '體驗課程券'],
                    status: 'open',
                    image: 'https://via.placeholder.com/300x200?text=健身講座'
                }
            ],
            registeredActivities: ['act002', 'act008', 'act010'],
            activityHistory: [
                {
                    id: 'act_h001',
                    title: '春季運動會',
                    registrationDate: '2024-03-01',
                    activityDate: '2024-03-15',
                    status: 'completed',
                    rating: 5,
                    certificate: true
                },
                {
                    id: 'act_h002',
                    title: '程式設計工作坊',
                    registrationDate: '2024-04-10',
                    activityDate: '2024-04-20',
                    status: 'completed',
                    rating: 4,
                    certificate: true
                },
                {
                    id: 'act_h003',
                    title: '社團迎新活動',
                    registrationDate: '2024-05-01',
                    activityDate: '2024-05-15',
                    status: 'no_show',
                    rating: 0,
                    certificate: false
                },
                {
                    id: 'act_h004',
                    title: '畢業典禮志工',
                    registrationDate: '2024-06-01',
                    activityDate: '2024-06-10',
                    status: 'completed',
                    rating: 5,
                    certificate: true
                }
            ]
        };

        // 初始化活動報名系統
        function initActivitySystem() {
            console.log('初始化活動報名系統');
            
            // 綁定搜尋和過濾事件
            const searchInput = document.getElementById('activity-search');
            const categoryFilter = document.getElementById('activity-category-filter');
            const statusFilter = document.getElementById('activity-status-filter');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterActivities);
            }
            
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterActivities);
            }
            
            if (statusFilter) {
                statusFilter.addEventListener('change', filterActivities);
            }
            
            // 載入各個模組
            loadAllActivities();
            loadMyActivities();
            loadActivityHistory();
            updateActivityStatistics();
        }

        // 載入所有活動
        function loadAllActivities(filteredActivities = null) {
            const container = document.getElementById('activities-grid');
            if (!container) return;
            
            const activities = filteredActivities || activityData.activities;
            
            container.innerHTML = activities.map(activity => {
                const isRegistered = activityData.registeredActivities.includes(activity.id);
                const statusInfo = getActivityStatusInfo(activity, isRegistered);
                const actionButton = getActivityActionButton(activity, isRegistered);
                
                // 為每個活動類別定義顏色和圖標
                const categoryStyles = {
                    'academic': { color: '#007bff', icon: 'bi-mortarboard' },
                    'sports': { color: '#28a745', icon: 'bi-heart-pulse' },
                    'cultural': { color: '#6f42c1', icon: 'bi-book' },
                    'club': { color: '#fd7e14', icon: 'bi-people' },
                    'volunteer': { color: '#20c997', icon: 'bi-tree' },
                    'lecture': { color: '#dc3545', icon: 'bi-lightbulb' },
                    'competition': { color: '#17a2b8', icon: 'bi-trophy' },
                    'entertainment': { color: '#e83e8c', icon: 'bi-music-note' },
                    'workshop': { color: '#6610f2', icon: 'bi-tools' },
                    'default': { color: '#6c757d', icon: 'bi-calendar-event' }
                };
                
                const style = categoryStyles[activity.category] || categoryStyles.default;
                
                return `
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 activity-card">
                            <div class="card-img-container" style="height: 200px; overflow: hidden; background: linear-gradient(135deg, ${style.color}15, ${style.color}35); display: flex; align-items: center; justify-content: center; position: relative;">
                                <div class="text-center">
                                    <i class="bi ${style.icon}" style="font-size: 3rem; color: ${style.color}; margin-bottom: 10px;"></i>
                                    <div style="color: ${style.color}; font-weight: bold; font-size: 1.1rem;">${activity.title}</div>
                                </div>
                                <div class="position-absolute top-0 end-0 m-2">
                                    ${statusInfo.badge}
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title">${activity.title}</h6>
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="bi bi-building me-1"></i>${activity.organizer}<br>
                                        <i class="bi bi-calendar me-1"></i>${activity.date} ${activity.time}<br>
                                        <i class="bi bi-geo-alt me-1"></i>${activity.location}
                                    </small>
                                </div>
                                <p class="card-text flex-grow-1 small">${activity.description}</p>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <small class="text-muted">報名進度</small>
                                        <small class="text-muted">${activity.currentParticipants}/${activity.maxParticipants} 人</small>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar ${(activity.currentParticipants / activity.maxParticipants) >= 0.9 ? 'bg-danger' : 
                                            (activity.currentParticipants / activity.maxParticipants) >= 0.7 ? 'bg-warning' : 'bg-success'}" 
                                             role="progressbar" 
                                             style="width: ${(activity.currentParticipants / activity.maxParticipants * 100)}%">
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    ${actionButton}
                                    <button class="btn btn-outline-info btn-sm" onclick="viewActivityDetails('${activity.id}')">
                                        <i class="bi bi-info-circle me-1"></i>詳情
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 載入我的活動
        function loadMyActivities() {
            const container = document.getElementById('my-activities-list');
            if (!container) return;
            
            const myActivities = activityData.activities.filter(activity => 
                activityData.registeredActivities.includes(activity.id)
            );
            
            if (myActivities.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x display-4 text-muted"></i>
                        <h5 class="mt-3 text-muted">尚未報名任何活動</h5>
                        <p class="text-muted">快去報名感興趣的活動吧！</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = myActivities.map(activity => {
                // 為每個活動類別定義顏色和圖標
                const categoryStyles = {
                    'academic': { color: '#007bff', icon: 'bi-mortarboard' },
                    'sports': { color: '#28a745', icon: 'bi-heart-pulse' },
                    'cultural': { color: '#6f42c1', icon: 'bi-book' },
                    'club': { color: '#fd7e14', icon: 'bi-people' },
                    'volunteer': { color: '#20c997', icon: 'bi-tree' },
                    'lecture': { color: '#dc3545', icon: 'bi-lightbulb' },
                    'competition': { color: '#17a2b8', icon: 'bi-trophy' },
                    'entertainment': { color: '#e83e8c', icon: 'bi-music-note' },
                    'workshop': { color: '#6610f2', icon: 'bi-tools' },
                    'default': { color: '#6c757d', icon: 'bi-calendar-event' }
                };
                
                const style = categoryStyles[activity.category] || categoryStyles.default;
                
                return `
                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <div class="d-flex align-items-center justify-content-center h-100 rounded-start" style="background: linear-gradient(135deg, ${style.color}15, ${style.color}35); min-height: 150px;">
                                <div class="text-center">
                                    <i class="bi ${style.icon}" style="font-size: 2.5rem; color: ${style.color};"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <h6 class="card-title">${activity.title}</h6>
                                    <span class="badge bg-success">已報名</span>
                                </div>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="bi bi-building me-1"></i>${activity.organizer} |
                                        <i class="bi bi-calendar me-1"></i>${activity.date} ${activity.time} |
                                        <i class="bi bi-geo-alt me-1"></i>${activity.location}
                                    </small>
                                </p>
                                <p class="card-text">${activity.description}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <button class="btn btn-outline-danger btn-sm" onclick="cancelRegistration('${activity.id}')">
                                            <i class="bi bi-x-circle me-1"></i>取消報名
                                        </button>
                                        <button class="btn btn-outline-info btn-sm ms-2" onclick="viewActivityDetails('${activity.id}')">
                                            <i class="bi bi-info-circle me-1"></i>查看詳情
                                        </button>
                                    </div>
                                    <small class="text-muted">
                                        報名截止: ${activity.registrationDeadline}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `; 
            }).join('');
        }

        // 載入活動歷史
        function loadActivityHistory() {
            const tbody = document.getElementById('activity-history-list');
            if (!tbody) return;
            
            tbody.innerHTML = activityData.activityHistory.map(record => {
                const statusBadge = getHistoryStatusBadge(record.status);
                const ratingStars = getRatingStars(record.rating);
                const certificateBtn = record.certificate ? 
                    '<button class="btn btn-sm btn-outline-primary">下載證書</button>' : 
                    '<span class="text-muted">無</span>';
                
                return `
                    <tr>
                        <td><strong>${record.title}</strong></td>
                        <td><small>${record.registrationDate}</small></td>
                        <td><small>${record.activityDate}</small></td>
                        <td>${statusBadge}</td>
                        <td>${ratingStars}</td>
                        <td>${certificateBtn}</td>
                    </tr>
                `;
            }).join('');
        }

        // 獲取活動狀態資訊
        function getActivityStatusInfo(activity, isRegistered) {
            if (isRegistered) {
                return {
                    badge: '<span class="badge bg-success">已報名</span>',
                    canRegister: false
                };
            }
            
            const now = new Date();
            const deadline = new Date(activity.registrationDeadline);
            
            // 檢查報名截止時間
            if (now > deadline || activity.status === 'closed') {
                return {
                    badge: '<span class="badge bg-secondary">報名截止</span>',
                    canRegister: false
                };
            }
            
            // 檢查人數是否額滿
            if (activity.currentParticipants >= activity.maxParticipants) {
                return {
                    badge: '<span class="badge bg-danger">額滿</span>',
                    canRegister: false
                };
            }
            
            // 檢查是否接近額滿
            const remainingSlots = activity.maxParticipants - activity.currentParticipants;
            if (remainingSlots <= 3) {
                return {
                    badge: '<span class="badge bg-warning">即將額滿</span>',
                    canRegister: true
                };
            }
            
            return {
                badge: '<span class="badge bg-primary">開放報名</span>',
                canRegister: true
            };
        }

        // 獲取活動操作按鈕
        function getActivityActionButton(activity, isRegistered) {
            const statusInfo = getActivityStatusInfo(activity, isRegistered);
            
            if (isRegistered) {
                return `<button class="btn btn-outline-danger btn-sm" onclick="cancelRegistration('${activity.id}')">
                    <i class="bi bi-x-circle me-1"></i>取消報名
                </button>`;
            }
            
            if (!statusInfo.canRegister) {
                const now = new Date();
                const deadline = new Date(activity.registrationDeadline);
                
                if (activity.currentParticipants >= activity.maxParticipants) {
                    return '<button class="btn btn-secondary btn-sm" disabled><i class="bi bi-person-fill-x me-1"></i>額滿</button>';
                } else if (now > deadline || activity.status === 'closed') {
                    return '<button class="btn btn-secondary btn-sm" disabled><i class="bi bi-clock me-1"></i>已截止</button>';
                } else {
                    return '<button class="btn btn-secondary btn-sm" disabled>無法報名</button>';
                }
            }
            
            // 根據剩餘名額顯示不同的按鈕樣式
            const remainingSlots = activity.maxParticipants - activity.currentParticipants;
            if (remainingSlots <= 3) {
                return `<button class="btn btn-warning btn-sm" onclick="registerActivity('${activity.id}')">
                    <i class="bi bi-exclamation-triangle me-1"></i>搶報名
                </button>`;
            }
            
            return `<button class="btn btn-primary btn-sm" onclick="registerActivity('${activity.id}')">
                <i class="bi bi-plus-circle me-1"></i>立即報名
            </button>`;
        }

        // 報名活動
        function registerActivity(activityId) {
            const activity = activityData.activities.find(a => a.id === activityId);
            if (!activity) {
                showToast('danger', '錯誤', '找不到活動');
                return;
            }
            
            // 檢查是否已報名
            if (activityData.registeredActivities.includes(activityId)) {
                showToast('warning', '警告', '您已經報名此活動');
                return;
            }
            
            // 檢查人數限制
            if (activity.currentParticipants >= activity.maxParticipants) {
                showToast('danger', '報名失敗', '活動人數已滿');
                return;
            }
            
            // 檢查報名截止時間
            const now = new Date();
            const deadline = new Date(activity.registrationDeadline);
            if (now > deadline) {
                showToast('danger', '報名失敗', '報名時間已截止');
                return;
            }
            
            // 確認報名
            showConfirmModal(
                '確認報名',
                `確定要報名 ${activity.title} 嗎？<br><br>
                 <strong>活動資訊：</strong><br>
                 主辦單位：${activity.organizer}<br>
                 活動時間：${activity.date} ${activity.time}<br>
                 活動地點：${activity.location}<br>
                 報名截止：${activity.registrationDeadline}<br><br>
                 <strong>參與要求：</strong><br>
                 ${activity.requirements.length > 0 ? activity.requirements.join('<br>') : '無特殊要求'}<br><br>
                 <strong>活動福利：</strong><br>
                 ${activity.benefits.join('<br>')}`,
                function() {
                    // 執行報名
                    activityData.registeredActivities.push(activityId);
                    activity.currentParticipants += 1;
                    
                    // 更新顯示
                    loadAllActivities();
                    loadMyActivities();
                    updateActivityStatistics();
                    
                    showToast('success', '報名成功', `成功報名 ${activity.title}`);
                }
            );
        }

        // 取消報名
        function cancelRegistration(activityId) {
            const activity = activityData.activities.find(a => a.id === activityId);
            if (!activity) {
                showToast('danger', '錯誤', '找不到活動');
                return;
            }
            
            if (!activityData.registeredActivities.includes(activityId)) {
                showToast('warning', '警告', '您尚未報名此活動');
                return;
            }
            
            // 檢查取消後是否可以重新報名
            const now = new Date();
            const deadline = new Date(activity.registrationDeadline);
            const willBeFull = (activity.currentParticipants - 1) >= activity.maxParticipants;
            const isExpired = now > deadline || activity.status === 'closed';
            
            let reregisterInfo = '';
            if (willBeFull) {
                reregisterInfo = '<br><strong>提醒：</strong>此活動目前已額滿，取消後將無法重新報名。';
            } else if (isExpired) {
                reregisterInfo = '<br><strong>提醒：</strong>報名時間已截止，取消後將無法重新報名。';
            } else {
                reregisterInfo = '<br><strong>好消息：</strong>取消後您可以隨時重新報名此活動。';
            }
            
            showConfirmModal(
                '確認取消報名',
                `確定要取消報名 ${activity.title} 嗎？${reregisterInfo}`,
                function() {
                    // 執行取消報名
                    activityData.registeredActivities = activityData.registeredActivities.filter(id => id !== activityId);
                    activity.currentParticipants -= 1;
                    
                    // 更新顯示
                    loadAllActivities();
                    loadMyActivities();
                    updateActivityStatistics();
                    
                    // 檢查是否可以重新報名並提供快速重新報名選項
                    const updatedStatusInfo = getActivityStatusInfo(activity, false);
                    
                    if (updatedStatusInfo.canRegister) {
                        // 如果可以重新報名，顯示特殊的成功訊息，包含重新報名按鈕
                        showToastWithAction(
                            'success', 
                            '取消成功', 
                            `成功取消報名 ${activity.title}`, 
                            '重新報名',
                            () => registerActivity(activityId)
                        );
                    } else if (activity.currentParticipants >= activity.maxParticipants) {
                        showToast('warning', '取消成功', `成功取消報名 ${activity.title}，由於活動額滿，您將無法重新報名。`);
                    } else {
                        showToast('warning', '取消成功', `成功取消報名 ${activity.title}，由於報名已截止，您將無法重新報名。`);
                    }
                }
            );
        }

        // 查看活動詳情
        function viewActivityDetails(activityId) {
            const activity = activityData.activities.find(a => a.id === activityId);
            if (!activity) return;
            
            const isRegistered = activityData.registeredActivities.includes(activityId);
            const statusInfo = getActivityStatusInfo(activity, isRegistered);
            
            // 為每個活動類別定義顏色和圖標
            const categoryStyles = {
                'academic': { color: '#007bff', icon: 'bi-mortarboard' },
                'sports': { color: '#28a745', icon: 'bi-heart-pulse' },
                'cultural': { color: '#6f42c1', icon: 'bi-book' },
                'club': { color: '#fd7e14', icon: 'bi-people' },
                'volunteer': { color: '#20c997', icon: 'bi-tree' },
                'lecture': { color: '#dc3545', icon: 'bi-lightbulb' },
                'competition': { color: '#17a2b8', icon: 'bi-trophy' },
                'entertainment': { color: '#e83e8c', icon: 'bi-music-note' },
                'workshop': { color: '#6610f2', icon: 'bi-tools' },
                'default': { color: '#6c757d', icon: 'bi-calendar-event' }
            };
            
            const style = categoryStyles[activity.category] || categoryStyles.default;
            
            const modal = document.getElementById('confirmModal');
            const modalTitle = document.getElementById('confirmModalTitle');
            const modalMessage = document.getElementById('confirmModalMessage');
            const confirmBtn = document.getElementById('confirmModalConfirm');
            
            modalTitle.innerHTML = `<i class="bi bi-calendar-event me-2"></i>${activity.title}`;
            modalMessage.innerHTML = `
                <div class="row">
                    <div class="col-md-12">
                        <div class="text-center mb-3 p-4 rounded" style="background: linear-gradient(135deg, ${style.color}15, ${style.color}35);">
                            <i class="bi ${style.icon}" style="font-size: 4rem; color: ${style.color}; margin-bottom: 15px;"></i>
                            <h4 style="color: ${style.color};">${activity.title}</h4>
                        </div>
                        
                        <h6><i class="bi bi-info-circle me-2"></i>活動資訊</h6>
                        <ul class="list-unstyled mb-3">
                            <li><strong>主辦單位：</strong>${activity.organizer}</li>
                            <li><strong>活動時間：</strong>${activity.date} ${activity.time}</li>
                            <li><strong>活動地點：</strong>${activity.location}</li>
                            <li><strong>報名截止：</strong>${activity.registrationDeadline}</li>
                            <li><strong>報名狀況：</strong>${activity.currentParticipants}/${activity.maxParticipants} 人 ${statusInfo.badge}</li>
                        </ul>
                        
                        <h6><i class="bi bi-file-text me-2"></i>活動描述</h6>
                        <p>${activity.description}</p>
                        
                        ${activity.requirements.length > 0 ? `
                        <h6><i class="bi bi-exclamation-triangle me-2"></i>參與要求</h6>
                        <ul>
                            ${activity.requirements.map(req => `<li>${req}</li>`).join('')}
                        </ul>
                        ` : ''}
                        
                        <h6><i class="bi bi-gift me-2"></i>活動福利</h6>
                        <ul>
                            ${activity.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            // 隱藏確認按鈕
            confirmBtn.style.display = 'none';
            
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            
            // 當模態框關閉時恢復確認按鈕
            modal.addEventListener('hidden.bs.modal', function() {
                confirmBtn.style.display = 'block';
            }, { once: true });
        }

        // 獲取歷史狀態徽章
        function getHistoryStatusBadge(status) {
            switch (status) {
                case 'completed':
                    return '<span class="badge bg-success">已參與</span>';
                case 'no_show':
                    return '<span class="badge bg-danger">缺席</span>';
                case 'cancelled':
                    return '<span class="badge bg-secondary">已取消</span>';
                default:
                    return '<span class="badge bg-secondary">未知</span>';
            }
        }

        // 獲取評分星星
        function getRatingStars(rating) {
            if (rating === 0) return '<span class="text-muted">未評分</span>';
            
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="bi bi-star-fill text-warning"></i>';
                } else {
                    stars += '<i class="bi bi-star text-muted"></i>';
                }
            }
            return stars;
        }

        // 更新活動統計
        function updateActivityStatistics() {
            const registeredCount = activityData.registeredActivities.length;
            const availableCount = activityData.activities.filter(a => {
                const statusInfo = getActivityStatusInfo(a, activityData.registeredActivities.includes(a.id));
                return statusInfo.canRegister;
            }).length;
            const monthlyCount = activityData.activities.length;
            
            const registeredElement = document.getElementById('registered-activities-count');
            const availableElement = document.getElementById('available-activities-count');
            const monthlyElement = document.getElementById('monthly-activities-count');
            const myActivitiesCountElement = document.getElementById('my-activities-count');
            
            if (registeredElement) registeredElement.textContent = registeredCount;
            if (availableElement) availableElement.textContent = availableCount;
            if (monthlyElement) monthlyElement.textContent = monthlyCount;
            if (myActivitiesCountElement) myActivitiesCountElement.textContent = registeredCount;
        }

        // 過濾活動
        function filterActivities() {
            const searchTerm = document.getElementById('activity-search')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('activity-category-filter')?.value || '';
            const statusFilter = document.getElementById('activity-status-filter')?.value || '';
            
            let filteredActivities = activityData.activities;
            
            // 按類別過濾
            if (categoryFilter) {
                filteredActivities = filteredActivities.filter(activity => activity.category === categoryFilter);
            }
            
            // 按狀態過濾
            if (statusFilter) {
                filteredActivities = filteredActivities.filter(activity => {
                    const isRegistered = activityData.registeredActivities.includes(activity.id);
                    const statusInfo = getActivityStatusInfo(activity, isRegistered);
                    
                    switch (statusFilter) {
                        case 'open':
                            return statusInfo.canRegister;
                        case 'registered':
                            return isRegistered;
                        case 'closed':
                            return !statusInfo.canRegister && !isRegistered;
                        case 'full':
                            return activity.currentParticipants >= activity.maxParticipants;
                        default:
                            return true;
                    }
                });
            }
            
            // 按搜尋詞過濾
            if (searchTerm) {
                filteredActivities = filteredActivities.filter(activity => 
                    activity.title.toLowerCase().includes(searchTerm) ||
                    activity.organizer.toLowerCase().includes(searchTerm) ||
                    activity.location.toLowerCase().includes(searchTerm) ||
                    activity.description.toLowerCase().includes(searchTerm)
                );
            }
            
            loadAllActivities(filteredActivities);
        }

        // 重置過濾器
        function resetActivityFilters() {
            const searchInput = document.getElementById('activity-search');
            const categoryFilter = document.getElementById('activity-category-filter');
            const statusFilter = document.getElementById('activity-status-filter');
            
            if (searchInput) searchInput.value = '';
            if (categoryFilter) categoryFilter.value = '';
            if (statusFilter) statusFilter.value = '';
            
            loadAllActivities();
        }

        // 選課系統功能 - 使用全域課程資料庫
        let enrollmentData = {
            // 動態從全域課程資料庫獲取課程資料
            get availableCourses() {
                return globalCourseDatabase.courses.map(course => ({
                    id: course.id,
                    code: course.code,
                    name: course.name,
                    teacher: course.instructor,
                    credits: course.credits,
                    time: course.schedule,
                    classroom: course.classroom,
                    enrolled: course.currentStudents,
                    capacity: course.maxStudents,
                    department: course.department,
                    college: course.college,
                    semester: course.semester,
                    year: course.year,
                    type: course.type,
                    description: course.description,
                    prerequisites: course.prerequisites,
                    scheduleCode: course.scheduleCode, // 新增課表代碼
                    status: course.status === '開放選課' ? 'available' : 
                           course.status === '已額滿' ? 'full' : 
                           course.status === '停開' ? 'cancelled' : 'closed'
                }));
            },
            enrolledCourses: [
                // 已選課程的範例資料 - 實際上應該從伺服器獲取
                {
                    id: 'CS101',
                    code: 'CS101',
                    name: '程式設計基礎',
                    teacher: '張志明',
                    credits: 3,
                    time: '週二 10:20-13:10',
                    classroom: 'E101',
                    enrollTime: '2024-07-16 09:30'
                },
                {
                    id: 'MATH101',
                    code: 'MATH101',
                    name: '微積分',
                    teacher: '陳數學',
                    credits: 4,
                    time: '週一 08:10-10:00, 週三 08:10-10:00',
                    classroom: 'A101',
                    enrollTime: '2024-07-16 10:15'
                }
            ],
            enrollmentHistory: [
                {
                    time: '2024-07-16 10:15',
                    action: '加選',
                    courseCode: 'MATH101',
                    courseName: '微積分',
                    teacher: '陳數學',
                    result: '成功'
                },
                {
                    time: '2024-07-16 09:30',
                    action: '加選',
                    courseCode: 'CS101',
                    courseName: '程式設計基礎',
                    teacher: '張志明',
                    result: '成功'
                },
                {
                    time: '2024-07-15 14:20',
                    action: '加選',
                    courseCode: 'PHY101',
                    courseName: '普通物理學',
                    teacher: '牛頓',
                    result: '失敗 - 人數已滿'
                }
            ]
        };

        // 初始化選課系統
        function initEnrollmentSystem() {
            console.log('初始化選課系統');
            
            // 綁定搜尋和過濾事件
            const searchInput = document.getElementById('course-search');
            const semesterFilter = document.getElementById('semester-select');
            const collegeFilter = document.getElementById('college-filter-student');
            const departmentFilter = document.getElementById('department-filter-student');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterCourses);
            }
            
            if (semesterFilter) {
                semesterFilter.addEventListener('change', filterCourses);
            }
            
            if (collegeFilter) {
                collegeFilter.addEventListener('change', function() {
                    updateStudentDepartmentOptions();
                    filterCourses();
                });
            }
            
            if (departmentFilter) {
                departmentFilter.addEventListener('change', filterCourses);
            }
            
            // 初始化系所選項
            updateStudentDepartmentOptions();
            
            // 載入課程列表
            loadAvailableCourses();
            loadEnrolledCourses();
            loadEnrollmentHistory();
            updateStatistics();
        }

        // 載入可選課程
        function loadAvailableCourses(filteredCourses = null) {
            const tbody = document.getElementById('available-courses-list');
            if (!tbody) return;
            
            const semester = document.getElementById('semester-select')?.value || '113-1';
            const courses = filteredCourses || enrollmentData.availableCourses.filter(c => c.semester === semester);
            const enrolledIds = studentEnrollments[currentStudent]?.[semester] || [];
            
            tbody.innerHTML = courses.map(course => {
                const isEnrolled = enrolledIds.includes(course.id);
                const statusBadge = getStatusBadge(course.status, isEnrolled);
                const actionButton = getActionButton(course, isEnrolled);
                const enrollmentRate = (course.enrolled / course.capacity * 100).toFixed(1);
                
                return `
                    <tr class="${isEnrolled ? 'table-success' : ''}">
                        <td><strong>${course.code}</strong></td>
                        <td>
                            <div class="fw-bold">${course.name}</div>
                            <small class="text-muted">${course.college} - ${course.department}</small><br>
                            <small class="text-muted">${course.type} | ${course.semester} | ${course.year}年級</small>
                        </td>
                        <td>${course.teacher}</td>
                        <td><span class="badge bg-secondary">${course.credits}</span></td>
                        <td>
                            <div>${formatScheduleDisplay(course.scheduleCode)}</div>
                            <small class="text-muted"><i class="bi bi-geo-alt me-1"></i>${course.classroom}</small>
                        </td>
                        <td>
                            <div class="progress mb-1" style="height: 20px;">
                                <div class="progress-bar ${enrollmentRate >= 90 ? 'bg-danger' : enrollmentRate >= 70 ? 'bg-warning' : 'bg-success'}" 
                                     style="width: ${enrollmentRate}%">
                                    ${course.enrolled}/${course.capacity}
                                </div>
                            </div>
                            <small class="text-muted">${enrollmentRate}% 滿</small>
                        </td>
                        <td>${statusBadge}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            }).join('');
        }

        // 載入已選課程
        function loadEnrolledCourses() {
            const tbody = document.getElementById('enrolled-courses-list');
            if (!tbody) return;
            
            const semester = document.getElementById('semester-select')?.value || '113-1';
            const enrolledCourseIds = studentEnrollments[currentStudent]?.[semester] || [];
            
            // 獲取完整的課程資訊
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.semester === semester);
            
            if (enrolledCourses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">本學期尚未選課</td></tr>';
                return;
            }
            
            tbody.innerHTML = enrolledCourses.map(course => `
                <tr>
                    <td><strong>${course.code || course.id}</strong></td>
                    <td>
                        <div class="fw-bold">${course.name}</div>
                        <small class="text-muted">${course.college} - ${course.department}</small>
                    </td>
                    <td>${course.instructor}</td>
                    <td><span class="badge bg-secondary">${course.credits}</span></td>
                    <td>
                        <div>${formatScheduleDisplay(course.scheduleCode)}</div>
                        <small class="text-muted"><i class="bi bi-geo-alt me-1"></i>${course.classroom}</small>
                    </td>
                    <td>
                        <span class="badge ${getCategoryBadgeClass(course.type)}">${course.type}</span>
                    </td>
                    <td><small class="text-muted">已選修</small></td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="dropCourseFromEnrollment('${course.id}')">
                            <i class="bi bi-trash me-1"></i>退選
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // 載入選課紀錄
        function loadEnrollmentHistory() {
            const tbody = document.getElementById('enrollment-history-list');
            if (!tbody) return;
            
            // 確保當前學生有歷史記錄
            if (!studentEnrollmentHistory[currentStudent]) {
                studentEnrollmentHistory[currentStudent] = [];
            }
            
            const history = studentEnrollmentHistory[currentStudent];
            
            if (history.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            <i class="bi bi-info-circle me-1"></i>尚無選課紀錄
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = history.map(record => `
                <tr>
                    <td><small>${record.time}</small></td>
                    <td>
                        <span class="badge ${record.action === '加選' ? 'bg-primary' : 'bg-warning'}">
                            ${record.action}
                        </span>
                    </td>
                    <td><strong>${record.courseCode}</strong></td>
                    <td>${record.courseName}</td>
                    <td>${record.teacher}</td>
                    <td>
                        <span class="badge ${record.result.includes('成功') ? 'bg-success' : 'bg-danger'}">
                            ${record.result}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // 獲取狀態標籤
        function getStatusBadge(status, isEnrolled) {
            if (isEnrolled) {
                return '<span class="badge bg-success">已選</span>';
            }
            
            switch (status) {
                case 'available':
                    return '<span class="badge bg-primary">可選</span>';
                case 'full':
                    return '<span class="badge bg-danger">額滿</span>';
                case 'conflict':
                    return '<span class="badge bg-warning">時間衝突</span>';
                default:
                    return '<span class="badge bg-secondary">未知</span>';
            }
        }

        // 獲取操作按鈕
        function getActionButton(course, isEnrolled) {
            if (isEnrolled) {
                return `<button class="btn btn-sm btn-outline-danger" onclick="dropCourseFromEnrollment('${course.id}')">
                    <i class="bi bi-trash me-1"></i>退選
                </button>`;
            }
            
            if (course.status === 'full') {
                return '<button class="btn btn-sm btn-secondary" disabled>額滿</button>';
            }
            
            // 檢查時間衝突
            const semester = document.getElementById('semester-select')?.value || '113-1';
            const conflictCheck = checkTimeConflicts(course.id, semester);
            if (conflictCheck.hasConflict) {
                return '<button class="btn btn-sm btn-warning" disabled><i class="bi bi-exclamation-triangle me-1"></i>已衝堂</button>';
            }
            
            if (course.status === 'conflict') {
                return '<button class="btn btn-sm btn-warning" disabled>時間衝突</button>';
            }
            
            return `<button class="btn btn-sm btn-success" onclick="enrollCourse('${course.id}')">
                <i class="bi bi-plus-circle me-1"></i>加選
            </button>`;
        }

        // 加選課程
        function enrollCourse(courseId) {
            const course = globalCourseDatabase.courses.find(c => c.id === courseId);
            if (!course) {
                showToast('danger', '錯誤', '找不到課程');
                return;
            }

            // 獲取當前學期
            const semester = document.getElementById('semester-select')?.value || '113-1';
            
            // 初始化學生選課記錄
            if (!studentEnrollments[currentStudent]) {
                studentEnrollments[currentStudent] = {};
            }
            if (!studentEnrollments[currentStudent][semester]) {
                studentEnrollments[currentStudent][semester] = [];
            }
            
            // 檢查是否已選
            if (studentEnrollments[currentStudent][semester].includes(courseId)) {
                showToast('warning', '警告', '您已經選修此課程');
                return;
            }
            
            // 檢查人數限制
            if (course.currentStudents >= course.maxStudents) {
                showToast('danger', '加選失敗', '課程人數已滿');
                return;
            }
            
            // 檢查學分限制
            const enrolledCourseIds = studentEnrollments[currentStudent][semester];
            const enrolledCourses = enrolledCourseIds.map(id => 
                globalCourseDatabase.courses.find(c => c.id === id)
            ).filter(c => c);
            const currentCredits = enrolledCourses.reduce((sum, c) => sum + c.credits, 0);
            
            if (currentCredits + course.credits > 25) {
                showToast('danger', '加選失敗', '超過學分上限（25學分）');
                return;
            }
            
            // 檢查時間衝突
            const conflictCheck = checkTimeConflicts(courseId, semester);
            if (conflictCheck.hasConflict) {
                Swal.fire({
                    title: '時間衝突警告',
                    html: `
                        <div class="text-start">
                            <p>此課程與以下已選課程時間衝突：</p>
                            <ul class="list-unstyled">
                                ${conflictCheck.conflicts.map(conflict => 
                                    `<li class="text-danger">• ${conflict.name} (${conflict.time})</li>`
                                ).join('')}
                            </ul>
                            <p class="text-muted">是否仍要選修此課程？</p>
                        </div>
                    `,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '仍要選修',
                    cancelButtonText: '取消選課',
                    confirmButtonColor: '#d33'
                }).then((result) => {
                    if (result.isConfirmed) {
                        performEnrollment(courseId, course, semester);
                    }
                });
                return;
            }
            
            // 無衝突，確認加選
            showConfirmModal(
                '確認加選',
                `確定要加選 ${course.code} - ${course.name} 嗎？<br><br>
                 <strong>課程資訊：</strong><br>
                 教師：${course.instructor}<br>
                 學分：${course.credits}<br>
                 時間：${formatScheduleDisplay(course.scheduleCode)}<br>
                 教室：${course.classroom}`,
                function() {
                    performEnrollment(courseId, course, semester);
                }
            );
        }

        // 執行選課
        function performEnrollment(courseId, course, semester) {
            // 添加到學生選課記錄
            studentEnrollments[currentStudent][semester].push(courseId);
            
            // 更新課程人數
            course.currentStudents++;
            
            // 如果人數達到上限，更新狀態
            if (course.currentStudents >= course.maxStudents) {
                course.status = '已額滿';
            }
            
            // 添加到選課歷史記錄
            addToHistory('加選', course, '選課成功');
            
            // 重新載入可選課程列表
            loadAvailableCourses();
            
            // 重新載入已選課程列表
            loadEnrolledCourses();
            
            // 更新統計資訊
            updateStatistics();
            
            // 顯示成功訊息
            showToast('success', '加選成功', `已成功選修 ${course.name}`);
            
            // 如果當前在課程表頁面，重新載入課程表
            if (document.getElementById('schedule-body')) {
                loadStudentSchedule();
            }
        }

        // 檢查時間衝突
        function checkTimeConflicts(newCourseId, semester) {
            const newCourse = globalCourseDatabase.courses.find(c => c.id === newCourseId);
            if (!newCourse || !newCourse.scheduleCode || newCourse.scheduleCode === '時間另議') {
                return { hasConflict: false, conflicts: [] };
            }

            const enrolledCourseIds = studentEnrollments[currentStudent]?.[semester] || [];
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.scheduleCode && course.scheduleCode !== '時間另議');

            const newTimeSlots = parseScheduleCode(newCourse.scheduleCode);
            const conflicts = [];

            enrolledCourses.forEach(enrolledCourse => {
                const enrolledTimeSlots = parseScheduleCode(enrolledCourse.scheduleCode);
                
                // 檢查時間重疊
                const hasOverlap = newTimeSlots.some(newSlot => 
                    enrolledTimeSlots.some(enrolledSlot => 
                        newSlot.day === enrolledSlot.day && newSlot.period === enrolledSlot.period
                    )
                );

                if (hasOverlap) {
                    conflicts.push({
                        name: enrolledCourse.name,
                        time: formatScheduleDisplay(enrolledCourse.scheduleCode)
                    });
                }
            });

            return {
                hasConflict: conflicts.length > 0,
                conflicts: conflicts
            };
        }
        
        // 退選課程 (選課系統版本)
        function dropCourseFromEnrollment(courseId) {
            const course = globalCourseDatabase.courses.find(c => c.id === courseId);
            if (!course) {
                showToast('danger', '錯誤', '找不到課程');
                return;
            }

            const semester = document.getElementById('semester-select')?.value || '113-1';
            
            // 檢查是否已選
            if (!studentEnrollments[currentStudent]?.[semester]?.includes(courseId)) {
                showToast('warning', '警告', '您未選修此課程');
                return;
            }
            
            showConfirmModal(
                '確認退選',
                `確定要退選 ${course.code} - ${course.name} 嗎？<br><br>
                 <strong>注意：</strong>退選後需重新加選，且可能因人數額滿而無法再次選到此課程。`,
                function() {
                    // 從學生選課記錄中移除
                    const index = studentEnrollments[currentStudent][semester].indexOf(courseId);
                    if (index > -1) {
                        studentEnrollments[currentStudent][semester].splice(index, 1);
                    }
                    
                    // 更新課程人數
                    if (course.currentStudents > 0) {
                        course.currentStudents--;
                    }
                    
                    // 如果人數低於上限，更新狀態為開放選課
                    if (course.currentStudents < course.maxStudents && course.status === '已額滿') {
                        course.status = '開放選課';
                    }
                    
                    // 添加到選課歷史記錄
                    addToHistory('退選', course, '退選成功');
                    
                    // 重新載入可選課程列表
                    loadAvailableCourses();
                    
                    // 重新載入已選課程列表
                    loadEnrolledCourses();
                    
                    // 更新統計資訊
                    updateStatistics();
                    
                    // 顯示成功訊息
                    showToast('success', '退選成功', `成功退選 ${course.name}`);
                    
                    // 如果當前在課程表頁面，重新載入課程表
                    if (document.getElementById('schedule-body')) {
                        loadStudentSchedule();
                    }
                }
            );
        }

        // 檢查時間衝突
        function checkTimeConflict(newTime) {
            return enrollmentData.enrolledCourses.find(course => {
                // 簡化的時間衝突檢查（實際應該更精確）
                return course.time === newTime;
            });
        }

        // 添加到歷史記錄
        function addToHistory(action, course, result) {
            // 確保當前學生有歷史記錄數組
            if (!studentEnrollmentHistory[currentStudent]) {
                studentEnrollmentHistory[currentStudent] = [];
            }
            
            const record = {
                time: new Date().toLocaleString('zh-TW'),
                action: action,
                courseCode: course.code,
                courseName: course.name,
                teacher: course.teacher,
                semester: course.semester,
                result: result
            };
            
            studentEnrollmentHistory[currentStudent].unshift(record);
            
            // 保持最多20條記錄
            if (studentEnrollmentHistory[currentStudent].length > 20) {
                studentEnrollmentHistory[currentStudent] = studentEnrollmentHistory[currentStudent].slice(0, 20);
            }
            
            // 立即更新選課紀錄顯示
            loadEnrollmentHistory();
        }

        // 更新統計資訊
        function updateStatistics() {
            const semester = document.getElementById('semester-select')?.value || '113-1';
            const enrolledCourseIds = studentEnrollments[currentStudent]?.[semester] || [];
            
            // 獲取完整的課程資訊來計算學分
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.semester === semester);
            
            const totalCredits = enrolledCourses.reduce((sum, c) => sum + c.credits, 0);
            const totalCourses = enrolledCourses.length;
            
            const creditsElement = document.getElementById('total-credits');
            const coursesElement = document.getElementById('total-courses');
            const enrolledCountElement = document.getElementById('enrolled-count');
            
            if (creditsElement) creditsElement.textContent = totalCredits;
            if (coursesElement) coursesElement.textContent = totalCourses;
            if (enrolledCountElement) enrolledCountElement.textContent = totalCourses;
        }

        // 更新學生端系所選項
        function updateStudentDepartmentOptions() {
            const collegeFilter = document.getElementById('college-filter-student');
            const departmentFilter = document.getElementById('department-filter-student');
            
            if (!collegeFilter || !departmentFilter) return;

            const selectedCollege = collegeFilter.value;
            let departments = [];

            if (selectedCollege && staffCourseData.collegesDepartments[selectedCollege]) {
                departments = staffCourseData.collegesDepartments[selectedCollege];
            } else {
                // 顯示所有系所
                departments = Object.values(staffCourseData.collegesDepartments).flat();
            }

            departmentFilter.innerHTML = '<option value="">所有系所</option>' +
                departments.map(dept => `<option value="${dept}">${dept}</option>`).join('');
        }

        // === 學生課程表管理功能 ===
        
        // 解析課程時間編碼
        function parseScheduleCode(scheduleCode) {
            if (!scheduleCode || scheduleCode === '時間另議') {
                return [];
            }
            
            const timeSlots = [];
            // 格式: '2-3,4,5' = 週二第3,4,5節
            // 或: '1-1,2;3-5,6' = 週一第1,2節 + 週三第5,6節
            
            const daySlots = scheduleCode.split(';');
            daySlots.forEach(daySlot => {
                const [day, periods] = daySlot.split('-');
                if (day && periods) {
                    const dayNum = parseInt(day);
                    const periodList = periods.split(',');
                    periodList.forEach(period => {
                        const periodNum = parseInt(period.trim());
                        if (!isNaN(dayNum) && !isNaN(periodNum)) {
                            timeSlots.push({
                                day: dayNum,
                                period: periodNum
                            });
                        }
                    });
                }
            });
            
            return timeSlots;
        }
        
        function loadStudentSchedule() {
            const semester = document.getElementById('schedule-semester')?.value || '113-1';
            
            // 獲取當前學期已選課程
            const enrolledCourses = studentEnrollments[currentStudent]?.[semester] || [];
            
            // 生成課表
            generateScheduleTable(enrolledCourses, semester);
            
            // 載入課程詳細資訊
            loadEnrolledCoursesDetail(enrolledCourses);
            
            // 更新統計資訊
            updateScheduleStatistics(enrolledCourses);
        }

        function generateScheduleTable(enrolledCourseIds, semester) {
            const scheduleBody = document.getElementById('schedule-body');
            if (!scheduleBody) return;
            
            // 初始化課表陣列（15節課 x 7天）
            const schedule = Array(15).fill(null).map(() => Array(7).fill(null));
            
            // 獲取已選課程的完整資訊
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.semester === semester);
            
            // 填入課程到課表中
            enrolledCourses.forEach(course => {
                if (course.scheduleCode && course.scheduleCode !== '時間另議') {
                    const timeSlots = parseScheduleCode(course.scheduleCode);
                    timeSlots.forEach(slot => {
                        if (slot.day >= 1 && slot.day <= 7 && slot.period >= 1 && slot.period <= 15) {
                            schedule[slot.period - 1][slot.day - 1] = {
                                course: course,
                                color: getCourseColor(course.type)
                            };
                        }
                    });
                }
            });
            
            // 生成課表HTML
            let html = '';
            for (let period = 1; period <= 15; period++) {
                const timeRange = globalCourseDatabase.timePeriods[period] || { start: '--:--', end: '--:--' };
                html += `<tr>
                    <td class="fw-bold text-center">${period}</td>
                    <td class="text-muted text-center small">${timeRange}</td>`;
                
                for (let day = 0; day < 7; day++) {
                    const cell = schedule[period - 1][day];
                    if (cell && cell.course) {
                        const course = cell.course;
                        html += `
                            <td class="schedule-cell ${cell.color}" style="cursor: pointer;" 
                                onclick="showCourseDetails('${course.id}')" 
                                title="${course.name} - ${course.instructor} - ${course.classroom}">
                                <div class="small fw-bold">${course.name}</div>
                                <div class="tiny text-muted">${course.classroom}</div>
                            </td>`;
                    } else {
                        html += '<td class="schedule-cell-empty"></td>';
                    }
                }
                html += '</tr>';
            }
            
            scheduleBody.innerHTML = html;
        }

        function loadEnrolledCoursesDetail(enrolledCourseIds) {
            const tbody = document.getElementById('enrolled-courses-detail');
            if (!tbody) return;
            
            const semester = document.getElementById('schedule-semester')?.value || '113-1';
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.semester === semester);
            
            let html = '';
            enrolledCourses.forEach(course => {
                const scheduleText = course.scheduleCode === '時間另議' ? 
                    '<span class="text-warning">時間另議</span>' : 
                    formatScheduleDisplay(course.scheduleCode);
                
                html += `
                    <tr>
                        <td><code>${course.id}</code></td>
                        <td>
                            <span class="fw-bold">${course.name}</span>
                            <br><small class="text-muted">${course.college} - ${course.department}</small>
                        </td>
                        <td>${course.instructor}</td>
                        <td><span class="badge bg-primary">${course.credits}</span></td>
                        <td class="small">${scheduleText}</td>
                        <td>${course.classroom}</td>
                        <td><span class="badge ${getCategoryBadgeClass(course.type)}">${course.type}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="dropCourse('${course.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            if (html === '') {
                html = '<tr><td colspan="8" class="text-center text-muted">本學期尚未選課</td></tr>';
            }
            
            tbody.innerHTML = html;
        }

        function updateScheduleStatistics(enrolledCourseIds) {
            const semester = document.getElementById('schedule-semester')?.value || '113-1';
            const enrolledCourses = enrolledCourseIds
                .map(courseId => globalCourseDatabase.courses.find(c => c.id === courseId))
                .filter(course => course && course.semester === semester);
            
            // 計算統計數據
            const totalCredits = enrolledCourses.reduce((sum, course) => sum + course.credits, 0);
            const totalCourses = enrolledCourses.length;
            let totalHours = 0;
            let occupiedPeriods = 0;
            
            enrolledCourses.forEach(course => {
                if (course.scheduleCode && course.scheduleCode !== '時間另議') {
                    const timeSlots = parseScheduleCode(course.scheduleCode);
                    totalHours += timeSlots.length;
                    occupiedPeriods += timeSlots.length;
                }
            });
            
            const freePeriods = (15 * 5) - occupiedPeriods; // 15節課 x 5個工作日
            
            // 更新顯示
            document.getElementById('total-schedule-credits').textContent = totalCredits;
            document.getElementById('total-schedule-courses').textContent = totalCourses;
            document.getElementById('total-schedule-hours').textContent = totalHours;
            document.getElementById('free-periods').textContent = freePeriods;
        }

        function getCourseColor(category) {
            const colors = {
                '必修': 'table-danger',
                '選修': 'table-info',
                '通識': 'table-warning',
                '體育': 'table-success',
                '實習': 'table-secondary'
            };
            return colors[category] || 'table-light';
        }
        
        function getCategoryBadgeClass(category) {
            const classes = {
                '必修': 'bg-danger',
                '選修': 'bg-info',
                '通識': 'bg-warning',
                '體育': 'bg-success',
                '實習': 'bg-secondary'
            };
            return classes[category] || 'bg-light';
        }

        function formatScheduleDisplay(scheduleCode) {
            if (!scheduleCode || scheduleCode === '時間另議') {
                return '時間另議';
            }
            
            const timeSlots = parseScheduleCode(scheduleCode);
            if (timeSlots.length === 0) return '時間另議';
            
            // 按天分組
            const dayGroups = {};
            timeSlots.forEach(slot => {
                const dayName = globalCourseDatabase.weekDays[slot.day] || `週${slot.day}`;
                if (!dayGroups[dayName]) {
                    dayGroups[dayName] = [];
                }
                dayGroups[dayName].push(slot.period);
            });
            
            // 格式化顯示
            const parts = [];
            Object.keys(dayGroups).forEach(day => {
                const periods = dayGroups[day].sort((a, b) => a - b);
                parts.push(`${day}第${periods.join(',')}節`);
            });
            
            return parts.join('<br>');
        }

        function showCourseDetails(courseId) {
            const course = globalCourseDatabase.courses.find(c => c.id === courseId);
            if (!course) return;
            
            const scheduleText = formatScheduleDisplay(course.scheduleCode);
            
            Swal.fire({
                title: course.name,
                html: `
                    <div class="text-start">
                        <p><strong>課程代碼：</strong>${course.id}</p>
                        <p><strong>開課單位：</strong>${course.college} - ${course.department}</p>
                        <p><strong>授課教師：</strong>${course.instructor}</p>
                        <p><strong>學分數：</strong>${course.credits}學分</p>
                        <p><strong>課程類別：</strong><span class="badge ${getCategoryBadgeClass(course.type)}">${course.type}</span></p>
                        <p><strong>上課時間：</strong>${scheduleText}</p>
                        <p><strong>上課地點：</strong>${course.classroom}</p>
                        <p><strong>修課人數：</strong>${course.currentStudents}/${course.maxStudents}人</p>
                        <p><strong>課程描述：</strong>${course.description || '無課程描述'}</p>
                    </div>
                `,
                width: '600px',
                confirmButtonText: '關閉'
            });
        }

        function dropCourse(courseId) {
            Swal.fire({
                title: '確定要退選這門課程嗎？',
                text: '退選後將從課程表中移除',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '確定退選',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    const semester = document.getElementById('schedule-semester')?.value || '113-1';
                    
                    // 從學生選課記錄中移除
                    if (studentEnrollments[currentStudent] && studentEnrollments[currentStudent][semester]) {
                        const index = studentEnrollments[currentStudent][semester].indexOf(courseId);
                        if (index > -1) {
                            studentEnrollments[currentStudent][semester].splice(index, 1);
                        }
                    }
                    
                    // 更新課程人數
                    const course = globalCourseDatabase.courses.find(c => c.id === courseId);
                    if (course && course.currentStudents > 0) {
                        course.currentStudents--;
                    }
                    
                    // 添加到選課歷史記錄
                    if (course) {
                        addToHistory('退選', course, '退選成功');
                    }
                    
                    // 重新載入課程表
                    loadStudentSchedule();
                    
                    Swal.fire('退選成功！', '課程已從您的課程表中移除', 'success');
                }
            });
        }

        function exportSchedule() {
            const semester = document.getElementById('schedule-semester')?.value || '113-1';
            
            Swal.fire({
                title: '匯出課程表',
                html: `
                    <div class="text-start">
                        <p>選擇匯出格式：</p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="exportToImage()">
                                <i class="bi bi-image me-2"></i>匯出為圖片
                            </button>
                            <button class="btn btn-outline-success" onclick="exportToExcel()">
                                <i class="bi bi-file-earmark-excel me-2"></i>匯出為Excel
                            </button>
                            <button class="btn btn-outline-info" onclick="exportToPrint()">
                                <i class="bi bi-printer me-2"></i>列印課程表
                            </button>
                        </div>
                    </div>
                `,
                showConfirmButton: false,
                showCancelButton: true,
                cancelButtonText: '取消'
            });
        }

        function exportToPrint() {
            const semester = document.getElementById('schedule-semester')?.value || '113-1';
            const scheduleTable = document.getElementById('schedule-table').outerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${currentStudent} - ${semester}課程表</title>
                    <style>
                        body { font-family: 'Microsoft JhengHei', sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                        .table-dark { background-color: #343a40; color: white; }
                        .schedule-cell { background-color: #e3f2fd; }
                        .table-danger { background-color: #f8d7da; }
                        .table-info { background-color: #d1ecf1; }
                        .table-warning { background-color: #fff3cd; }
                        .table-success { background-color: #d4edda; }
                        .table-secondary { background-color: #e2e3e5; }
                        h1 { text-align: center; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>${currentStudent} - ${semester}課程表</h1>
                    ${scheduleTable}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            
            Swal.close();
        }

        // 過濾課程
        function filterCourses() {
            const searchTerm = document.getElementById('course-search')?.value.toLowerCase() || '';
            const semesterFilter = document.getElementById('semester-select')?.value || '';
            const collegeFilter = document.getElementById('college-filter-student')?.value || '';
            const departmentFilter = document.getElementById('department-filter-student')?.value || '';
            
            let filteredCourses = enrollmentData.availableCourses;
            
            // 按學期過濾
            if (semesterFilter) {
                filteredCourses = filteredCourses.filter(course => course.semester === semesterFilter);
            }
            
            // 按學院過濾
            if (collegeFilter) {
                filteredCourses = filteredCourses.filter(course => course.college === collegeFilter);
            }
            
            // 按系所過濾
            if (departmentFilter) {
                filteredCourses = filteredCourses.filter(course => course.department === departmentFilter);
            }
            
            // 按搜尋詞過濾
            if (searchTerm) {
                filteredCourses = filteredCourses.filter(course => 
                    course.name.toLowerCase().includes(searchTerm) ||
                    course.teacher.toLowerCase().includes(searchTerm) ||
                    course.code.toLowerCase().includes(searchTerm)
                );
            }
            
            loadAvailableCourses(filteredCourses);
        }

        // 圖書館系統相關函數
        function initLibrarySystem() {
            // 初始化示例借閱記錄（如果沒有的話）
            initSampleBorrowedBooks();
            initSampleReservedBooks();
            
            loadBorrowedBooks();
            loadReservedBooks();
            loadBorrowHistory();
            loadWishlist();
            loadDefaultBookSearch();
            updateLibraryStats();
        }

        // 初始化示例借閱記錄
        function initSampleBorrowedBooks() {
            const existingBorrowedBooks = JSON.parse(localStorage.getItem('borrowedBooks') || '[]');
            
            if (existingBorrowedBooks.length === 0) {
                const sampleBorrowedBooks = [
                    {
                        id: Date.now() - 3000,
                        bookId: 1,
                        title: "演算法圖鑑：26種演算法 + 7種資料結構，人工智慧、數據分析、邏輯思考的原理和應用全圖解",
                        author: "石田保輝、宮崎修一",
                        borrowDate: "2025-07-08",
                        dueDate: "2025-07-22",
                        status: "borrowed",
                        renewCount: 0
                    },
                    {
                        id: Date.now() - 2000,
                        bookId: 4,
                        title: "Clean Code 無瑕的程式碼：敏捷軟體開發技巧守則",
                        author: "Robert C. Martin",
                        borrowDate: "2025-07-10",
                        dueDate: "2025-07-24",
                        status: "borrowed",
                        renewCount: 1
                    },
                    {
                        id: Date.now() - 1000,
                        bookId: 6,
                        title: "計算機網路：自頂向下方法",
                        author: "James F. Kurose、Keith W. Ross",
                        borrowDate: "2025-07-05",
                        dueDate: "2025-07-19",
                        status: "borrowed",
                        renewCount: 0
                    }
                ];
                
                localStorage.setItem('borrowedBooks', JSON.stringify(sampleBorrowedBooks));
                
                // 更新對應書籍的可借數量
                sampleBorrowedBooks.forEach(borrowRecord => {
                    const book = libraryBooks.find(b => b.id === borrowRecord.bookId);
                    if (book && book.available > 0) {
                        book.available--;
                        if (book.available === 0) {
                            book.status = '全部外借';
                        }
                    }
                });
            }
        }

        // 初始化示例預約記錄
        function initSampleReservedBooks() {
            const existingReservedBooks = JSON.parse(localStorage.getItem('reservedBooks') || '[]');
            
            if (existingReservedBooks.length === 0) {
                const sampleReservedBooks = [
                    {
                        id: Date.now() - 1500,
                        bookId: 2,
                        title: "Deep Learning 深度學習必讀：Keras 大神帶你用 Python 實作",
                        author: "François Chollet",
                        reserveDate: "2025-07-20",
                        estimatedDate: "2025-07-27",
                        status: "waiting"
                    },
                    {
                        id: Date.now() - 500,
                        bookId: 5,
                        title: "資料庫系統理論與實務：使用 Access 2016",
                        author: "陳會安",
                        reserveDate: "2025-07-21",
                        estimatedDate: "2025-07-28",
                        status: "ready"
                    }
                ];
                
                localStorage.setItem('reservedBooks', JSON.stringify(sampleReservedBooks));
            }
        }

        // 圖書搜尋 - 真實書籍資料
        const libraryBooks = [
            {
                id: 1,
                title: "演算法圖鑑：26種演算法 + 7種資料結構，人工智慧、數據分析、邏輯思考的原理和應用全圖解",
                author: "石田保輝、宮崎修一",
                isbn: "978-986-289-340-7",
                subject: "資訊科學",
                publisher: "臉譜出版",
                publishYear: "2017",
                pages: 224,
                description: "用圖解的方式說明演算法和資料結構的運作原理，適合初學者理解複雜的概念。",
                keywords: ["演算法", "資料結構", "圖解", "程式設計"],
                available: 3,
                total: 5,
                status: "可借",
                location: "3F-資訊區-A01",
                rating: 4.5,
                borrowCount: 127
            },
            {
                id: 2,
                title: "Deep Learning 深度學習必讀：Keras 大神帶你用 Python 實作",
                author: "François Chollet",
                isbn: "978-957-21-4779-2",
                subject: "人工智慧",
                publisher: "碁峰資訊",
                publishYear: "2018",
                pages: 416,
                description: "Keras 創始人親自撰寫，深度學習的權威指南，從基礎概念到實際應用。",
                keywords: ["深度學習", "Keras", "Python", "神經網路", "機器學習"],
                available: 0,
                total: 3,
                status: "全部外借",
                location: "3F-資訊區-A02",
                rating: 4.8,
                borrowCount: 98
            },
            {
                id: 3,
                title: "Python 機器學習：預測分析核心算法",
                author: "Sebastian Raschka",
                isbn: "978-986-347-458-1",
                subject: "機器學習",
                publisher: "博碩文化",
                publishYear: "2016",
                pages: 464,
                description: "機器學習實戰指南，涵蓋監督學習、無監督學習和強化學習的核心算法。",
                keywords: ["機器學習", "Python", "預測分析", "算法"],
                available: 2,
                total: 4,
                status: "可借",
                location: "3F-資訊區-A03",
                rating: 4.3,
                borrowCount: 156
            },
            {
                id: 4,
                title: "Clean Code 無瑕的程式碼：敏捷軟體開發技巧守則",
                author: "Robert C. Martin",
                isbn: "978-986-347-712-4",
                subject: "軟體工程",
                publisher: "博碩文化",
                publishYear: "2017",
                pages: 464,
                description: "軟體開發經典之作，教導如何寫出乾淨、可維護的程式碼。",
                keywords: ["軟體工程", "程式碼品質", "敏捷開發", "重構"],
                available: 4,
                total: 6,
                status: "可借",
                location: "3F-資訊區-B01",
                rating: 4.7,
                borrowCount: 203
            },
            {
                id: 5,
                title: "資料庫系統理論與實務：使用 Access 2016",
                author: "陳會安",
                isbn: "978-986-434-265-7",
                subject: "資料庫",
                publisher: "旗標出版",
                publishYear: "2017",
                pages: 688,
                description: "完整介紹資料庫系統的理論基礎與實際應用，包含正規化、SQL 語法等。",
                keywords: ["資料庫", "SQL", "Access", "正規化"],
                available: 0,
                total: 3,
                status: "全部外借",
                location: "3F-資訊區-B02",
                rating: 4.2,
                borrowCount: 89
            },
            {
                id: 6,
                title: "計算機網路：自頂向下方法",
                author: "James F. Kurose、Keith W. Ross",
                isbn: "978-7-111-45718-9",
                subject: "網路",
                publisher: "機械工業出版社",
                publishYear: "2014",
                pages: 632,
                description: "網路領域的經典教科書，採用自頂向下的方法講解網路協定和原理。",
                keywords: ["計算機網路", "TCP/IP", "網路協定", "網路安全"],
                available: 2,
                total: 4,
                status: "可借",
                location: "3F-資訊區-C01",
                rating: 4.6,
                borrowCount: 134
            },
            {
                id: 7,
                title: "現代作業系統",
                author: "Andrew S. Tanenbaum、Herbert Bos",
                isbn: "978-7-111-54418-7",
                subject: "作業系統",
                publisher: "機械工業出版社",
                publishYear: "2017",
                pages: 1056,
                description: "作業系統領域的權威教材，全面介紹作業系統的設計原理和實現技術。",
                keywords: ["作業系統", "程序管理", "記憶體管理", "檔案系統"],
                available: 1,
                total: 3,
                status: "可借",
                location: "3F-資訊區-C02",
                rating: 4.4,
                borrowCount: 78
            },
            {
                id: 8,
                title: "人工智慧：現代方法",
                author: "Stuart Russell、Peter Norvig",
                isbn: "978-7-302-51749-8",
                subject: "人工智慧",
                publisher: "清華大學出版社",
                publishYear: "2019",
                pages: 1152,
                description: "人工智慧領域的權威教科書，涵蓋搜索、推理、學習等核心主題。",
                keywords: ["人工智慧", "搜索算法", "推理", "專家系統"],
                available: 3,
                total: 5,
                status: "可借",
                location: "3F-資訊區-D01",
                rating: 4.9,
                borrowCount: 167
            },
            {
                id: 9,
                title: "JavaScript 高級程序設計",
                author: "Nicholas C. Zakas",
                isbn: "978-7-115-27579-0",
                subject: "程式設計",
                publisher: "人民郵電出版社",
                publishYear: "2012",
                pages: 800,
                description: "JavaScript 開發的經典指南，深入介紹 JavaScript 語言特性和最佳實踐。",
                keywords: ["JavaScript", "前端開發", "Web開發", "程式設計"],
                available: 0,
                total: 4,
                status: "維修中",
                location: "3F-資訊區-D02",
                rating: 4.5,
                borrowCount: 245
            },
            {
                id: 10,
                title: "網路安全：理論與實務",
                author: "William Stallings",
                isbn: "978-986-374-586-2",
                subject: "資訊安全",
                publisher: "全華圖書",
                publishYear: "2018",
                pages: 896,
                description: "全面介紹網路安全的理論基礎和實際應用，包含密碼學、防火牆等主題。",
                keywords: ["網路安全", "密碼學", "防火牆", "入侵檢測"],
                available: 2,
                total: 4,
                status: "可借",
                location: "3F-資訊區-E01",
                rating: 4.3,
                borrowCount: 112
            },
            {
                id: 11,
                title: "設計模式：可復用物件導向軟體的基礎",
                author: "Erich Gamma、Richard Helm、Ralph Johnson、John Vlissides",
                isbn: "978-7-111-21116-6",
                subject: "軟體工程",
                publisher: "機械工業出版社",
                publishYear: "2007",
                pages: 254,
                description: "軟體設計經典之作，介紹23種設計模式，提升程式碼的可維護性和可擴展性。",
                keywords: ["設計模式", "物件導向", "軟體架構", "程式設計"],
                available: 3,
                total: 5,
                status: "可借",
                location: "3F-資訊區-B03",
                rating: 4.8,
                borrowCount: 189
            },
            {
                id: 12,
                title: "統計學習方法",
                author: "李航",
                isbn: "978-7-302-27595-4",
                subject: "機器學習",
                publisher: "清華大學出版社",
                publishYear: "2012",
                pages: 240,
                description: "機器學習領域的中文經典教材，理論嚴謹，適合深入學習統計學習理論。",
                keywords: ["統計學習", "機器學習", "監督學習", "無監督學習"],
                available: 1,
                total: 3,
                status: "可借",
                location: "3F-資訊區-A04",
                rating: 4.6,
                borrowCount: 145
            },
            {
                id: 13,
                title: "Node.js 實戰",
                author: "Mike Cantelon、Marc Harter、T.J. Holowaychuk、Nathan Rajlich",
                isbn: "978-7-115-36357-1",
                subject: "程式設計",
                publisher: "人民郵電出版社",
                publishYear: "2014",
                pages: 408,
                description: "Node.js 開發的實戰指南，從基礎概念到實際項目開發。",
                keywords: ["Node.js", "JavaScript", "後端開發", "伺服器"],
                available: 2,
                total: 3,
                status: "可借",
                location: "3F-資訊區-D03",
                rating: 4.4,
                borrowCount: 87
            },
            {
                id: 14,
                title: "資料科學入門",
                author: "Joel Grus",
                isbn: "978-986-476-054-2",
                subject: "資料科學",
                publisher: "歐萊禮",
                publishYear: "2016",
                pages: 400,
                description: "資料科學的入門指南，涵蓋統計、機器學習、資料視覺化等主題。",
                keywords: ["資料科學", "Python", "統計分析", "資料視覺化"],
                available: 4,
                total: 6,
                status: "可借",
                location: "3F-資訊區-F01",
                rating: 4.2,
                borrowCount: 234
            },
            {
                id: 15,
                title: "區塊鏈技術與應用",
                author: "袁勇、王飛躍",
                isbn: "978-7-302-48170-8",
                subject: "區塊鏈",
                publisher: "清華大學出版社",
                publishYear: "2017",
                pages: 312,
                description: "全面介紹區塊鏈技術的原理、實現和應用場景。",
                keywords: ["區塊鏈", "比特幣", "智能合約", "分散式系統"],
                available: 0,
                total: 2,
                status: "全部外借",
                location: "3F-資訊區-F02",
                rating: 4.1,
                borrowCount: 76
            }
        ];

        async function searchBooks() {
            const searchInput = document.getElementById('book-search-input');
            const searchTerm = searchInput ? searchInput.value.trim() : '';
            
            try {
                // 使用後端 API 搜尋書籍
                const url = searchTerm 
                    ? `/api/library/books/search?q=${encodeURIComponent(searchTerm)}`
                    : '/api/library/books';
                    
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    displaySearchResults(data.data, searchTerm);
                } else {
                    console.error('搜尋書籍失敗:', data.message);
                    showToast('搜尋書籍失敗', 'error');
                }
            } catch (error) {
                console.error('搜尋書籍錯誤:', error);
                showToast('搜尋過程中發生錯誤', 'error');
            }
        }

        function loadDefaultBookSearch() {
            displaySearchResults(libraryBooks.slice(0, 8), ''); // 顯示前8本書作為預設
        }

        function displaySearchResults(books, searchTerm) {
            const container = document.getElementById('search-results-container');
            
            if (books.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-search display-4 text-muted"></i>
                        <h5 class="mt-3 text-muted">找不到符合「${searchTerm}」的館藏</h5>
                        <p class="text-muted">請嘗試其他關鍵字或使用進階搜尋</p>
                    </div>
                `;
                return;
            }

            let html = '';
            if (searchTerm) {
                html += `<div class="mb-3">
                    <small class="text-muted">搜尋「${searchTerm}」找到 ${books.length} 筆結果</small>
                </div>`;
            }

            html += `<div class="row g-3">`;
            
            books.forEach(book => {
                // 適配後端數據格式
                const statusClass = book.availableCopies > 0 ? 'success' : 'danger';
                const statusText = book.status || (book.availableCopies > 0 ? '可借閱' : '全部外借');
                const stars = '★'.repeat(Math.floor(book.rating || 4)) + '☆'.repeat(5 - Math.floor(book.rating || 4));
                const actionButton = book.availableCopies > 0 
                    ? `<button class="btn btn-primary btn-sm" onclick="borrowBook('${book._id}')">
                         <i class="bi bi-plus-circle me-1"></i>借閱
                       </button>`
                    : `<button class="btn btn-outline-info btn-sm" onclick="reserveBook('${book._id}')">
                         <i class="bi bi-bookmark me-1"></i>預約
                       </button>`;

                html += `
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 book-card" style="transition: transform 0.2s;">
                            <div class="card-body">
                                <h6 class="card-title text-primary" title="${book.title}">${book.title.length > 30 ? book.title.substring(0, 30) + '...' : book.title}</h6>
                                <p class="card-text">
                                    <small class="text-muted d-block">作者：${book.author}</small>
                                    <small class="text-muted d-block">出版社：${book.publisher}</small>
                                    <small class="text-muted d-block">出版年：${book.publishYear || 'N/A'}</small>
                                    <small class="text-muted d-block">位置：${book.location}</small>
                                </p>
                                <div class="mb-2">
                                    <span class="badge bg-info me-1">${book.category}</span>
                                    <span class="text-warning" title="${book.rating || 4}/5 星">${stars}</span>
                                    <small class="text-muted">(${book.rating || 4.0})</small>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="badge bg-${statusClass}">${statusText}</span>
                                    <small class="text-muted">${book.availableCopies}/${book.totalCopies} 可借</small>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-book me-1"></i>ISBN: ${book.isbn}
                                    </small>
                                    <div class="btn-group btn-group-sm">
                                        ${actionButton}
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showBookDetails('${book._id}')" title="詳細資訊">
                                            <i class="bi bi-info-circle"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            container.innerHTML = html;

            // 添加 hover 效果
            document.querySelectorAll('.book-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '';
                });
            });
        }

        async function borrowBook(bookId) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showToast('請先登入', 'warning');
                    return;
                }

                // 從後端獲取書籍資訊
                const bookResponse = await fetch(`/api/library/books`);
                const bookData = await bookResponse.json();
                
                if (!bookData.success) {
                    showToast('獲取書籍資訊失敗', 'error');
                    return;
                }

                const book = bookData.data.find(b => b._id === bookId);
                if (!book || book.availableCopies === 0) {
                    showToast('此書籍目前無法借閱', 'warning');
                    return;
                }

                showConfirmModal('確認借閱', `確定要借閱「${book.title}」嗎？`, async () => {
                    try {
                        // 呼叫後端 API 進行借閱
                        const response = await fetch('/api/library/borrow', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userId: currentUser.username,
                                bookId: bookId
                            })
                        });

                        const result = await response.json();
                        
                        if (result.success) {
                            showToast(`成功借閱「${book.title}」`, 'success');
                            // 重新整理圖書館顯示
                            searchBooks();
                            loadBorrowedBooks();
                            loadWishlist();
                            updateLibraryStats();
                        } else {
                            showToast(result.message || '借閱失敗', 'error');
                        }
                    } catch (error) {
                        console.error('借閱錯誤:', error);
                        showToast('借閱過程中發生錯誤', 'error');
                    }
                });
            } catch (error) {
                console.error('借書函數錯誤:', error);
                showToast('系統錯誤', 'error');
            }
        }

        function reserveBook(bookId) {
            const book = libraryBooks.find(b => b.id === bookId);
            if (!book) {
                showToast('找不到指定書籍', 'error');
                return;
            }

            showConfirmModal('確認預約', `確定要預約「${book.title}」嗎？`, () => {
                const reservedBooks = getReservedBooks();
                const newReservation = {
                    id: Date.now(),
                    bookId: book.id,
                    title: book.title,
                    author: book.author,
                    reserveDate: new Date().toISOString().split('T')[0],
                    estimatedDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'waiting'
                };
                reservedBooks.push(newReservation);
                localStorage.setItem('reservedBooks', JSON.stringify(reservedBooks));

                loadReservedBooks();
                loadWishlist();
                updateLibraryStats();
                showToast(`成功預約「${book.title}」`, 'success');
            });
        }

        function getBorrowedBooks() {
            return JSON.parse(localStorage.getItem('borrowedBooks') || '[]');
        }

        function getReservedBooks() {
            return JSON.parse(localStorage.getItem('reservedBooks') || '[]');
        }

        async function loadBorrowedBooks() {
            const tbody = document.getElementById('borrowed-books-list');
            
            if (!tbody) {
                console.log('找不到 borrowed-books-list 元素');
                return;
            }

            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="bi bi-person display-6"></i><br>
                                請先登入以查看借閱記錄
                            </td>
                        </tr>
                    `;
                    return;
                }

                // 從後端獲取使用者借閱記錄
                const response = await fetch(`/api/library/user/${currentUser.username}/borrowed`);
                const data = await response.json();
                
                if (!data.success) {
                    console.error('獲取借閱記錄失敗:', data.message);
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="bi bi-exclamation-triangle display-6"></i><br>
                                載入借閱記錄失敗
                            </td>
                        </tr>
                    `;
                    return;
                }

                const borrowedBooks = data.data;
                
                if (borrowedBooks.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="bi bi-book display-6"></i><br>
                                目前沒有借閱中的書籍
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = borrowedBooks.map(record => {
                    const book = record.book;
                    if (!book) return ''; // 跳過沒有書籍資訊的記錄
                    
                    const isOverdue = new Date(record.dueDate) < new Date();
                    const isNearDue = new Date(record.dueDate) - new Date() < 3 * 24 * 60 * 60 * 1000 && !isOverdue;
                    
                    let statusBadge = '<span class="badge bg-success">正常</span>';
                    if (isOverdue) {
                        statusBadge = '<span class="badge bg-danger">逾期</span>';
                    } else if (isNearDue) {
                        statusBadge = '<span class="badge bg-warning">即將到期</span>';
                    }

                    const canRenew = record.renewCount < 2 && !isOverdue;

                    return `
                        <tr>
                            <td>
                                <strong>${book.title}</strong><br>
                                <small class="text-muted">作者：${book.author}</small>
                            </td>
                            <td>${book.author}</td>
                            <td>${new Date(record.borrowDate).toLocaleDateString('zh-TW')}</td>
                            <td>${new Date(record.dueDate).toLocaleDateString('zh-TW')}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    ${canRenew ? 
                                        `<button class="btn btn-outline-primary" onclick="renewBook('${record.bookId}')" title="續借">
                                            <i class="bi bi-arrow-clockwise me-1"></i>續借
                                        </button>` : ''}
                                    <button class="btn btn-outline-success" onclick="returnBook('${record.bookId}')" title="歸還">
                                        <i class="bi bi-check-circle me-1"></i>歸還
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('載入借閱記錄錯誤:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-exclamation-triangle display-6"></i><br>
                            載入借閱記錄時發生錯誤
                        </td>
                    </tr>
                `;
            }
        }

        function loadReservedBooks() {
            const reservedBooks = getReservedBooks();
            const tbody = document.getElementById('reserved-books-list');
            
            if (!tbody) {
                console.log('找不到 reserved-books-list 元素');
                return;
            }
            
            if (reservedBooks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-bookmark display-6"></i><br>
                            目前沒有預約中的書籍
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = reservedBooks.map(book => {
                const statusBadge = book.status === 'ready' 
                    ? '<span class="badge bg-success">可取書</span>' 
                    : '<span class="badge bg-info">等待中</span>';

                return `
                    <tr>
                        <td>
                            <strong>${book.title}</strong><br>
                            <small class="text-muted">作者：${book.author}</small>
                        </td>
                        <td>${book.author}</td>
                        <td>${book.reserveDate}</td>
                        <td>${book.estimatedDate}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                ${book.status === 'ready' ? 
                                    `<button class="btn btn-outline-success" onclick="pickupReservedBook(${book.id})" title="取書">
                                        <i class="bi bi-check-circle me-1"></i>取書
                                    </button>` : ''}
                                <button class="btn btn-outline-danger" onclick="cancelReservation(${book.id})" title="取消預約">
                                    <i class="bi bi-x-circle me-1"></i>取消
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadBorrowHistory() {
            const history = JSON.parse(localStorage.getItem('borrowHistory') || '[]');
            const tbody = document.getElementById('borrow-history-list');
            
            // 添加一些示例歷史記錄（如果沒有的話）
            if (history.length === 0) {
                const sampleHistory = [
                    {
                        title: "Python程式設計",
                        borrowDate: "2025-06-15",
                        returnDate: "2025-06-29",
                        renewCount: 1,
                        status: "正常歸還",
                        rating: 5
                    },
                    {
                        title: "統計學概論",
                        borrowDate: "2025-06-01",
                        returnDate: "2025-06-18",
                        renewCount: 0,
                        status: "逾期歸還",
                        rating: 4
                    },
                    {
                        title: "計算機概論",
                        borrowDate: "2025-05-20",
                        returnDate: "2025-06-03",
                        renewCount: 2,
                        status: "正常歸還",
                        rating: 5
                    }
                ];
                localStorage.setItem('borrowHistory', JSON.stringify(sampleHistory));
                tbody.innerHTML = renderHistoryTable(sampleHistory);
            } else {
                tbody.innerHTML = renderHistoryTable(history);
            }
        }

        function renderHistoryTable(history) {
            if (history.length === 0) {
                return `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-clock-history display-6"></i><br>
                            沒有借閱歷史記錄
                        </td>
                    </tr>
                `;
            }

            return history.map(record => {
                const statusBadge = record.status === '正常歸還' 
                    ? '<span class="badge bg-success">正常歸還</span>'
                    : '<span class="badge bg-warning">逾期歸還</span>';

                const stars = '★'.repeat(record.rating) + '☆'.repeat(5 - record.rating);

                return `
                    <tr>
                        <td>${record.title}</td>
                        <td>${record.borrowDate}</td>
                        <td>${record.returnDate}</td>
                        <td>
                            <span class="badge bg-secondary">${record.renewCount} 次</span>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <span class="text-warning" title="${record.rating}/5 星">${stars}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function renewBook(bookId) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showToast('請先登入', 'warning');
                    return;
                }

                // 從後端獲取書籍資訊
                const bookResponse = await fetch(`/api/library/books`);
                const bookData = await bookResponse.json();
                
                if (!bookData.success) {
                    showToast('獲取書籍資訊失敗', 'error');
                    return;
                }

                const book = bookData.data.find(b => b._id === bookId);
                if (!book) {
                    showToast('找不到指定的書籍', 'error');
                    return;
                }

                showConfirmModal('確認續借', `確定要續借「${book.title}」嗎？`, async () => {
                    try {
                        // 呼叫後端 API 進行續借
                        const response = await fetch('/api/library/renew', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userId: currentUser.username,
                                bookId: bookId
                            })
                        });

                        const result = await response.json();
                        
                        if (result.success) {
                            const newDueDate = new Date(result.data.dueDate).toLocaleDateString('zh-TW');
                            showToast(`成功續借「${book.title}」，新到期日：${newDueDate}`, 'success');
                            // 重新載入借閱記錄
                            loadBorrowedBooks();
                        } else {
                            showToast(result.message || '續借失敗', 'error');
                        }
                    } catch (error) {
                        console.error('續借錯誤:', error);
                        showToast('續借過程中發生錯誤', 'error');
                    }
                });
            } catch (error) {
                console.error('續借函數錯誤:', error);
                showToast('系統錯誤', 'error');
            }
        }

        async function returnBook(bookId) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showToast('請先登入', 'warning');
                    return;
                }

                // 從後端獲取書籍資訊
                const bookResponse = await fetch(`/api/library/books`);
                const bookData = await bookResponse.json();
                
                if (!bookData.success) {
                    showToast('獲取書籍資訊失敗', 'error');
                    return;
                }

                const book = bookData.data.find(b => b._id === bookId);
                if (!book) {
                    showToast('找不到指定的書籍', 'error');
                    return;
                }
                
                showConfirmModal('確認歸還', `確定要歸還「${book.title}」嗎？`, async () => {
                    try {
                        // 呼叫後端 API 進行還書
                        const response = await fetch('/api/library/return', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userId: currentUser.username,
                                bookId: bookId
                            })
                        });

                        const result = await response.json();
                        
                        if (result.success) {
                            showToast(`成功歸還「${book.title}」`, 'success');
                            // 重新整理顯示
                            loadBorrowedBooks();
                            searchBooks();
                            updateLibraryStats();
                        } else {
                            showToast(result.message || '歸還失敗', 'error');
                        }
                    } catch (error) {
                        console.error('還書錯誤:', error);
                        showToast('歸還過程中發生錯誤', 'error');
                    }
                });
            } catch (error) {
                console.error('還書函數錯誤:', error);
                showToast('系統錯誤', 'error');
            }
        }

        function cancelReservation(reservationId) {
            const reservedBooks = getReservedBooks();
            const bookIndex = reservedBooks.findIndex(b => b.id === reservationId);
            
            if (bookIndex === -1) {
                showToast('找不到指定的預約記錄', 'error');
                return;
            }

            const book = reservedBooks[bookIndex];
            
            showConfirmModal('確認取消', `確定要取消預約「${book.title}」嗎？`, () => {
                reservedBooks.splice(bookIndex, 1);
                localStorage.setItem('reservedBooks', JSON.stringify(reservedBooks));
                
                loadReservedBooks();
                updateLibraryStats();
                showToast(`已取消預約「${book.title}」`, 'success');
            });
        }

        function pickupReservedBook(reservationId) {
            const reservedBooks = getReservedBooks();
            const bookIndex = reservedBooks.findIndex(b => b.id === reservationId);
            
            if (bookIndex === -1) {
                showToast('找不到指定的預約記錄', 'error');
                return;
            }

            const reservation = reservedBooks[bookIndex];
            const book = libraryBooks.find(b => b.id === reservation.bookId);
            
            if (!book) {
                showToast('找不到對應的書籍', 'error');
                return;
            }

            showConfirmModal('確認取書', `確定要取書「${reservation.title}」嗎？取書後將自動進入借閱狀態。`, () => {
                // 移除預約記錄
                reservedBooks.splice(bookIndex, 1);
                localStorage.setItem('reservedBooks', JSON.stringify(reservedBooks));

                // 添加到借閱記錄
                const borrowedBooks = getBorrowedBooks();
                const newBorrow = {
                    id: Date.now(),
                    bookId: book.id,
                    title: book.title,
                    author: book.author,
                    borrowDate: new Date().toISOString().split('T')[0],
                    dueDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'borrowed',
                    renewCount: 0
                };
                borrowedBooks.push(newBorrow);
                localStorage.setItem('borrowedBooks', JSON.stringify(borrowedBooks));

                // 更新書籍狀態
                if (book.available > 0) {
                    book.available--;
                    if (book.available === 0) {
                        book.status = '全部外借';
                    }
                }

                // 更新顯示
                loadBorrowedBooks();
                loadReservedBooks();
                updateLibraryStats();
                showToast(`成功取書「${reservation.title}」，已自動加入借閱清單`, 'success');
            });
        }

        function loadWishlist() {
            const wishlist = JSON.parse(localStorage.getItem('bookWishlist') || '[]');
            const tbody = document.getElementById('wishlist-books-list');
            
            if (wishlist.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="bi bi-heart display-6"></i><br>
                            收藏清單是空的<br>
                            <small>在書籍詳情頁面點擊「加入收藏」來添加喜歡的書籍</small>
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = wishlist.map(item => {
                    const book = libraryBooks.find(b => b.id === item.bookId);
                    if (!book) return '';
                    
                    const statusClass = book.available > 0 ? 'success' : (book.status === '維修中' ? 'warning' : 'danger');
                    
                    return `
                        <tr>
                            <td>
                                <strong>${book.title}</strong><br>
                                <small class="text-muted">${book.publisher} (${book.publishYear})</small>
                            </td>
                            <td>${book.author}</td>
                            <td>${item.addedDate}</td>
                            <td>
                                <span class="badge bg-${statusClass}">${book.status}</span>
                                <small class="text-muted d-block">${book.available}/${book.total} 可借</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    ${book.available > 0 ? 
                                        `<button class="btn btn-outline-primary" onclick="borrowBook(${book.id})" title="借閱">
                                            <i class="bi bi-plus-circle"></i>
                                        </button>` :
                                        book.status === '全部外借' ?
                                        `<button class="btn btn-outline-info" onclick="reserveBook(${book.id})" title="預約">
                                            <i class="bi bi-bookmark"></i>
                                        </button>` : ''
                                    }
                                    <button class="btn btn-outline-secondary" onclick="showBookDetails(${book.id})" title="詳情">
                                        <i class="bi bi-info-circle"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="removeFromWishlist(${item.bookId})" title="移除收藏">
                                        <i class="bi bi-heart-fill"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // 更新收藏數量徽章
            document.getElementById('wishlist-count').textContent = wishlist.length;
        }

        function removeFromWishlist(bookId) {
            const book = libraryBooks.find(b => b.id === bookId);
            if (!book) return;
            
            showConfirmModal('確認移除', `確定要將「${book.title}」從收藏清單中移除嗎？`, () => {
                let wishlist = JSON.parse(localStorage.getItem('bookWishlist') || '[]');
                wishlist = wishlist.filter(item => item.bookId !== bookId);
                localStorage.setItem('bookWishlist', JSON.stringify(wishlist));
                
                loadWishlist();
                showToast(`已將「${book.title}」從收藏清單移除`, 'success');
            });
        }

        function clearWishlist() {
            const wishlist = JSON.parse(localStorage.getItem('bookWishlist') || '[]');
            if (wishlist.length === 0) {
                showToast('收藏清單已經是空的', 'info');
                return;
            }
            
            showConfirmModal('確認清空', '確定要清空整個收藏清單嗎？此操作無法復原。', () => {
                localStorage.setItem('bookWishlist', '[]');
                loadWishlist();
                showToast('收藏清單已清空', 'success');
            });
        }

        function updateLibraryStats() {
            const borrowedBooks = getBorrowedBooks();
            const reservedBooks = getReservedBooks();
            const wishlist = JSON.parse(localStorage.getItem('bookWishlist') || '[]');
            const overdueBooks = borrowedBooks.filter(book => new Date(book.dueDate) < new Date());

            // 安全地更新統計數字
            const currentBorrowedElement = document.getElementById('current-borrowed-count');
            const reservedCountElement = document.getElementById('reserved-count');
            const overdueCountElement = document.getElementById('overdue-count');
            const myBooksCountElement = document.getElementById('my-books-count');
            const reservationsCountElement = document.getElementById('reservations-count');
            const wishlistCountElement = document.getElementById('wishlist-count');

            if (currentBorrowedElement) currentBorrowedElement.textContent = borrowedBooks.length;
            if (reservedCountElement) reservedCountElement.textContent = reservedBooks.length;
            if (overdueCountElement) overdueCountElement.textContent = overdueBooks.length;
            if (myBooksCountElement) myBooksCountElement.textContent = borrowedBooks.length;
            if (reservationsCountElement) reservationsCountElement.textContent = reservedBooks.length;
            if (wishlistCountElement) wishlistCountElement.textContent = wishlist.length;
        }

        function showAdvancedSearch() {
            const advancedSearchModal = `
                <div class="modal fade" id="advancedSearchModal" tabindex="-1" aria-labelledby="advancedSearchLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="advancedSearchLabel">
                                    <i class="bi bi-funnel me-2"></i>進階搜尋
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="advancedSearchForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="adv-title" class="form-label">書名</label>
                                            <input type="text" class="form-control" id="adv-title" placeholder="輸入書名關鍵字">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="adv-author" class="form-label">作者</label>
                                            <input type="text" class="form-control" id="adv-author" placeholder="輸入作者姓名">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="adv-subject" class="form-label">主題分類</label>
                                            <select class="form-select" id="adv-subject">
                                                <option value="">全部主題</option>
                                                <option value="資訊科學">資訊科學</option>
                                                <option value="人工智慧">人工智慧</option>
                                                <option value="機器學習">機器學習</option>
                                                <option value="軟體工程">軟體工程</option>
                                                <option value="資料庫">資料庫</option>
                                                <option value="網路">網路</option>
                                                <option value="作業系統">作業系統</option>
                                                <option value="程式設計">程式設計</option>
                                                <option value="資訊安全">資訊安全</option>
                                                <option value="資料科學">資料科學</option>
                                                <option value="區塊鏈">區塊鏈</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="adv-publisher" class="form-label">出版社</label>
                                            <input type="text" class="form-control" id="adv-publisher" placeholder="輸入出版社名稱">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="adv-year-start" class="form-label">出版年份（起）</label>
                                            <input type="number" class="form-control" id="adv-year-start" min="1900" max="2025" placeholder="例：2010">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="adv-year-end" class="form-label">出版年份（迄）</label>
                                            <input type="number" class="form-control" id="adv-year-end" min="1900" max="2025" placeholder="例：2025">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="adv-status" class="form-label">館藏狀態</label>
                                            <select class="form-select" id="adv-status">
                                                <option value="">全部狀態</option>
                                                <option value="可借">可借</option>
                                                <option value="全部外借">全部外借</option>
                                                <option value="維修中">維修中</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="adv-rating" class="form-label">評分篩選</label>
                                            <select class="form-select" id="adv-rating">
                                                <option value="">不限評分</option>
                                                <option value="4.5">4.5星以上</option>
                                                <option value="4.0">4.0星以上</option>
                                                <option value="3.5">3.5星以上</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="adv-keywords" class="form-label">關鍵字</label>
                                        <input type="text" class="form-control" id="adv-keywords" placeholder="多個關鍵字用空格分隔">
                                        <div class="form-text">例：演算法 資料結構 圖解</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">排序方式</label>
                                            <select class="form-select" id="adv-sort">
                                                <option value="relevance">相關性</option>
                                                <option value="title">書名 A-Z</option>
                                                <option value="author">作者 A-Z</option>
                                                <option value="year">出版年份（新到舊）</option>
                                                <option value="rating">評分（高到低）</option>
                                                <option value="popularity">借閱次數（高到低）</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">每頁顯示</label>
                                            <select class="form-select" id="adv-limit">
                                                <option value="10">10 本</option>
                                                <option value="20">20 本</option>
                                                <option value="50">50 本</option>
                                                <option value="all">全部</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-outline-warning" onclick="clearAdvancedSearch()">清除條件</button>
                                <button type="button" class="btn btn-primary" onclick="executeAdvancedSearch()">
                                    <i class="bi bi-search me-1"></i>搜尋
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 移除現有modal（如果有的話）
            const existingModal = document.getElementById('advancedSearchModal');
            if (existingModal) {
                existingModal.remove();
            }

            // 添加新modal
            document.body.insertAdjacentHTML('beforeend', advancedSearchModal);
            const modal = new bootstrap.Modal(document.getElementById('advancedSearchModal'));
            modal.show();

            // 當modal關閉時移除DOM元素
            document.getElementById('advancedSearchModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        function clearAdvancedSearch() {
            document.getElementById('advancedSearchForm').reset();
        }

        function executeAdvancedSearch() {
            const form = document.getElementById('advancedSearchForm');
            const formData = new FormData(form);
            
            const searchCriteria = {
                title: document.getElementById('adv-title').value.toLowerCase().trim(),
                author: document.getElementById('adv-author').value.toLowerCase().trim(),
                subject: document.getElementById('adv-subject').value,
                publisher: document.getElementById('adv-publisher').value.toLowerCase().trim(),
                yearStart: document.getElementById('adv-year-start').value,
                yearEnd: document.getElementById('adv-year-end').value,
                status: document.getElementById('adv-status').value,
                rating: document.getElementById('adv-rating').value,
                keywords: document.getElementById('adv-keywords').value.toLowerCase().trim(),
                sort: document.getElementById('adv-sort').value,
                limit: document.getElementById('adv-limit').value
            };

            let filteredBooks = libraryBooks.filter(book => {
                // 書名篩選
                if (searchCriteria.title && !book.title.toLowerCase().includes(searchCriteria.title)) {
                    return false;
                }
                
                // 作者篩選
                if (searchCriteria.author && !book.author.toLowerCase().includes(searchCriteria.author)) {
                    return false;
                }
                
                // 主題篩選
                if (searchCriteria.subject && book.subject !== searchCriteria.subject) {
                    return false;
                }
                
                // 出版社篩選
                if (searchCriteria.publisher && !book.publisher.toLowerCase().includes(searchCriteria.publisher)) {
                    return false;
                }
                
                // 出版年份篩選
                if (searchCriteria.yearStart && parseInt(book.publishYear) < parseInt(searchCriteria.yearStart)) {
                    return false;
                }
                if (searchCriteria.yearEnd && parseInt(book.publishYear) > parseInt(searchCriteria.yearEnd)) {
                    return false;
                }
                
                // 狀態篩選
                if (searchCriteria.status && book.status !== searchCriteria.status) {
                    return false;
                }
                
                // 評分篩選
                if (searchCriteria.rating && book.rating < parseFloat(searchCriteria.rating)) {
                    return false;
                }
                
                // 關鍵字篩選
                if (searchCriteria.keywords) {
                    const keywords = searchCriteria.keywords.split(' ').filter(k => k.length > 0);
                    const bookText = `${book.title} ${book.author} ${book.description} ${book.keywords.join(' ')}`.toLowerCase();
                    if (!keywords.every(keyword => bookText.includes(keyword))) {
                        return false;
                    }
                }
                
                return true;
            });

            // 排序
            switch (searchCriteria.sort) {
                case 'title':
                    filteredBooks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'author':
                    filteredBooks.sort((a, b) => a.author.localeCompare(b.author));
                    break;
                case 'year':
                    filteredBooks.sort((a, b) => parseInt(b.publishYear) - parseInt(a.publishYear));
                    break;
                case 'rating':
                    filteredBooks.sort((a, b) => b.rating - a.rating);
                    break;
                case 'popularity':
                    filteredBooks.sort((a, b) => b.borrowCount - a.borrowCount);
                    break;
                default: // relevance
                    // 保持原順序
                    break;
            }

            // 限制數量
            if (searchCriteria.limit !== 'all') {
                filteredBooks = filteredBooks.slice(0, parseInt(searchCriteria.limit));
            }

            // 關閉modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('advancedSearchModal'));
            modal.hide();

            // 顯示結果
            displaySearchResults(filteredBooks, '進階搜尋');
            
            // 切換到搜尋結果標籤
            const searchTab = document.querySelector('[data-bs-target="#search-results"]');
            if (searchTab) {
                const tab = new bootstrap.Tab(searchTab);
                tab.show();
            }
        }

        function showBookDetails(bookId) {
            const book = libraryBooks.find(b => b.id === bookId);
            if (!book) return;

            const stars = '★'.repeat(Math.floor(book.rating)) + '☆'.repeat(5 - Math.floor(book.rating));
            const statusClass = book.available > 0 ? 'success' : (book.status === '維修中' ? 'warning' : 'danger');

            const modalContent = `
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h4 class="text-primary mb-3">${book.title}</h4>
                            
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>作者：</strong></div>
                                <div class="col-sm-9">${book.author}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>ISBN：</strong></div>
                                <div class="col-sm-9">${book.isbn}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>出版社：</strong></div>
                                <div class="col-sm-9">${book.publisher}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>出版年份：</strong></div>
                                <div class="col-sm-9">${book.publishYear} 年</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>頁數：</strong></div>
                                <div class="col-sm-9">${book.pages} 頁</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>主題分類：</strong></div>
                                <div class="col-sm-9">
                                    <span class="badge bg-info">${book.subject}</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-3"><strong>館藏地：</strong></div>
                                <div class="col-sm-9">${book.location}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-sm-3"><strong>館藏狀態：</strong></div>
                                <div class="col-sm-9">
                                    <span class="badge bg-${statusClass}">${book.status}</span>
                                    <span class="ms-2">(${book.available}/${book.total} 可借)</span>
                                </div>
                            </div>

                            <h6><i class="bi bi-file-text me-2"></i>內容簡介</h6>
                            <p class="text-muted mb-3">${book.description}</p>

                            <h6><i class="bi bi-tags me-2"></i>關鍵字</h6>
                            <div class="mb-3">
                                ${book.keywords.map(keyword => `<span class="badge bg-secondary me-1">${keyword}</span>`).join('')}
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">館藏統計</h6>
                                    
                                    <div class="mb-3">
                                        <div class="display-6 text-primary">${book.rating}</div>
                                        <div class="text-warning">${stars}</div>
                                        <small class="text-muted">讀者評分</small>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <div class="h5 text-success">${book.borrowCount}</div>
                                            <small class="text-muted">借閱次數</small>
                                        </div>
                                        <div class="col-6">
                                            <div class="h5 text-info">${book.total}</div>
                                            <small class="text-muted">總館藏量</small>
                                        </div>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="d-grid gap-2">
                                        ${book.available > 0 ? 
                                            `<button class="btn btn-primary" onclick="borrowBookFromDetail(${book.id})">
                                                <i class="bi bi-plus-circle me-1"></i>立即借閱
                                            </button>` :
                                            book.status === '全部外借' ?
                                            `<button class="btn btn-outline-info" onclick="reserveBookFromDetail(${book.id})">
                                                <i class="bi bi-bookmark me-1"></i>預約此書
                                            </button>` :
                                            `<button class="btn btn-secondary" disabled>
                                                <i class="bi bi-tools me-1"></i>維修中
                                            </button>`
                                        }
                                        <button class="btn btn-outline-secondary" onclick="addToWishlist(${book.id})">
                                            <i class="bi bi-heart me-1"></i>加入收藏
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="shareBook(${book.id})">
                                            <i class="bi bi-share me-1"></i>分享此書
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            showCustomModal('書籍詳細資訊', modalContent);
        }

        function borrowBookFromDetail(bookId) {
            // 關閉詳情modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('customModal'));
            if (modal) modal.hide();
            
            // 執行借閱
            borrowBook(bookId);
        }

        function reserveBookFromDetail(bookId) {
            // 關閉詳情modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('customModal'));
            if (modal) modal.hide();
            
            // 執行預約
            reserveBook(bookId);
        }

        function addToWishlist(bookId) {
            const book = libraryBooks.find(b => b.id === bookId);
            if (!book) return;
            
            // 模擬添加到收藏清單
            let wishlist = JSON.parse(localStorage.getItem('bookWishlist') || '[]');
            if (!wishlist.some(item => item.bookId === bookId)) {
                wishlist.push({
                    bookId: book.id,
                    title: book.title,
                    author: book.author,
                    addedDate: new Date().toISOString().split('T')[0]
                });
                localStorage.setItem('bookWishlist', JSON.stringify(wishlist));
                loadWishlist();
                updateLibraryStats();
                showToast(`「${book.title}」已加入收藏清單`, 'success');
            } else {
                showToast(`「${book.title}」已在收藏清單中`, 'info');
            }
        }

        function shareBook(bookId) {
            const book = libraryBooks.find(b => b.id === bookId);
            if (!book) return;
            
            const shareText = `推薦好書：${book.title}\n作者：${book.author}\n${book.description}`;
            
            if (navigator.share) {
                navigator.share({
                    title: book.title,
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // 複製到剪貼板
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('書籍資訊已複製到剪貼板', 'success');
                }).catch(() => {
                    showToast('分享功能暫時無法使用', 'error');
                });
            }
        }

        function filterHistory() {
            showToast('歷史記錄篩選功能已套用', 'success');
        }

        function showSeatingReservation() {
            showToast('座位預約系統開發中', 'info');
        }

        function showStudyRoomBooking() {
            showToast('討論室預約系統開發中', 'info');
        }

        function showDocumentDelivery() {
            showToast('文獻傳遞服務開發中', 'info');
        }

        function showLibraryNews() {
            const newsContent = `
                <div class="modal-body">
                    <div class="list-group">
                        <div class="list-group-item">
                            <h6 class="mb-1">📚 新書上架通知</h6>
                            <p class="mb-1">本週新增100本熱門書籍，歡迎借閱！</p>
                            <small class="text-muted">2025-07-15</small>
                        </div>
                        <div class="list-group-item">
                            <h6 class="mb-1">⏰ 暑假開放時間調整</h6>
                            <p class="mb-1">暑假期間週末開放時間調整為 09:00-16:00</p>
                            <small class="text-muted">2025-07-10</small>
                        </div>
                        <div class="list-group-item">
                            <h6 class="mb-1">💻 線上資料庫試用</h6>
                            <p class="mb-1">IEEE Xplore 資料庫開放試用至8月底</p>
                            <small class="text-muted">2025-07-05</small>
                        </div>
                    </div>
                </div>
            `;
            
            showCustomModal('圖書館最新消息', newsContent);
        }

        function showCustomModal(title, content) {
            const modalHtml = `
                <div class="modal fade" id="customModal" tabindex="-1" aria-labelledby="customModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="customModalLabel">${title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            ${content}
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 移除現有modal（如果有的話）
            const existingModal = document.getElementById('customModal');
            if (existingModal) {
                existingModal.remove();
            }

            // 添加新modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('customModal'));
            modal.show();

            // 當modal關閉時移除DOM元素
            document.getElementById('customModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // 搜尋功能的 Enter 鍵支援
        document.addEventListener('DOMContentLoaded', function() {
            // 為圖書館搜尋添加 Enter 鍵支援
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'book-search-input') {
                    e.target.addEventListener('keypress', function(event) {
                        if (event.key === 'Enter') {
                            searchBooks();
                        }
                    });
                }
            });
        });

        // 初始化
        showSection('home');

        // === 人事管理功能 ===

        // 載入員工管理頁面
        async function loadEmployeeManagementPage() {
            const content = document.getElementById('feature-content');
            
            try {
                // 模擬員工和部門資料
                const departments = [
                    { _id: 'dept1', name: '資訊工程系' },
                    { _id: 'dept2', name: '企業管理系' },
                    { _id: 'dept3', name: '會計系' },
                    { _id: 'dept4', name: '行政單位' }
                ];

                const employees = [
                    { 
                        _id: 'emp001', 
                        name: '張三', 
                        email: 'zhang@example.com',
                        phone: '0912345678',
                        department: '資訊工程系',
                        position: '助理教授',
                        hireDate: '2020-01-15',
                        status: '在職'
                    },
                    {
                        _id: 'emp002',
                        name: '李四',
                        email: 'li@example.com', 
                        phone: '0923456789',
                        department: '企業管理系',
                        position: '副教授',
                        hireDate: '2018-08-20',
                        status: '在職'
                    },
                    {
                        _id: 'emp003',
                        name: '王五',
                        email: 'wang@example.com',
                        phone: '0934567890', 
                        department: '會計系',
                        position: '講師',
                        hireDate: '2021-03-10',
                        status: '在職'
                    },
                    {
                        _id: 'emp004',
                        name: '陳六',
                        email: 'chen@example.com',
                        phone: '0945678901',
                        department: '行政單位', 
                        position: '行政人員',
                        hireDate: '2019-06-01',
                        status: '在職'
                    }
                ];

                content.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-person-lines-fill me-2"></i>員工管理</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <input type="text" id="employee-search" class="form-control" placeholder="搜尋員工...">
                                </div>
                                <div class="col-md-4">
                                    <select id="department-filter" class="form-select">
                                        <option value="all">全部部門</option>
                                        ${departments.map(dept => 
                                            `<option value="${dept._id}">${dept.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary" onclick="showAddEmployeeModal()">新增員工</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>員工編號</th>
                                            <th>姓名</th>
                                            <th>部門</th>
                                            <th>職稱</th>
                                            <th>聘僱日期</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employees-table-body">
                                        ${renderEmployeesTable(employees)}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

                // 添加搜索和篩選事件
                document.getElementById('employee-search').addEventListener('input', filterEmployees);
                document.getElementById('department-filter').addEventListener('change', filterEmployees);

            } catch (error) {
                console.error('載入員工管理頁面錯誤:', error);
                content.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>載入員工管理頁面失敗
                    </div>
                `;
            }
        }

        // 渲染員工表格
        function renderEmployeesTable(employees) {
            return employees.map(emp => {
                const statusClass = emp.status === 'active' ? 'success' : 
                                   emp.status === 'leave' ? 'warning' : 'secondary';
                const statusText = emp.status === 'active' ? '在職' : 
                                  emp.status === 'leave' ? '留職停薪' : '離職';
                
                return `
                    <tr>
                        <td>${emp.employeeId}</td>
                        <td>${emp.name}</td>
                        <td>${emp.department}</td>
                        <td>${emp.position}</td>
                        <td>${new Date(emp.hireDate).toLocaleDateString('zh-TW')}</td>
                        <td><span class="badge bg-${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editEmployee('${emp._id}')">編輯</button>
                            <button class="btn btn-sm btn-info" onclick="viewEmployee('${emp._id}')">檢視</button>
                            <button class="btn btn-sm btn-warning" onclick="transferEmployee('${emp._id}')">調職</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // 篩選員工
        async function filterEmployees() {
            try {
                const search = document.getElementById('employee-search').value;
                const department = document.getElementById('department-filter').value;
                
                const params = new URLSearchParams();
                if (search) params.append('search', search);
                if (department !== 'all') params.append('department', department);

                const response = await fetch(`/api/hr/employees?${params}`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('employees-table-body').innerHTML = renderEmployeesTable(data.data);
                }
            } catch (error) {
                console.error('篩選員工錯誤:', error);
            }
        }

        // 載入考勤管理頁面
        async function loadAttendanceManagementPage() {
            try {
                // 模擬考勤數據
                const attendanceRecords = [
                    {
                        _id: 'att001',
                        employeeName: '張三',
                        department: '資訊工程系',
                        date: '2024-01-23',
                        checkIn: '08:30',
                        checkOut: '17:30',
                        lateMinutes: 0,
                        status: 'normal'
                    },
                    {
                        _id: 'att002', 
                        employeeName: '李四',
                        department: '企業管理系',
                        date: '2024-01-23',
                        checkIn: '08:45',
                        checkOut: '17:25',
                        lateMinutes: 15,
                        status: 'late'
                    },
                    {
                        _id: 'att003',
                        employeeName: '王五',
                        department: '會計系',
                        date: '2024-01-23',
                        checkIn: '08:25',
                        checkOut: '17:35',
                        lateMinutes: 0,
                        status: 'normal'
                    }
                ];
                
                const today = new Date().toISOString().split('T')[0];
                const departments = ['資訊工程系', '企業管理系', '會計系', '行政單位'];

                document.getElementById('feature-content').innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="bi bi-clock me-2"></i>考勤管理</h2>
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="clockIn()">
                                <i class="bi bi-box-arrow-in-right me-2"></i>上班打卡
                            </button>
                            <button class="btn btn-warning" onclick="clockOut()">
                                <i class="bi bi-box-arrow-left me-2"></i>下班打卡
                            </button>
                        </div>
                    </div>

                    <!-- 今日打卡狀態 -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="bi bi-calendar-today me-2"></i>今日打卡狀態</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body">
                                                    <h3 class="text-success" id="today-checkin">--:--</h3>
                                                    <p class="mb-0">上班打卡</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body">
                                                    <h3 class="text-warning" id="today-checkout">--:--</h3>
                                                    <p class="mb-0">下班打卡</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body">
                                                    <h3 class="text-info" id="today-workhours">0.0h</h3>
                                                    <p class="mb-0">工作時數</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body">
                                                    <h3 class="text-primary" id="today-status">未打卡</h3>
                                                    <p class="mb-0">狀態</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 篩選和搜尋 -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row align-items-end">
                                <div class="col-md-3">
                                    <label class="form-label">日期篩選</label>
                                    <input type="date" class="form-control" id="attendance-date" value="${today}">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">部門篩選</label>
                                    <select class="form-select" id="attendance-department">
                                        <option value="">全部部門</option>
                                        ${departments.map(dept => `<option value="${dept}">${dept}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">狀態篩選</label>
                                    <select class="form-select" id="attendance-status">
                                        <option value="">全部狀態</option>
                                        <option value="normal">正常</option>
                                        <option value="late">遲到</option>
                                        <option value="absent">缺勤</option>
                                        <option value="leave">請假</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary me-2" onclick="filterAttendanceRecords()">
                                        <i class="bi bi-search me-1"></i>搜尋
                                    </button>
                                    <button class="btn btn-success" onclick="exportAttendanceReport()">
                                        <i class="bi bi-download me-1"></i>匯出
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 考勤統計 -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="text-success">${attendanceRecords.filter(r => r.status === 'normal').length}</h3>
                                    <p class="text-muted mb-0">正常出勤</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="text-warning">${attendanceRecords.filter(r => r.status === 'late').length}</h3>
                                    <p class="text-muted mb-0">遲到記錄</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="text-danger">${attendanceRecords.filter(r => r.status === 'absent').length}</h3>
                                    <p class="text-muted mb-0">缺勤記錄</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="text-info">${attendanceRecords.filter(r => r.status === 'leave').length}</h3>
                                    <p class="text-muted mb-0">請假記錄</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 考勤記錄表格 -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-table me-2"></i>考勤記錄</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>日期</th>
                                            <th>員工</th>
                                            <th>部門</th>
                                            <th>上班打卡</th>
                                            <th>下班打卡</th>
                                            <th>工作時數</th>
                                            <th>加班時數</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${attendanceRecords.map(record => {
                                            const statusText = record.status === 'normal' ? '正常' : 
                                                              record.status === 'late' ? '遲到' : 
                                                              record.status === 'absent' ? '缺勤' : '請假';
                                            const statusClass = record.status === 'normal' ? 'success' : 
                                                               record.status === 'late' ? 'warning' : 
                                                               record.status === 'absent' ? 'danger' : 'info';
                                            return `
                                                <tr>
                                                    <td>${new Date(record.date).toLocaleDateString('zh-TW')}</td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                                                                ${(record.employee?.name || '未知')[0]}
                                                            </div>
                                                            <div>
                                                                <div class="fw-bold">${record.employee?.name || '未知'}</div>
                                                                <small class="text-muted">${record.employee?.employeeId || ''}</small>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>${record.employee?.department || ''}</td>
                                                    <td>
                                                        <span class="badge ${record.checkIn ? 'bg-success' : 'bg-secondary'}">
                                                            ${record.checkIn || '未打卡'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span class="badge ${record.checkOut ? 'bg-success' : 'bg-secondary'}">
                                                            ${record.checkOut || '未打卡'}
                                                        </span>
                                                    </td>
                                                    <td>${record.workHours ? record.workHours.toFixed(1) + 'h' : '0h'}</td>
                                                    <td>${record.overtimeHours ? record.overtimeHours.toFixed(1) + 'h' : '0h'}</td>
                                                    <td><span class="badge bg-${statusClass}">${statusText}</span></td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm">
                                                            <button class="btn btn-outline-info" onclick="viewAttendanceDetail('${record._id}')" title="查看詳情">
                                                                <i class="bi bi-eye"></i>
                                                            </button>
                                                            <button class="btn btn-outline-primary" onclick="editAttendance('${record._id}')" title="編輯">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

                // 載入今日打卡狀態
                updateTodayAttendanceStatus();

            } catch (error) {
                console.error('載入考勤管理頁面錯誤:', error);
                contentDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h4>載入失敗</h4>
                        <p>無法載入考勤管理頁面: ${error.message}</p>
                        <button class="btn btn-outline-danger" onclick="loadAttendanceManagementPage()">重新載入</button>
                    </div>
                `;
            }
        }

        // 更新今日打卡狀態
        async function updateTodayAttendanceStatus() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch('/api/hr/attendance');
                const data = await response.json();
                
                if (data.success) {
                    // 這裡應該根據登入使用者找到今日記錄
                    // 簡化版本顯示今日第一筆記錄
                    const todayRecord = data.data.find(record => 
                        new Date(record.date).toISOString().split('T')[0] === today
                    );
                    
                    if (todayRecord) {
                        document.getElementById('today-checkin').textContent = todayRecord.checkIn || '--:--';
                        document.getElementById('today-checkout').textContent = todayRecord.checkOut || '--:--';
                        document.getElementById('today-workhours').textContent = todayRecord.workHours ? todayRecord.workHours.toFixed(1) + 'h' : '0.0h';
                        
                        const statusText = todayRecord.status === 'normal' ? '正常' : 
                                          todayRecord.status === 'late' ? '遲到' : 
                                          todayRecord.status === 'absent' ? '缺勤' : '請假';
                        document.getElementById('today-status').textContent = statusText;
                        
                        // 設定狀態顏色
                        const statusElement = document.getElementById('today-status');
                        statusElement.className = todayRecord.status === 'normal' ? 'text-success' : 
                                                 todayRecord.status === 'late' ? 'text-warning' : 
                                                 todayRecord.status === 'absent' ? 'text-danger' : 'text-info';
                    }
                }
            } catch (error) {
                console.error('更新今日打卡狀態錯誤:', error);
            }
        }

        // 篩選考勤記錄
        function filterAttendanceRecords() {
            const date = document.getElementById('attendance-date').value;
            const department = document.getElementById('attendance-department').value;
            const status = document.getElementById('attendance-status').value;
            
            // 重新載入頁面以應用篩選
            // 實際應用中應該實作客戶端篩選以提升性能
            loadAttendanceManagementPage();
        }

        async function showEmployeeDetails(empId) {
            try {
                const response = await fetch(`/api/hr/employees/${empId}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message);
                }
                
                const employee = data.data;
                showEmployeeDetailModal(employee);
            } catch (error) {
                console.error('檢視員工錯誤:', error);
                showToast('載入員工資料失敗', 'error');
            }
        }

        function showEmployeeDetailModal(employee) {
            const statusText = employee.status === 'active' ? '在職' : 
                              employee.status === 'leave' ? '留職停薪' : '離職';
            const statusClass = employee.status === 'active' ? 'success' : 
                               employee.status === 'leave' ? 'warning' : 'secondary';
            
            showModal('員工詳情', `
                <div class="row">
                    <div class="col-md-6">
                        <h6>基本資料</h6>
                        <table class="table table-sm">
                            <tr><td><strong>員工編號:</strong></td><td>${employee.employeeId}</td></tr>
                            <tr><td><strong>姓名:</strong></td><td>${employee.name}</td></tr>
                            <tr><td><strong>身分證號:</strong></td><td>${employee.idNumber}</td></tr>
                            <tr><td><strong>電子郵件:</strong></td><td>${employee.email}</td></tr>
                            <tr><td><strong>電話:</strong></td><td>${employee.phone}</td></tr>
                            <tr><td><strong>地址:</strong></td><td>${employee.address}</td></tr>
                            <tr><td><strong>狀態:</strong></td><td><span class="badge bg-${statusClass}">${statusText}</span></td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>工作資料</h6>
                        <table class="table table-sm">
                            <tr><td><strong>部門:</strong></td><td>${employee.department}</td></tr>
                            <tr><td><strong>職稱:</strong></td><td>${employee.position}</td></tr>
                            <tr><td><strong>聘僱日期:</strong></td><td>${new Date(employee.hireDate).toLocaleDateString('zh-TW')}</td></tr>
                            <tr><td><strong>薪資:</strong></td><td>NT$ ${employee.salary.toLocaleString()}</td></tr>
                            <tr><td><strong>合約類型:</strong></td><td>${employee.contractType}</td></tr>
                            <tr><td><strong>工作型態:</strong></td><td>${employee.workType}</td></tr>
                            <tr><td><strong>銀行帳戶:</strong></td><td>${employee.bankAccount}</td></tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>緊急聯絡人</h6>
                        <table class="table table-sm">
                            <tr>
                                <td><strong>姓名:</strong> ${employee.emergencyContact.name}</td>
                                <td><strong>關係:</strong> ${employee.emergencyContact.relationship}</td>
                                <td><strong>電話:</strong> ${employee.emergencyContact.phone}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>保險資料</h6>
                        <p>
                            <span class="badge ${employee.healthInsurance ? 'bg-success' : 'bg-secondary'}">
                                健保: ${employee.healthInsurance ? '已投保' : '未投保'}
                            </span>
                            <span class="badge ${employee.laborInsurance ? 'bg-success' : 'bg-secondary'} ms-2">
                                勞保: ${employee.laborInsurance ? '已投保' : '未投保'}
                            </span>
                        </p>
                    </div>
                </div>
            `, `
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-primary" onclick="editEmployee('${employee._id}')">編輯資料</button>
            `);
        }

        async function editEmployee(empId) {
            try {
                const response = await fetch(`/api/hr/employees/${empId}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message);
                }
                
                const employee = data.data;
                showEditEmployeeModal(employee);
            } catch (error) {
                console.error('載入員工編輯資料錯誤:', error);
                showToast('載入員工資料失敗', 'error');
            }
        }

        function showEditEmployeeModal(employee) {
            showModal('編輯員工', `
                <form id="edit-employee-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">姓名</label>
                                <input type="text" class="form-control" name="name" value="${employee.name}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">電子郵件</label>
                                <input type="email" class="form-control" name="email" value="${employee.email}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">電話</label>
                                <input type="tel" class="form-control" name="phone" value="${employee.phone}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">職稱</label>
                                <input type="text" class="form-control" name="position" value="${employee.position}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">部門</label>
                                <input type="text" class="form-control" name="department" value="${employee.department}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">薪資</label>
                                <input type="number" class="form-control" name="salary" value="${employee.salary}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">狀態</label>
                                <select class="form-select" name="status" required>
                                    <option value="active" ${employee.status === 'active' ? 'selected' : ''}>在職</option>
                                    <option value="leave" ${employee.status === 'leave' ? 'selected' : ''}>留職停薪</option>
                                    <option value="inactive" ${employee.status === 'inactive' ? 'selected' : ''}>離職</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">地址</label>
                                <textarea class="form-control" name="address" rows="2">${employee.address}</textarea>
                            </div>
                        </div>
                    </div>
                </form>
            `, `
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveEmployeeChanges('${employee._id}')">儲存變更</button>
            `);
        }

        async function saveEmployeeChanges(empId) {
            try {
                const form = document.getElementById('edit-employee-form');
                const formData = new FormData(form);
                const updateData = Object.fromEntries(formData);
                
                // 轉換薪資為數字
                updateData.salary = parseInt(updateData.salary);
                
                const response = await fetch(`/api/hr/employees/${empId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showToast('員工資料更新成功', 'success');
                    // 關閉模態框
                    const modal = bootstrap.Modal.getInstance(document.getElementById('dynamicModal'));
                    modal.hide();
                    // 重新載入員工列表
                    loadEmployeeManagementPage();
                } else {
                    showToast(result.message || '更新失敗', 'error');
                }
            } catch (error) {
                console.error('更新員工資料錯誤:', error);
                showToast('更新員工資料失敗', 'error');
            }
        }

        function transferEmployee(empId) {
            showToast('調職功能：可以用來變更員工部門', 'info');
        }

        async function showAddEmployeeModal() {
            try {
                // 獲取部門列表
                const response = await fetch('/api/hr/departments');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('獲取部門資料失敗');
                }

                const departments = data.data;
                
                showModal('新增員工', `
                    <form id="add-employee-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">員工編號</label>
                                    <input type="text" class="form-control" name="employeeId" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">姓名</label>
                                    <input type="text" class="form-control" name="name" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">電子郵件</label>
                                    <input type="email" class="form-control" name="email" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">電話</label>
                                    <input type="tel" class="form-control" name="phone" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">身分證號</label>
                                    <input type="text" class="form-control" name="idNumber" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">部門</label>
                                    <select class="form-select" name="departmentId" required>
                                        <option value="">選擇部門</option>
                                        ${departments.map(dept => 
                                            `<option value="${dept._id}">${dept.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">職稱</label>
                                    <input type="text" class="form-control" name="position" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">聘僱日期</label>
                                    <input type="date" class="form-control" name="hireDate" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">薪資</label>
                                    <input type="number" class="form-control" name="salary" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">地址</label>
                                    <textarea class="form-control" name="address" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <h6>緊急聯絡人</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">姓名</label>
                                            <input type="text" class="form-control" name="emergencyContactName" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">關係</label>
                                            <input type="text" class="form-control" name="emergencyContactRelationship" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">電話</label>
                                            <input type="tel" class="form-control" name="emergencyContactPhone" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                `, `
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveNewEmployee()">新增員工</button>
                `);
                
                // 當部門選擇變更時，自動更新部門名稱
                document.querySelector('select[name="departmentId"]').addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.value) {
                        // 可以在這裡添加自動設定部門名稱的邏輯
                    }
                });
                
            } catch (error) {
                console.error('載入新增員工表單錯誤:', error);
                showToast('載入表單失敗', 'error');
            }
        }

        async function saveNewEmployee() {
            try {
                const form = document.getElementById('add-employee-form');
                const formData = new FormData(form);
                const employeeData = Object.fromEntries(formData);
                
                // 獲取選中的部門名稱
                const deptSelect = form.querySelector('select[name="departmentId"]');
                const selectedDept = deptSelect.options[deptSelect.selectedIndex];
                employeeData.department = selectedDept.text;
                
                // 轉換數字型欄位
                employeeData.salary = parseInt(employeeData.salary);
                
                // 組合緊急聯絡人資料
                employeeData.emergencyContact = {
                    name: employeeData.emergencyContactName,
                    relationship: employeeData.emergencyContactRelationship,
                    phone: employeeData.emergencyContactPhone
                };
                
                // 清除臨時欄位
                delete employeeData.emergencyContactName;
                delete employeeData.emergencyContactRelationship;
                delete employeeData.emergencyContactPhone;
                
                // 設定預設值
                employeeData.status = 'active';
                employeeData.contractType = '正職';
                employeeData.workType = '全職';
                employeeData.healthInsurance = true;
                employeeData.laborInsurance = true;
                employeeData.bankAccount = '待填寫';

                const response = await fetch('/api/hr/employees', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(employeeData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showToast('員工新增成功', 'success');
                    // 關閉模態框
                    const modal = bootstrap.Modal.getInstance(document.getElementById('dynamicModal'));
                    modal.hide();
                    // 重新載入員工列表
                    loadEmployeeManagementPage();
                } else {
                    showToast(result.message || '新增失敗', 'error');
                }
            } catch (error) {
                console.error('新增員工錯誤:', error);
                showToast('新增員工失敗', 'error');
            }
        }

        // 考勤操作函數
        async function editAttendance(recordId) {
            try {
                const response = await fetch(`/api/hr/attendance`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('獲取考勤記錄失敗');
                }
                
                const record = data.data.find(r => r._id === recordId);
                if (!record) {
                    throw new Error('找不到考勤記錄');
                }
                
                showEditAttendanceModal(record);
            } catch (error) {
                console.error('載入考勤記錄錯誤:', error);
                showToast('載入考勤記錄失敗', 'error');
            }
        }

        function showEditAttendanceModal(record) {
            showModal('編輯考勤記錄', `
                <form id="edit-attendance-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">員工</label>
                                <input type="text" class="form-control" value="${record.employee?.name || '未知'} (${record.employee?.employeeId || ''})" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">日期</label>
                                <input type="date" class="form-control" value="${record.date}" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">上班打卡</label>
                                <input type="time" class="form-control" name="checkIn" value="${record.checkIn || ''}" step="1">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">下班打卡</label>
                                <input type="time" class="form-control" name="checkOut" value="${record.checkOut || ''}" step="1">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">狀態</label>
                                <select class="form-select" name="status">
                                    <option value="normal" ${record.status === 'normal' ? 'selected' : ''}>正常</option>
                                    <option value="late" ${record.status === 'late' ? 'selected' : ''}>遲到</option>
                                    <option value="absent" ${record.status === 'absent' ? 'selected' : ''}>缺勤</option>
                                    <option value="leave" ${record.status === 'leave' ? 'selected' : ''}>請假</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">備註</label>
                                <textarea class="form-control" name="note" rows="2">${record.note || ''}</textarea>
                            </div>
                        </div>
                    </div>
                </form>
            `, `
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveAttendanceChanges('${record._id}')">儲存變更</button>
            `);
        }

        async function saveAttendanceChanges(recordId) {
            try {
                const form = document.getElementById('edit-attendance-form');
                const formData = new FormData(form);
                const updateData = Object.fromEntries(formData);
                
                // 計算工作時數
                if (updateData.checkIn && updateData.checkOut) {
                    const checkInTime = new Date(`1970-01-01T${updateData.checkIn}`);
                    const checkOutTime = new Date(`1970-01-01T${updateData.checkOut}`);
                    const workHours = (checkOutTime - checkInTime) / (1000 * 60 * 60);
                    updateData.workHours = Math.max(0, workHours - 1); // 扣除1小時午休
                    updateData.overtimeHours = Math.max(0, updateData.workHours - 8);
                } else {
                    updateData.workHours = 0;
                    updateData.overtimeHours = 0;
                }

                const response = await fetch(`/api/hr/attendance/${recordId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showToast('考勤記錄更新成功', 'success');
                    // 關閉模態框
                    const modal = bootstrap.Modal.getInstance(document.getElementById('dynamicModal'));
                    modal.hide();
                    // 重新載入考勤管理頁面
                    loadAttendanceManagementPage();
                } else {
                    showToast(result.message || '更新失敗', 'error');
                }
            } catch (error) {
                console.error('更新考勤記錄錯誤:', error);
                showToast('更新考勤記錄失敗', 'error');
            }
        }

        async function viewAttendanceDetail(recordId) {
            try {
                const response = await fetch(`/api/hr/attendance`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('獲取考勤記錄失敗');
                }
                
                const record = data.data.find(r => r._id === recordId);
                if (!record) {
                    throw new Error('找不到考勤記錄');
                }
                
                showAttendanceDetailModal(record);
            } catch (error) {
                console.error('載入考勤詳情錯誤:', error);
                showToast('載入考勤詳情失敗', 'error');
            }
        }

        function showAttendanceDetailModal(record) {
            const statusText = record.status === 'normal' ? '正常' : 
                              record.status === 'late' ? '遲到' : 
                              record.status === 'absent' ? '缺勤' : '請假';
            const statusClass = record.status === 'normal' ? 'success' : 
                               record.status === 'late' ? 'warning' : 
                               record.status === 'absent' ? 'danger' : 'info';

            showModal('考勤詳情', `
                <div class="row">
                    <div class="col-md-6">
                        <h6>基本資訊</h6>
                        <table class="table table-sm">
                            <tr><td><strong>員工:</strong></td><td>${record.employee?.name || '未知'}</td></tr>
                            <tr><td><strong>員工編號:</strong></td><td>${record.employee?.employeeId || ''}</td></tr>
                            <tr><td><strong>部門:</strong></td><td>${record.employee?.department || ''}</td></tr>
                            <tr><td><strong>日期:</strong></td><td>${new Date(record.date).toLocaleDateString('zh-TW')}</td></tr>
                            <tr><td><strong>狀態:</strong></td><td><span class="badge bg-${statusClass}">${statusText}</span></td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>打卡時間</h6>
                        <table class="table table-sm">
                            <tr><td><strong>上班打卡:</strong></td><td>${record.checkIn || '未打卡'}</td></tr>
                            <tr><td><strong>下班打卡:</strong></td><td>${record.checkOut || '未打卡'}</td></tr>
                            <tr><td><strong>工作時數:</strong></td><td>${record.workHours ? record.workHours.toFixed(1) + ' 小時' : '0 小時'}</td></tr>
                            <tr><td><strong>加班時數:</strong></td><td>${record.overtimeHours ? record.overtimeHours.toFixed(1) + ' 小時' : '0 小時'}</td></tr>
                            <tr><td><strong>備註:</strong></td><td>${record.note || '無'}</td></tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>時間分析</h6>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar" style="width: ${Math.min((record.workHours || 0) / 8 * 100, 100)}%" 
                                 aria-valuenow="${record.workHours || 0}" aria-valuemin="0" aria-valuemax="8">
                                ${record.workHours ? record.workHours.toFixed(1) : 0}h / 8h
                            </div>
                        </div>
                        ${record.overtimeHours > 0 ? 
                            `<div class="alert alert-info"><i class="bi bi-clock me-2"></i>加班時數: ${record.overtimeHours.toFixed(1)} 小時</div>` : 
                            ''
                        }
                        ${record.status === 'late' ? 
                            '<div class="alert alert-warning"><i class="bi bi-exclamation-triangle me-2"></i>該員工當日遲到</div>' : 
                            ''
                        }
                    </div>
                </div>
            `, `
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-primary" onclick="editAttendance('${record._id}')">編輯記錄</button>
            `);
        }

        function exportAttendanceReport() {
            const date = document.getElementById('attendance-date').value;
            const department = document.getElementById('attendance-department').value;
            
            // 模擬匯出功能
            showToast(`正在匯出 ${date} 的考勤報表...`, 'info');
            
            // 實際應用中，這裡會呼叫後端 API 產生並下載 Excel 或 PDF 報表
            setTimeout(() => {
                showToast('考勤報表匯出完成', 'success');
            }, 2000);
        }

        // 打卡功能（可以添加到員工個人頁面）
        async function clockIn() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showToast('請先登入', 'warning');
                    return;
                }

                // 這裡應該根據登入使用者找到對應的員工ID
                // 簡化版本使用使用者名稱
                const response = await fetch('/api/hr/attendance/clock-in', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        employeeId: 'emp001' // 實際應用中應該根據登入使用者動態獲取
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showToast(`上班打卡成功！時間：${result.data.time}`, 'success');
                } else {
                    showToast(result.message || '打卡失敗', 'error');
                }
            } catch (error) {
                console.error('上班打卡錯誤:', error);
                showToast('上班打卡失敗', 'error');
            }
        }

        async function clockOut() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showToast('請先登入', 'warning');
                    return;
                }

                const response = await fetch('/api/hr/attendance/clock-out', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        employeeId: 'emp001' // 實際應用中應該根據登入使用者動態獲取
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showToast(`下班打卡成功！時間：${result.data.time}，工作時數：${result.data.workHours.toFixed(1)}小時`, 'success');
                } else {
                    showToast(result.message || '打卡失敗', 'error');
                }
            } catch (error) {
                console.error('下班打卡錯誤:', error);
                showToast('下班打卡失敗', 'error');
            }
        }
    </script>
</body>
</html>
